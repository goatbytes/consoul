{
  "created_at": "2025-11-14T17:28:42.160420",
  "updated_at": "2025-11-15T07:28:05.189935Z",
  "id": "SOUL-100",
  "uuid": "865bb11b-62d4-4c52-b5ca-394d82c9a400",
  "title": "Add SearxNG support with DuckDuckGo fallback",
  "description": "Implement production-grade web search with SearxNG primary and DuckDuckGo fallback.\n\n## Objective\nAdd enterprise-grade web search with full control via self-hosted SearxNG, gracefully falling back to DuckDuckGo when SearxNG is unavailable.\n\n## Dependencies\n- SOUL-99 (DuckDuckGo implementation must exist for fallback)\n- `langchain-community` with SearxNG support\n\n## Implementation Details\n\n### Enhanced web_search.py\n\nModify existing `web_search` tool to support both backends:\n\n```python\n@tool\ndef web_search(\n    query: str,\n    max_results: int = 5,\n    engines: list[str] | None = None,\n    categories: str | None = None\n) -> str:\n    \"\"\"Search the web using SearxNG or DuckDuckGo fallback.\n    \n    Args:\n        query: Search query\n        max_results: Number of results (1-10)\n        engines: SearxNG engines list (e.g., [\"google\", \"github\", \"arxiv\"])\n        categories: SearxNG categories (e.g., \"general\", \"images\", \"it\")\n    \n    Returns:\n        JSON with results and metadata\n    \"\"\"\n    config = get_web_search_config()\n    \n    # Try SearxNG first if configured\n    if config.searxng_url:\n        try:\n            search = SearxSearchWrapper(searx_host=config.searxng_url)\n            if engines or categories:\n                return search.results(query, num_results=max_results, \n                                     engines=engines, categories=categories)\n            return search.run(query)\n        except Exception as e:\n            logger.warning(f\"SearxNG unavailable, falling back to DuckDuckGo: {e}\")\n    \n    # Fallback to DuckDuckGo\n    search = DuckDuckGoSearchAPIWrapper(max_results=max_results)\n    return search.run(query)\n```\n\n### Enhanced Configuration\n\n```python\nclass WebSearchToolConfig(BaseModel):\n    \"\"\"Configuration for web_search tool.\"\"\"\n    # SearxNG settings (optional)\n    searxng_url: str | None = Field(default=None, description=\"SearxNG instance URL\")\n    searxng_engines: list[str] = Field(default_factory=lambda: [\"google\", \"duckduckgo\"])\n    \n    # DuckDuckGo fallback settings\n    max_results: int = Field(default=5, ge=1, le=10)\n    region: str = Field(default=\"wt-wt\")\n    safesearch: str = Field(default=\"moderate\")\n    timeout: int = Field(default=10)\n    \n    # Advanced SearxNG features\n    enable_image_search: bool = Field(default=True)\n    enable_news_search: bool = Field(default=True)\n```\n\n### Profile Configuration Example\n\n```yaml\n# config.yaml\ntools:\n  web_search:\n    # Optional: Uncomment to use SearxNG\n    # searxng_url: \"http://localhost:8888\"\n    # searxng_engines: [\"google\", \"github\", \"stackoverflow\"]\n    max_results: 5\n    safesearch: \"moderate\"\n```\n\n## SearxNG Setup Documentation\n\nCreate `docs/advanced/searxng-setup.md`:\n\n### Docker Compose File\n\nProvide `docker-compose.searxng.yml`:\n\n```yaml\nversion: '3.8'\n\nservices:\n  searxng:\n    image: searxng/searxng:latest\n    container_name: consoul-searxng\n    ports:\n      - \"8888:8080\"\n    volumes:\n      - ./searxng:/etc/searxng:rw\n    environment:\n      - SEARXNG_BASE_URL=http://localhost:8888/\n    restart: unless-stopped\n```\n\n### Quick Start Script\n\nCreate `scripts/setup-searxng.sh`:\n\n```bash\n#!/bin/bash\n# Quick SearxNG setup for Consoul\n\necho \"Setting up SearxNG for Consoul...\"\n\n# Check Docker\nif ! command -v docker &> /dev/null; then\n    echo \"Error: Docker not installed\"\n    exit 1\nfi\n\n# Clone official Docker setup\ngit clone https://github.com/searxng/searxng-docker.git /tmp/searxng-docker\ncd /tmp/searxng-docker\n\n# Start container\ndocker compose up -d\n\necho \"SearxNG running at http://localhost:8888\"\necho \"\"\necho \"Add to your config.yaml:\"\necho \"tools:\"\necho \"  web_search:\"\necho \"    searxng_url: 'http://localhost:8888'\"\n```\n\n## Testing\n\n### Unit Tests\n- Test SearxNG connection success\n- Test SearxNG connection failure \u2192 DuckDuckGo fallback\n- Test engine-specific searches\n- Test category filtering\n\n### Integration Tests\n- With SearxNG running\n- Without SearxNG (fallback mode)\n\n### Manual Testing\n\n```bash\n# With SearxNG\ndocker compose -f docker-compose.searxng.yml up -d\npython -c \"from consoul.ai.tools import web_search; print(web_search.invoke({'query': 'rust async', 'engines': ['stackoverflow']}))\"\n\n# Without SearxNG (fallback)\ndocker compose down\npython -c \"from consoul.ai.tools import web_search; print(web_search.invoke({'query': 'rust async'}))\"\n```\n\n## Documentation Updates\n\n### docs/tools.md\n- Document SearxNG vs DuckDuckGo differences\n- Advanced features (engine selection, categories)\n- Setup guide link\n\n### docs/advanced/searxng-setup.md (new)\n- Why use SearxNG?\n- Docker installation\n- Configuration guide\n- Troubleshooting\n\n### README.md\n- Mention optional SearxNG support\n- Link to setup docs\n\n## Success Criteria\n- [x] Auto-detection of SearxNG availability\n- [x] Graceful fallback to DuckDuckGo\n- [x] SearxNG-specific features (engines, categories)\n- [x] Docker setup documentation\n- [x] Tests for both backends\n- [x] Clear user documentation\n\n## Estimated Effort\n4-6 hours including documentation\n\n## Notes\n- Make SearxNG completely optional\n- Default to DuckDuckGo for simplest experience\n- Document SearxNG for users wanting more control\n- Reference Perplexica as production example\n- Consider future: image search, news search modes\n\n## References\n- Perplexica: https://github.com/ItzCrazyKns/Perplexica\n- SearxNG Docker: https://github.com/searxng/searxng-docker\n- LangChain SearxNG: https://python.langchain.com/docs/integrations/providers/searx/",
  "status": "done",
  "type": "feature",
  "priority": "low",
  "labels": [],
  "assignee": "jared@goatbytes.io",
  "reporter": "jared@goatbytes.io",
  "blocked_by": [],
  "blocks": [],
  "comments": [],
  "attachments": [],
  "attachment_count": 0,
  "comment_count": 0,
  "order": 0,
  "custom_fields": {},
  "_archive_metadata": {
    "archived_at": "2025-11-14T23:28:31.126196",
    "archived_from_status": "done",
    "archived_by": "gira-cli"
  }
}