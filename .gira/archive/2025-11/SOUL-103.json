{
  "created_at": "2025-11-14T22:29:49.598060",
  "updated_at": "2025-11-14T23:36:19.221384",
  "id": "SOUL-103",
  "uuid": "7aadce35-8e29-4aa8-a224-dd759117432a",
  "title": "Add FileEditToolConfig to configuration models",
  "description": "**As a** Consoul developer\n**I want** a Pydantic configuration model for file editing tools\n**So that** file edit operations have proper validation, security controls, and user-configurable settings\n\n**Context:**\nFile editing tools (edit_file, create_file, delete_file) need dedicated configuration similar to existing BashToolConfig and ReadToolConfig. Research shows that:\n- cursor-agent uses permission-aware file operations with per-operation approval\n- Optimistic locking via expected_hash prevents concurrent edit conflicts\n- Size/count limits prevent runaway LLM edits\n- Shared validation with ReadToolConfig ensures consistent security\n\nSee research:\n- docs/research/line_based_file_editing_research.md (Codex)\n- SOUL-90 comments (Claude synthesis)\n\n**Technical Notes:**\n- src/consoul/config/models.py:430+ - Add after CodeSearchToolConfig\n- Extend from BaseModel with ConfigDict(extra=\"forbid\", validate_assignment=True)\n- Share path validation helpers with ReadToolConfig (extract to filesystem.py utility)\n- Support extension allowlists/blocklists\n- Add max_edits, max_payload_bytes for runaway protection\n- Include default_encoding (utf-8)\n- Allow allow_overwrite toggle for create_file\n- Add to ToolConfig model's file_edit: FileEditToolConfig field\n\nFiles to modify:\n- src/consoul/config/models.py (add FileEditToolConfig class)\n- src/consoul/config/models.py (add file_edit field to ToolConfig)\n\n**Acceptance Criteria:**\n\n**Given** I define FileEditToolConfig in config models\n**When** I instantiate it with valid values\n**Then** Pydantic validates all fields correctly\n\n**Given** I set max_edits=10 in config\n**When** validation runs\n**Then** the config accepts values 1-100 and rejects invalid counts\n\n**Given** I configure allowed_extensions=[\".py\", \".md\"]\n**When** tools check file extensions\n**Then** only .py and .md files are editable\n\n**Given** I set max_payload_bytes=1048576 (1MB)\n**When** validation runs  \n**Then** edit payloads exceeding 1MB are rejected\n\n**Testing Considerations:**\n- Unit tests for field validation (valid/invalid ranges)\n- Test extension list validation\n- Test max_edits, max_payload_bytes constraints\n- Test default values match expectations\n- Test integration with ToolConfig parent model\n\n**Implementation Hints:**\n```python\nclass FileEditToolConfig(BaseModel):\n    model_config = ConfigDict(extra=\"forbid\", validate_assignment=True)\n    \n    allowed_extensions: list[str] = Field(\n        default_factory=lambda: [\".py\", \".md\", \".txt\", \".json\", ...],\n        description=\"File extensions allowed for editing\"\n    )\n    blocked_paths: list[str] = Field(\n        default_factory=lambda: [\"/etc\", \"/proc\", \"/sys\", \"/dev\"],\n        description=\"Path prefixes blocked from editing (security)\"\n    )\n    max_edits: int = Field(default=50, gt=0, le=100)\n    max_payload_bytes: int = Field(default=1048576, gt=0)  # 1MB\n    default_encoding: str = Field(default=\"utf-8\")\n    allow_overwrite: bool = Field(default=False)\n    timeout: int = Field(default=30, gt=0, le=600)\n```",
  "status": "done",
  "type": "task",
  "priority": "high",
  "labels": [
    "config",
    "file-edit",
    "foundation"
  ],
  "assignee": "jared@goatbytes.io",
  "reporter": "jared@goatbytes.io",
  "epic_id": "EPIC-005",
  "blocked_by": [],
  "blocks": [
    "SOUL-104",
    "SOUL-105"
  ],
  "comments": [
    {
      "created_at": "2025-11-14T23:36:19.221287",
      "updated_at": "2025-11-14T23:36:19.221288",
      "id": "20251114233619-16de1cd8",
      "ticket_id": "SOUL-103",
      "author": "jared@goatbytes.io",
      "content": "\u2705 SOUL-103 Implementation Complete\n\n## Summary\nSuccessfully implemented FileEditToolConfig as a Pydantic configuration model for file editing tools, providing comprehensive security controls, validation, and operational limits.\n\n## Changes Implemented\n\n### 1. FileEditToolConfig Class (src/consoul/config/models.py:785-886)\n**7 Configuration Fields:**\n- `allowed_extensions`: list[str] - 35+ common extensions (py, md, txt, json, etc.)\n- `blocked_paths`: list[str] - Security blocks for /etc, /proc, /sys, /dev\n- `max_edits`: int - Runaway protection (default 50, max 100 edits per call)\n- `max_payload_bytes`: int - Memory protection (default 1MB)\n- `default_encoding`: str - Text encoding (default utf-8)\n- `allow_overwrite`: bool - Create file overwrite control (default False)\n- `timeout`: int - Operation timeout (default 30s, max 10 minutes)\n\n**Security Features:**\n- Extension allowlisting prevents editing dangerous file types\n- Path blocking prevents editing sensitive system files\n- Payload size limits prevent memory exhaustion\n- Edit count limits prevent runaway LLM modifications\n\n**Pattern Compliance:**\n- Follows BashToolConfig/ReadToolConfig structure exactly\n- ConfigDict(extra=\"forbid\", validate_assignment=True)\n- Comprehensive docstring with usage example\n- All fields have Pydantic validation constraints\n\n### 2. ToolConfig Integration (src/consoul/config/models.py:981-984)\n- Added `file_edit: FileEditToolConfig` field to ToolConfig\n- Uses default_factory=FileEditToolConfig pattern\n- Seamless integration with existing tool configs (bash, read, web_search, etc.)\n\n### 3. Comprehensive Test Suite (tests/config/test_tool_config.py:254-372)\n**TestFileEditToolConfig - 10 Test Methods:**\n1. `test_default_file_edit_config` - Verify default values\n2. `test_file_edit_config_custom_values` - Custom configuration\n3. `test_file_edit_config_validation_positive_integers` - Field validation\n4. `test_file_edit_config_max_edits_limits` - 1-100 range enforcement\n5. `test_file_edit_config_timeout_limits` - 1-600 second range\n6. `test_file_edit_config_custom_extensions` - Extension list customization\n7. `test_file_edit_config_custom_blocked_paths` - Path blocking customization\n8. `test_file_edit_config_in_tool_config` - Integration testing\n9. `test_file_edit_config_default_in_tool_config` - Default integration\n10. `test_file_edit_config_extra_fields_forbidden` - Extra field rejection\n\n## Test Results\n\n### Pytest (All Passing)\n```\n\u2705 30/30 tests passing\n- 10 TestToolConfig tests\n- 10 TestReadToolConfig tests\n- 10 TestFileEditToolConfig tests (NEW)\n```\n\n### Coverage Improvement\n```\nmodels.py: 71.43% \u2192 77.70% (+6.27%)\n```\n\n### Type Checking\n```\n\u2705 mypy: Success - no issues found\n```\n\n### Linting\n```\n\u2705 ruff: No new issues in changed code\n```\n\n## Acceptance Criteria Met\n\n\u2705 **Given** I define FileEditToolConfig in config models  \n**When** I instantiate it with valid values  \n**Then** Pydantic validates all fields correctly\n\n\u2705 **Given** I set max_edits=10 in config  \n**When** validation runs  \n**Then** Config accepts values 1-100 and rejects invalid counts\n\n\u2705 **Given** I configure allowed_extensions=[\".py\", \".md\"]  \n**When** tools check file extensions  \n**Then** Only .py and .md files are editable\n\n\u2705 **Given** I set max_payload_bytes=1048576 (1MB)  \n**When** validation runs  \n**Then** Edit payloads exceeding 1MB are rejected\n\n## Files Modified\n- `src/consoul/config/models.py` (+107 lines)\n- `tests/config/test_tool_config.py` (+121 lines)\n- **Total**: +228 lines\n\n## Commit\n- **SHA**: ed6229d\n- **Message**: feat(SOUL-103): add FileEditToolConfig to configuration models\n\n## Next Steps\nReady for **SOUL-104** (Core EditEngine implementation) which depends on this ticket. The FileEditToolConfig provides the foundation for secure, validated file editing operations.\n\n## Story Points\nCompleted in **2 points** (as estimated)",
      "edited": false,
      "edit_count": 0,
      "is_ai_generated": false,
      "attachments": [],
      "attachment_count": 0
    }
  ],
  "attachments": [],
  "attachment_count": 0,
  "comment_count": 1,
  "story_points": 2,
  "order": 0,
  "custom_fields": {},
  "_archive_metadata": {
    "archived_at": "2025-11-16T08:16:44.219994",
    "archived_from_status": "done",
    "archived_by": "gira-cli"
  }
}