{
  "created_at": "2025-11-17T08:53:23.537765",
  "updated_at": "2025-11-20T04:23:22.883799Z",
  "id": "SOUL-134",
  "uuid": "1686b235-93fa-4ffb-88fe-a6e3e904c342",
  "title": "Consolidate local model providers into single 'Local' tab",
  "description": "",
  "status": "done",
  "type": "task",
  "priority": "medium",
  "labels": [],
  "assignee": "jared@goatbytes.io",
  "reporter": "jared@goatbytes.io",
  "blocked_by": [],
  "blocks": [],
  "comments": [
    {
      "created_at": "2025-11-17T10:00:41.217964",
      "updated_at": "2025-11-17T10:00:41.217965",
      "id": "20251117100041-0cc2c7e2",
      "ticket_id": "SOUL-134",
      "author": "jared@goatbytes.io",
      "content": "Completed local MLX model scanning:\n- Implemented get_local_mlx_models() to scan ~/.lmstudio/models\n- Scans for directories with config.json and .safetensors files\n- Displays local MLX models with size info\n- Shows alongside HuggingFace suggestions (no duplicates)\n- Users can now see their downloaded MLX models in the Local tab",
      "edited": false,
      "edit_count": 0,
      "is_ai_generated": false,
      "attachments": [],
      "attachment_count": 0
    },
    {
      "created_at": "2025-11-17T10:12:58.411990",
      "updated_at": "2025-11-17T10:12:58.411991",
      "id": "20251117101258-613b1f39",
      "ticket_id": "SOUL-134",
      "author": "jared@goatbytes.io",
      "content": "Fixed missing CSS for local model tables:\n- Added CSS for #tables-container\n- Added CSS for .section-label (Ollama/GGUF/MLX headers)\n- Added CSS for .local-table (individual tables)\n- Tables should now display correctly with proper spacing\n\nUsers should now see all GGUF and MLX models in the Local tab.",
      "edited": false,
      "edit_count": 0,
      "is_ai_generated": false,
      "attachments": [],
      "attachment_count": 0
    },
    {
      "created_at": "2025-11-17T10:15:59.509233",
      "updated_at": "2025-11-17T10:15:59.509235",
      "id": "20251117101559-c9e93a27",
      "ticket_id": "SOUL-134",
      "author": "jared@goatbytes.io",
      "content": "Fixed table initialization timing issue:\n- Added is_mounted check in watch_active_provider to prevent premature population\n- The reactive watcher was being triggered during __init__ before compose() ran\n- This caused 'No nodes match #ollama-table/gguf-table/mlx-table' errors\n- Now on_mount properly handles initial table building and population\n\nGGUF and MLX tables should now appear correctly in the Local tab.",
      "edited": false,
      "edit_count": 0,
      "is_ai_generated": false,
      "attachments": [],
      "attachment_count": 0
    },
    {
      "created_at": "2025-11-17T10:21:05.083536",
      "updated_at": "2025-11-17T10:21:05.083537",
      "id": "20251117102105-b96a71ce",
      "ticket_id": "SOUL-134",
      "author": "jared@goatbytes.io",
      "content": "Implemented sub-tabs for local providers:\n- Local tab now has Ollama/GGUF/MLX sub-tabs\n- Each sub-tab shows only models for that provider type\n- Fixes height/visibility issues - each table gets full available height\n- Click Ollama/GGUF/MLX tabs to switch between local model types\n- Much cleaner UX than trying to show all models in one scrollable list\n\nGGUF and MLX models should now be fully visible and usable.",
      "edited": false,
      "edit_count": 0,
      "is_ai_generated": false,
      "attachments": [],
      "attachment_count": 0
    },
    {
      "created_at": "2025-11-17T10:52:17.790487",
      "updated_at": "2025-11-17T10:52:17.790488",
      "id": "20251117105217-70b71082",
      "ticket_id": "SOUL-134",
      "author": "jared@goatbytes.io",
      "content": "Fixed MLX model initialization error:\n- ChatMLX in langchain-community 0.4.1 uses deprecated generate_step API incompatible with mlx-lm 0.28.3\n- Created custom MLXChatWrapper that bypasses deprecated APIs\n- Calls mlx-lm's generate() directly without formatter argument\n- Test script confirms MLX models now load and generate responses successfully\n- Users can now use local MLX models in the TUI without 'AI model not initialized' error",
      "edited": false,
      "edit_count": 0,
      "is_ai_generated": false,
      "attachments": [],
      "attachment_count": 0
    },
    {
      "created_at": "2025-11-17T11:11:35.734085",
      "updated_at": "2025-11-17T11:11:35.734086",
      "id": "20251117111135-b96c76c2",
      "ticket_id": "SOUL-134",
      "author": "jared@goatbytes.io",
      "content": "Fixed validation error when switching to MLX model:\n- ProviderConfig.default_max_tokens can be None\n- get_current_model_config() was passing None to MLXModelConfig which requires int\n- Fixed by only including max_tokens in model_params if it's not None\n- MLXModelConfig now uses its default value (2048) when not specified\n- Model switching should now work without validation errors",
      "edited": false,
      "edit_count": 0,
      "is_ai_generated": false,
      "attachments": [],
      "attachment_count": 0
    },
    {
      "created_at": "2025-11-17T12:24:39.110649",
      "updated_at": "2025-11-17T12:24:39.110649",
      "id": "20251117122439-4998a9a3",
      "ticket_id": "SOUL-134",
      "author": "jared@goatbytes.io",
      "content": "Improved model picker to respect API key availability:\n- HuggingFace popular models (from MODEL_INFO database) now only shown if HF_TOKEN or HUGGINGFACE_API_KEY env var is set\n- MLX popular models (from mlx-community) now only shown if HuggingFace API key is available\n- Local models (cached HF models, GGUF, local MLX) still shown regardless of API key\n- Users without HF API key will only see locally available models in HF and MLX tabs\n- Prevents suggesting models that require downloading without authentication",
      "edited": false,
      "edit_count": 0,
      "is_ai_generated": false,
      "attachments": [],
      "attachment_count": 0
    },
    {
      "created_at": "2025-11-17T12:28:41.517602",
      "updated_at": "2025-11-17T12:28:41.517603",
      "id": "20251117122841-87d27ba4",
      "ticket_id": "SOUL-134",
      "author": "jared@goatbytes.io",
      "content": "Added HuggingFace API key support to config system:\n- Added huggingface_api_key and hf_token fields to EnvSettings in env.py\n- Updated get_api_key() to return HuggingFace token from either field\n- Model picker now uses get_api_key() instead of checking os.getenv() directly\n- Users can now set HF API key in .env file or environment variables:\n  - HUGGINGFACE_API_KEY=hf_xxx (in .env or ~/.consoul/.env)\n  - HF_TOKEN=hf_xxx (alternative name)\n- Consistent with how other provider API keys are handled",
      "edited": false,
      "edit_count": 0,
      "is_ai_generated": false,
      "attachments": [],
      "attachment_count": 0
    },
    {
      "created_at": "2025-11-17T12:36:22.219011",
      "updated_at": "2025-11-17T12:36:22.219011",
      "id": "20251117123622-ec78d08f",
      "ticket_id": "SOUL-134",
      "author": "jared@goatbytes.io",
      "content": "Fixed DuplicateIds crash when switching provider tabs:\n- Issue: When switching tabs, _rebuild_tables_container() removed children but container._nodes still had references\n- This caused 'models-table' ID collision when mounting new table\n- Fix: Added container._nodes.clear() after removing children\n- Ensures container is completely empty before mounting new widgets\n- Tab switching now works without crashes",
      "edited": false,
      "edit_count": 0,
      "is_ai_generated": false,
      "attachments": [],
      "attachment_count": 0
    },
    {
      "created_at": "2025-11-17T12:39:29.330547",
      "updated_at": "2025-11-17T12:39:29.330548",
      "id": "20251117123929-83e42220",
      "ticket_id": "SOUL-134",
      "author": "jared@goatbytes.io",
      "content": "Updated DuplicateIds fix to use proper Textual API:\n- Changed from container._nodes.clear() (which is read-only) to container.remove_children()\n- remove_children() is the correct Textual API method for clearing all child widgets\n- Added fallback to manual removal if remove_children() fails\n- Should now properly clear container before mounting new widgets",
      "edited": false,
      "edit_count": 0,
      "is_ai_generated": false,
      "attachments": [],
      "attachment_count": 0
    },
    {
      "created_at": "2025-11-17T12:41:11.364167",
      "updated_at": "2025-11-17T12:41:11.364168",
      "id": "20251117124111-8abe1865",
      "ticket_id": "SOUL-134",
      "author": "jared@goatbytes.io",
      "content": "Fixed DuplicateIds by targeting specific widgets for removal:\n- remove_children() wasn't working reliably - widgets weren't removed before new ones mounted\n- Changed to query and remove specific widgets by ID: #models-table and #local-provider-tabs\n- This ensures old widgets are removed before creating new ones with same IDs\n- More surgical approach - only removes what needs to be replaced\n- Should prevent ID collisions when switching tabs",
      "edited": false,
      "edit_count": 0,
      "is_ai_generated": false,
      "attachments": [],
      "attachment_count": 0
    },
    {
      "created_at": "2025-11-17T12:44:11.991937",
      "updated_at": "2025-11-17T12:44:11.991938",
      "id": "20251117124411-8768b884",
      "ticket_id": "SOUL-134",
      "author": "jared@goatbytes.io",
      "content": "Final DuplicateIds fix implemented using unique table IDs:\n- Local tab uses id='local-models-table'\n- Non-local providers use id='provider-models-table'\n- _rebuild_tables_container() removes both possible IDs before mounting\n- Avoids ID conflicts entirely since different contexts use different IDs\n- Should fix crash when switching between provider tabs\n\nThis replaces previous failed attempts:\n1. container._nodes.clear() - failed (read-only)\n2. container.remove_children() - failed (widgets still present)\n3. Query and remove by ID - failed (asynchronous removal)\n\nThe unique ID approach ensures no conflicts even if widget removal is delayed.",
      "edited": false,
      "edit_count": 0,
      "is_ai_generated": false,
      "attachments": [],
      "attachment_count": 0
    },
    {
      "created_at": "2025-11-17T13:24:53.803067",
      "updated_at": "2025-11-17T13:24:53.803067",
      "id": "20251117132453-7efbf64c",
      "ticket_id": "SOUL-134",
      "author": "jared@goatbytes.io",
      "content": "Fixed DuplicateIds crash (again) with more reliable widget removal.\n\nPrevious fix using unique IDs still had timing issues because .remove() is async.\n\nNew approach (lines 611-616):\n- Directly manipulate container._nodes NodeList\n- Use while loop to remove all children: container._nodes._remove(child)\n- Synchronous removal prevents ID conflicts\n\nThis is more reliable than:\n1. remove_children() - didn't work\n2. Query and .remove() by ID - async timing issues\n3. Different IDs for different contexts - still had conflicts\n\nResult: Tab switching should work without DuplicateIds errors.",
      "edited": false,
      "edit_count": 0,
      "is_ai_generated": false,
      "attachments": [],
      "attachment_count": 0
    }
  ],
  "attachments": [],
  "attachment_count": 0,
  "comment_count": 13,
  "order": 0,
  "custom_fields": {},
  "_archive_metadata": {
    "archived_at": "2025-11-19T20:23:42.178045",
    "archived_from_status": "done",
    "archived_by": "gira-cli"
  }
}