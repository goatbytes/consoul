{
  "created_at": "2025-11-09T13:48:40.823514",
  "updated_at": "2025-11-11T04:27:46.250376Z",
  "id": "SOUL-31",
  "uuid": "8f13d4dc-8ff1-4e38-8ea1-da560ea80a3e",
  "title": "Enhanced conversation export/import with multiple formats",
  "description": "**As a** Consoul user\n**I want** to export and import conversations in various formats\n**So that** I can share conversations, migrate between systems, and integrate with other tools\n\n**Context:**\nUsers need to share conversations (with colleagues, for documentation), backup data, or migrate between systems. Support multiple export formats (JSON, Markdown, HTML, CSV) for different use cases.\n\n**Technical Notes:**\n- **Files to create**: `src/consoul/cli/export.py`, `src/consoul/formatters/`\n- **Files to modify**: `src/consoul/__main__.py` (add export/import commands)\n- **Formats**: JSON (structured), Markdown (readable), HTML (shareable), CSV (analytics)\n- **Import**: Support Consoul's own JSON format for backup/restore\n- **Attachments**: Handle code blocks, metadata\n\n**Acceptance Criteria:**\n\n**Given** I have a conversation in history\n**When** I run `consoul history export <session-id> --format json`\n**Then** conversation is exported to JSON with full metadata\n\n**Given** I want readable format\n**When** I run `consoul history export <session-id> --format markdown`\n**Then** conversation is exported as formatted Markdown with timestamps\n\n**Given** I want to share conversation\n**When** I run `consoul history export <session-id> --format html`\n**Then** standalone HTML file is created with styling\n\n**Given** I want analytics data\n**When** I run `consoul history export <session-id> --format csv`\n**Then** messages exported to CSV with columns: timestamp, role, content, tokens\n\n**Given** I want to export multiple conversations\n**When** I run `consoul history export --all --format json`\n**Then** all conversations exported to single JSON file\n\n**Given** I have a Consoul export JSON\n**When** I run `consoul history import backup.json`\n**Then** conversations are imported with metadata preserved\n\n**Testing Considerations:**\n- Test each export format with various conversation types\n- Verify Unicode handling (emojis, special characters)\n- Test large conversation export (10k+ messages)\n- Test import with malformed data (graceful error handling)\n- Verify round-trip (export \u2192 import \u2192 export produces identical output)\n- Test empty conversations, conversations with only system message\n\n**Implementation Hints:**\n\n```python\n# src/consoul/formatters/json.py\nimport json\nfrom datetime import datetime\nfrom pathlib import Path\n\ndef export_to_json(conversation: dict, output_path: Path | None = None) -> str:\n    \"\"\"Export conversation to JSON format.\"\"\"\n    \n    data = {\n        \"version\": \"1.0\",\n        \"exported_at\": datetime.utcnow().isoformat(),\n        \"conversation\": {\n            \"session_id\": conversation[\"session_id\"],\n            \"model\": conversation[\"model\"],\n            \"created_at\": conversation[\"created_at\"],\n            \"updated_at\": conversation[\"updated_at\"],\n            \"message_count\": len(conversation[\"messages\"]),\n            \"total_tokens\": sum(m[\"tokens\"] or 0 for m in conversation[\"messages\"]),\n        },\n        \"messages\": [\n            {\n                \"role\": msg[\"role\"],\n                \"content\": msg[\"content\"],\n                \"tokens\": msg[\"tokens\"],\n                \"timestamp\": msg[\"timestamp\"]\n            }\n            for msg in conversation[\"messages\"]\n        ]\n    }\n    \n    json_str = json.dumps(data, indent=2, ensure_ascii=False)\n    \n    if output_path:\n        output_path.write_text(json_str, encoding=\"utf-8\")\n    \n    return json_str\n\n# src/consoul/formatters/markdown.py\ndef export_to_markdown(conversation: dict, output_path: Path | None = None) -> str:\n    \"\"\"Export conversation to Markdown format.\"\"\"\n    \n    lines = [\n        f\"# Conversation: {conversation['session_id']}\",\n        \"\",\n        f\"**Model**: {conversation['model']}  \",\n        f\"**Created**: {conversation['created_at']}  \",\n        f\"**Messages**: {len(conversation['messages'])}  \",\n        f\"**Total Tokens**: {sum(m['tokens'] or 0 for m in conversation['messages'])}  \",\n        \"\",\n        \"---\",\n        \"\",\n    ]\n    \n    for msg in conversation[\"messages\"]:\n        role_emoji = {\n            \"system\": \"\u2699\ufe0f\",\n            \"user\": \"\ud83d\udc64\",\n            \"assistant\": \"\ud83e\udd16\"\n        }.get(msg[\"role\"], \"\u2753\")\n        \n        lines.extend([\n            f\"## {role_emoji} {msg['role'].title()}\",\n            \"\",\n            f\"*{msg['timestamp']}* | *{msg['tokens'] or 0} tokens*\",\n            \"\",\n            msg[\"content\"],\n            \"\",\n            \"---\",\n            \"\",\n        ])\n    \n    markdown = \"\\n\".join(lines)\n    \n    if output_path:\n        output_path.write_text(markdown, encoding=\"utf-8\")\n    \n    return markdown\n\n# src/consoul/formatters/html.py\nHTML_TEMPLATE = \"\"\"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Consoul Conversation - {session_id}</title>\n    <style>\n        body {{ font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif; \n               max-width: 800px; margin: 40px auto; padding: 0 20px; }}\n        .header {{ background: #f0f0f0; padding: 20px; border-radius: 8px; margin-bottom: 30px; }}\n        .message {{ margin: 20px 0; padding: 15px; border-radius: 8px; }}\n        .system {{ background: #fff3cd; }}\n        .user {{ background: #d1ecf1; }}\n        .assistant {{ background: #d4edda; }}\n        .meta {{ color: #666; font-size: 0.9em; margin-bottom: 10px; }}\n        pre {{ background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }}\n        code {{ background: #f8f9fa; padding: 2px 4px; border-radius: 3px; }}\n    </style>\n</head>\n<body>\n    <div class=\"header\">\n        <h1>Consoul Conversation</h1>\n        <p><strong>Session:</strong> {session_id}</p>\n        <p><strong>Model:</strong> {model}</p>\n        <p><strong>Created:</strong> {created_at}</p>\n        <p><strong>Messages:</strong> {message_count} | <strong>Tokens:</strong> {total_tokens}</p>\n    </div>\n    {messages}\n</body>\n</html>\"\"\"\n\ndef export_to_html(conversation: dict, output_path: Path | None = None) -> str:\n    \"\"\"Export conversation to HTML format.\"\"\"\n    import html\n    \n    messages_html = []\n    for msg in conversation[\"messages\"]:\n        content = html.escape(msg['content']).replace('\\n', '<br>')\n        messages_html.append(f\"\"\"\n    <div class=\"message {msg['role']}\">\n        <div class=\"meta\">\n            <strong>{msg['role'].title()}</strong> | \n            {msg['timestamp']} | \n            {msg['tokens'] or 0} tokens\n        </div>\n        <div class=\"content\">{content}</div>\n    </div>\n        \"\"\")\n    \n    html_output = HTML_TEMPLATE.format(\n        session_id=conversation[\"session_id\"],\n        model=conversation[\"model\"],\n        created_at=conversation[\"created_at\"],\n        message_count=len(conversation[\"messages\"]),\n        total_tokens=sum(m[\"tokens\"] or 0 for m in conversation[\"messages\"]),\n        messages=\"\\n\".join(messages_html)\n    )\n    \n    if output_path:\n        output_path.write_text(html_output, encoding=\"utf-8\")\n    \n    return html_output\n\n# Import from Consoul JSON format\ndef import_from_json(json_path: Path, db: ConversationDatabase) -> str:\n    \"\"\"Import conversation from Consoul JSON export.\"\"\"\n    \n    data = json.loads(json_path.read_text())\n    \n    # Validate version\n    if data.get(\"version\") != \"1.0\":\n        raise ValueError(f\"Unsupported export version: {data.get('version')}\")\n    \n    # Create conversation\n    conv = data[\"conversation\"]\n    session_id = db.create_conversation(\n        model=conv[\"model\"],\n        session_id=conv.get(\"session_id\")  # Preserve original if provided\n    )\n    \n    # Import messages\n    for msg in data[\"messages\"]:\n        db.save_message(\n            session_id=session_id,\n            role=msg[\"role\"],\n            content=msg[\"content\"],\n            tokens=msg.get(\"tokens\")\n        )\n    \n    return session_id\n```\n\n**CLI Commands:**\n\n```bash\n# Export single conversation (already implemented in history export command)\nconsoul history export <session-id> -o conversation.json\nconsoul history export <session-id> --format markdown -o conversation.md\nconsoul history export <session-id> --format html -o conversation.html\nconsoul history export <session-id> --format csv -o conversation.csv\n\n# Export to stdout (for piping)\nconsoul history export <session-id> --format json\n\n# Export all conversations\nconsoul history export --all --format json -o backup.json\n\n# Import conversations\nconsoul history import backup.json\n\n# Import with dry-run (validate without importing)\nconsoul history import backup.json --dry-run\n```\n\n**Export Formats:**\n\n1. **JSON**: Full structured data, machine-readable, supports round-trip\n2. **Markdown**: Human-readable, good for documentation\n3. **HTML**: Shareable standalone file with styling\n4. **CSV**: Analytics-friendly, importable to Excel/Google Sheets\n\n**Note:** The basic JSON export is already implemented in the existing `history export` command. This ticket extends it to support Markdown, HTML, CSV formats and adds import functionality.\n\n**Configuration:**\n\n```yaml\n# ~/.config/consoul/config.yaml\nexport:\n  default_format: json\n  include_metadata: true\n  include_tokens: true\n```\n\n**Dependencies:**\n- SOUL-27 (SQLite persistence - completed)\n\n**Security Considerations:**\n- Sanitize HTML output (escape user content)\n- Validate imported JSON schema\n- Don't export API keys or sensitive metadata",
  "status": "done",
  "type": "feature",
  "priority": "low",
  "labels": [
    "export",
    "import",
    "history",
    "interoperability"
  ],
  "assignee": "jared@goatbytes.io",
  "reporter": "jared@goatbytes.io",
  "epic_id": "EPIC-002",
  "blocked_by": [],
  "blocks": [],
  "comments": [
    {
      "created_at": "2025-11-09T15:53:41.674062",
      "updated_at": "2025-11-09T15:53:41.674063",
      "id": "20251109155341-95bb4183",
      "ticket_id": "SOUL-31",
      "author": "jared@goatbytes.io",
      "content": "\ud83d\udd27 Updated Ticket - Removed Third-Party Tool Dependencies\n\nSimplified the ticket to focus on Consoul's core export/import functionality.\n\n## Changes Made\n\n**Removed:**\n- aider-specific import format\n- ChatGPT import format  \n- llm tool integration\n- GitHub Gist integration\n- External tool dependencies\n\n**Kept:**\n- Core export formats: JSON, Markdown, HTML, CSV\n- Import from Consoul's own JSON format (for backup/restore)\n- Round-trip support (export \u2192 import \u2192 export)\n- All existing `history export` CLI command functionality\n\n## Rationale\n\n1. **Scope Reduction**: Focus on Consoul's own data portability first\n2. **Maintainability**: Don't couple to other tools' export formats (which may change)\n3. **Simpler Implementation**: JSON round-trip is the core requirement\n4. **User Flexibility**: Users can manually transform other formats to Consoul JSON if needed\n\n## Future Enhancements\n\nIf users specifically request integrations with other tools (ChatGPT, etc.), we can add those as separate tickets. For now, keeping it simple with:\n- Export: JSON, Markdown, HTML, CSV\n- Import: Consoul JSON only\n\nThe existing `consoul history export` command already handles basic JSON/text export, so this ticket mainly adds Markdown, HTML, CSV formats plus proper import.",
      "edited": false,
      "edit_count": 0,
      "is_ai_generated": false,
      "attachments": [],
      "attachment_count": 0
    }
  ],
  "attachments": [],
  "attachment_count": 0,
  "comment_count": 1,
  "story_points": 3,
  "order": 0,
  "custom_fields": {},
  "_archive_metadata": {
    "archived_at": "2025-11-14T23:28:32.010495",
    "archived_from_status": "done",
    "archived_by": "gira-cli"
  }
}