{
  "created_at": "2025-11-09T19:46:32.578745",
  "updated_at": "2025-11-11T04:27:46.249431Z",
  "id": "SOUL-33",
  "uuid": "15ec611f-62f6-41e1-a8eb-bb0304af0557",
  "title": "Create TUI-specific Pydantic configuration model",
  "description": "# Create TUI-Specific Pydantic Configuration Model\n\n## User Story\n**As a** Consoul user\n**I want** TUI-specific configuration options\n**So that** I can customize the TUI appearance and behavior without affecting core AI functionality\n\n## Description\n\nCreate a Pydantic v2 model for TUI-specific configuration following the pattern established in `src/consoul/config/models.py`. This extends the existing configuration system with TUI settings while maintaining clean separation from core library config. The TUI config will be embedded in the main ConsoulConfig model but is only loaded when the TUI is actually used.\n\n## Context\n\nResearch (TUI_RESEARCH.md \u00a76) shows that TUI configuration should cover:\n- Theme selection and customization\n- GC management strategy (streaming-aware, manual, auto)\n- Display preferences (timestamps, token counts, sidebar visibility)\n- Performance tuning (buffer sizes, debounce delays, virtualization)\n- Keyboard/mouse behavior\n\nThe existing config system (SOUL-16, SOUL-17) uses Pydantic v2 with strict validation. The TUI config must follow the same patterns and integrate seamlessly.\n\n**Key Reference:** TUI_RESEARCH.md \"Design Decisions Post-Review\" \u00a72 (GC Management Policy)\n\n## Technical Notes\n\n**File to Create:** `src/consoul/tui/config.py`\n\n**Pydantic Models:**\n\n```python\nfrom pydantic import BaseModel, Field\nfrom typing import Literal\n\nclass TuiConfig(BaseModel):\n    \"\"\"TUI-specific configuration.\n\n    Controls appearance, behavior, and performance of the Textual TUI.\n    These settings are independent of core AI configuration.\n    \"\"\"\n\n    # Theme and Appearance\n    theme: str = Field(default=\"monokai\", description=\"TUI color theme\")\n    show_sidebar: bool = Field(default=True, description=\"Show conversation list sidebar\")\n    sidebar_width: str = Field(default=\"30%\", description=\"Sidebar width (CSS units)\")\n    show_timestamps: bool = Field(default=True, description=\"Show message timestamps\")\n    show_token_count: bool = Field(default=True, description=\"Show token usage in messages\")\n\n    # Performance\n    gc_mode: Literal[\"auto\", \"manual\", \"streaming-aware\"] = Field(\n        default=\"streaming-aware\",\n        description=\"Garbage collection strategy\"\n    )\n    gc_interval_seconds: float = Field(\n        default=30.0,\n        ge=5.0,\n        le=300.0,\n        description=\"Interval for idle GC (manual/streaming-aware modes)\"\n    )\n    gc_generation: int = Field(\n        default=0,\n        ge=0,\n        le=2,\n        description=\"GC generation to collect (0=young, 1=middle, 2=all)\"\n    )\n\n    # Streaming Behavior\n    stream_buffer_size: int = Field(\n        default=200,\n        ge=50,\n        le=1000,\n        description=\"Characters to buffer before rendering\"\n    )\n    stream_debounce_ms: int = Field(\n        default=150,\n        ge=50,\n        le=500,\n        description=\"Milliseconds to debounce markdown renders\"\n    )\n    stream_renderer: Literal[\"markdown\", \"richlog\", \"hybrid\"] = Field(\n        default=\"markdown\",\n        description=\"Widget type for streaming responses\"\n    )\n\n    # Conversation List\n    initial_conversation_load: int = Field(\n        default=50,\n        ge=10,\n        le=200,\n        description=\"Number of conversations to load initially\"\n    )\n    enable_virtualization: bool = Field(\n        default=True,\n        description=\"Use virtual scrolling for large lists\"\n    )\n\n    # Input Behavior\n    enable_multiline_input: bool = Field(\n        default=True,\n        description=\"Allow multi-line input with shift+enter\"\n    )\n    input_syntax_highlighting: bool = Field(\n        default=True,\n        description=\"Syntax highlighting in input area\"\n    )\n\n    # Mouse and Keyboard\n    enable_mouse: bool = Field(default=True, description=\"Enable mouse interactions\")\n    vim_mode: bool = Field(default=False, description=\"Enable vim-style navigation\")\n\n    class Config:\n        extra = \"forbid\"  # Catch typos in config files\n```\n\n**Integration with Main Config:**\n\n```python\n# src/consoul/config/models.py (to be updated)\nfrom consoul.tui.config import TuiConfig\n\nclass ConsoulConfig(BaseModel):\n    # ... existing fields ...\n    tui: TuiConfig = Field(default_factory=TuiConfig, description=\"TUI-specific settings\")\n```\n\n**Key Considerations:**\n- Use Pydantic v2 syntax (Field with default, ge/le validators)\n- Include comprehensive descriptions for auto-documentation\n- Use Literal types for enum-like choices\n- Set `extra=\"forbid\"` to catch typos\n- Follow existing config patterns from SOUL-16\n\n## Acceptance Criteria\n\n**Given** I create a TuiConfig instance with defaults\n**When** I access config.theme\n**Then** it returns \"monokai\"\n\n**Given** I create a TuiConfig with invalid gc_mode\n**When** I try TuiConfig(gc_mode=\"invalid\")\n**Then** Pydantic raises ValidationError\n\n**Given** I set gc_interval_seconds to 3.0 (below minimum)\n**When** validation runs\n**Then** Pydantic raises ValidationError with \"greater than or equal to 5.0\"\n\n**Given** I have a YAML config with TUI settings\n**When** I load it via ConsoulConfig\n**Then** config.tui contains the TUI-specific settings\n\n**Given** I have TuiConfig in config\n**When** I serialize to YAML\n**Then** the tui section is properly formatted with defaults excluded\n\n## Testing Considerations\n\n- Unit tests for TuiConfig validation\n- Test field validators (ge/le constraints)\n- Test Literal enum validation\n- Test default values\n- Test integration with ConsoulConfig\n- Test YAML serialization/deserialization\n- Test `extra=\"forbid\"` behavior\n\n**Test File:** `tests/config/test_tui_config.py`\n\n```python\nimport pytest\nfrom pydantic import ValidationError\nfrom consoul.tui.config import TuiConfig\n\ndef test_default_config():\n    \"\"\"Test TuiConfig with default values.\"\"\"\n    config = TuiConfig()\n    assert config.theme == \"monokai\"\n    assert config.gc_mode == \"streaming-aware\"\n    assert config.stream_buffer_size == 200\n\ndef test_gc_interval_validation():\n    \"\"\"Test gc_interval_seconds bounds.\"\"\"\n    # Valid\n    config = TuiConfig(gc_interval_seconds=10.0)\n    assert config.gc_interval_seconds == 10.0\n\n    # Too low\n    with pytest.raises(ValidationError):\n        TuiConfig(gc_interval_seconds=3.0)\n\ndef test_invalid_gc_mode():\n    \"\"\"Test invalid gc_mode is rejected.\"\"\"\n    with pytest.raises(ValidationError):\n        TuiConfig(gc_mode=\"invalid\")\n\ndef test_extra_fields_forbidden():\n    \"\"\"Test that typos in config are caught.\"\"\"\n    with pytest.raises(ValidationError):\n        TuiConfig(themee=\"dark\")  # typo\n```\n\n## Implementation Hints\n\n1. Start with `src/consoul/tui/config.py`\n2. Define TuiConfig with all fields and validators\n3. Add comprehensive docstrings\n4. Update `src/consoul/config/models.py` to include tui field\n5. Create unit tests\n6. Run mypy and ruff to ensure type safety\n7. Test with sample YAML config\n\n**Sample YAML Integration:**\n\n```yaml\n# ~/.config/consoul/config.yaml\nprofiles:\n  default:\n    model: \"gpt-4o\"\n    temperature: 0.7\n\ntui:\n  theme: \"dracula\"\n  gc_mode: \"streaming-aware\"\n  stream_buffer_size: 250\n  show_timestamps: false\n```\n\n## Files to Create/Modify\n\n**New Files:**\n- src/consoul/tui/config.py\n- tests/config/test_tui_config.py\n\n**Modified Files:**\n- src/consoul/config/models.py (add tui field to ConsoulConfig)\n\n## Dependencies\n\n**Prerequisites:**\n- SOUL-16 complete (Pydantic config models exist)\n- SOUL-32 complete (tui/ directory exists)\n\n**Blocks:**\n- SOUL-34 (ConsoulApp will use TuiConfig)",
  "status": "done",
  "type": "feature",
  "priority": "high",
  "labels": [
    "tui",
    "config",
    "pydantic"
  ],
  "assignee": "jared@goatbytes.io",
  "reporter": "jared@goatbytes.io",
  "epic_id": "EPIC-003",
  "blocked_by": [],
  "blocks": [],
  "comments": [],
  "attachments": [],
  "attachment_count": 0,
  "comment_count": 0,
  "story_points": 3,
  "order": 0,
  "custom_fields": {},
  "_archive_metadata": {
    "archived_at": "2025-11-14T23:28:35.001063",
    "archived_from_status": "done",
    "archived_by": "gira-cli"
  }
}