{
  "created_at": "2025-11-12T22:38:31.244102",
  "updated_at": "2025-11-18T22:21:07.217701",
  "id": "SOUL-77",
  "uuid": "f814a921-111f-4526-a419-72f219567e76",
  "title": "Implement ConversationConfig support in TUI",
  "description": "**As a** Consoul TUI user\n**I want** the TUI to respect ConversationConfig settings from my profile\n**So that** I can control conversation persistence, summarization, and retention without modifying code\n\n**Context:**\nCurrently, the TUI (src/consoul/tui/app.py) hardcodes conversation settings and ignores the ProfileConfig.conversation settings. The ConversationHistory class fully supports all ConversationConfig options (persist, db_path, auto_resume, retention_days, summarize, summarize_threshold, keep_recent, summary_model), and the SDK examples demonstrate proper usage (examples/interactive_chat.py:167-199).\n\nThe TUI creates ConversationHistory in 3 places:\n- app.py:188 - Initial conversation creation\n- app.py:1327 - New conversation after clear\n- app.py:1566 - Resume conversation by ID\n\nAll three locations hardcode `persist=True` and ignore all other ConversationConfig settings.\n\n**Research:**\n- ConversationConfig model: src/consoul/config/models.py:253-297\n- ProfileConfig includes conversation: src/consoul/config/models.py:578-580\n- ConversationHistory constructor: src/consoul/ai/history.py:184-229\n- SDK reference implementation: examples/interactive_chat.py:167-199\n- Built-in profile defaults: src/consoul/config/profiles.py:29-44\n\n**Technical Notes:**\n- ProfileConfig contains ConversationConfig at `profile.conversation`\n- ConversationHistory supports all 8 config options\n- SDK example shows correct pattern for reading from profile\n- Need to handle auto_resume on TUI startup\n- Need to implement retention_days cleanup (currently defined but not used)\n- summary_model requires get_chat_model() call if specified\n\n**Files to modify:**\n- src/consoul/tui/app.py:188 - Initial conversation setup\n- src/consoul/tui/app.py:1327 - New conversation after clear\n- src/consoul/tui/app.py:1566 - Resume conversation\n- src/consoul/tui/app.py - Add auto_resume logic on startup\n- Possibly add cleanup task for retention_days\n\n**Acceptance Criteria:**\n\n**Given** I have a profile with `conversation.persist: false`\n**When** I start the TUI with that profile\n**Then** conversations are not persisted to SQLite\n\n**Given** I have a profile with `conversation.auto_resume: true`\n**When** I start the TUI\n**Then** the last conversation is automatically loaded\n\n**Given** I have a profile with `conversation.summarize: true` and `summarize_threshold: 15`\n**When** conversation reaches 15 messages\n**Then** older messages are automatically summarized\n\n**Given** I have a profile with custom `db_path`\n**When** I use that profile\n**Then** conversations are saved to the custom database path\n\n**Given** I have a profile with `retention_days: 30`\n**When** conversations older than 30 days exist\n**Then** they are automatically cleaned up\n\n**Given** I have a profile with `summary_model: \"gpt-4o-mini\"`\n**When** summarization occurs\n**Then** the cheaper model is used for summarization\n\n**Testing Considerations:**\n- Test each ConversationConfig setting individually\n- Test auto_resume with/without existing conversations\n- Test summarization threshold triggering\n- Test custom db_path creation and permissions\n- Test retention_days cleanup logic\n- Mock get_chat_model for summary_model tests\n- Verify backward compatibility (users with no profile settings)\n\n**Implementation Hints:**\n1. Read profile.conversation settings in app.py compose()\n2. Pass all 8 ConversationHistory constructor args from profile\n3. Implement auto_resume logic before showing main screen\n4. Add retention cleanup on startup or background task\n5. Handle summary_model with get_chat_model() call\n6. Follow pattern from examples/interactive_chat.py:167-199\n7. Default to current behavior if profile.conversation not set\n\n**Reference Implementation:**\nSee examples/interactive_chat.py:167-199 for SDK pattern:\n```python\nuse_summarize = profile.conversation.summarize\nuse_threshold = profile.conversation.summarize_threshold\nuse_keep_recent = profile.conversation.keep_recent\n\nsummary_chat_model = None\nif profile.conversation.summary_model:\n    summary_chat_model = get_chat_model(profile.conversation.summary_model, config=config)\n\nhistory = ConversationHistory(\n    model_name=profile.model.model,\n    model=chat_model,\n    persist=profile.conversation.persist,\n    db_path=profile.conversation.db_path,\n    summarize=use_summarize,\n    summarize_threshold=use_threshold,\n    keep_recent=use_keep_recent,\n    summary_model=summary_chat_model,\n)\n```",
  "status": "done",
  "type": "feature",
  "priority": "medium",
  "labels": [
    "tui",
    "config",
    "enhancement"
  ],
  "assignee": "jared@goatbytes.io",
  "reporter": "jared@goatbytes.io",
  "blocked_by": [],
  "blocks": [],
  "comments": [
    {
      "created_at": "2025-11-18T21:13:09.198583",
      "updated_at": "2025-11-18T21:13:09.198585",
      "id": "20251118211309-c65b2c9e",
      "ticket_id": "SOUL-77",
      "author": "jared@goatbytes.io",
      "content": "Implementation complete. All ConversationConfig settings now supported in TUI:\n\n\u2705 Added delete_conversations_older_than() to ConversationDatabase\n\u2705 Created _get_conversation_config() helper in TUI app  \n\u2705 Updated all 3 ConversationHistory creation points to use profile settings\n\u2705 Implemented auto_resume on startup\n\u2705 Implemented retention_days cleanup on startup\n\u2705 Added comprehensive tests for retention cleanup\n\nFiles modified:\n- src/consoul/ai/database.py: Added retention cleanup method\n- src/consoul/tui/app.py: Integrated all ConversationConfig settings\n- tests/ai/test_database.py: Added retention cleanup tests\n\nAll acceptance criteria met. Ready for testing in TUI.",
      "edited": false,
      "edit_count": 0,
      "is_ai_generated": false,
      "attachments": [],
      "attachment_count": 0
    },
    {
      "created_at": "2025-11-18T21:31:26.365117",
      "updated_at": "2025-11-18T21:31:26.365117",
      "id": "20251118213126-cebede19",
      "ticket_id": "SOUL-77",
      "author": "jared@goatbytes.io",
      "content": "Additional fixes applied based on code review:\n\n\ud83d\udc1b Fixed critical bug: ConversationList sidebar now uses profile.conversation.db_path\n  - Previously used default path, causing UI to show incorrect/empty history\n  - Now properly reads from the same database as conversations\n  - Location: src/consoul/tui/app.py:590-600\n\n\ud83d\udcdd Fixed documentation: Removed stray footnote markers from example-prompts.md\n  - Lines 65 and 75 had .1 and .2 markers without definitions\n  - Cleaned up for proper rendering\n\nAll issues resolved. Implementation complete and tested.",
      "edited": false,
      "edit_count": 0,
      "is_ai_generated": false,
      "attachments": [],
      "attachment_count": 0
    },
    {
      "created_at": "2025-11-18T22:21:07.217625",
      "updated_at": "2025-11-18T22:21:07.217626",
      "id": "20251118222107-314afe4a",
      "ticket_id": "SOUL-77",
      "author": "jared@goatbytes.io",
      "content": "Final fix applied - honors persist=false setting:\n\n\ud83d\udd12 Sidebar now respects profile.conversation.persist setting\n  - When persist=false, sidebar is completely skipped\n  - Prevents hitting SQLite DB when persistence is disabled\n  - Matches new config semantics throughout TUI\n  - Location: src/consoul/tui/app.py:587-609\n\n\u2705 Verified footnote markers fully removed from docs/example-prompts.md\n  - Lines 65 and 75 confirmed clean\n  - No remaining .1 or .2 markers\n\nAll code review issues resolved. Implementation is complete and respects all ConversationConfig settings consistently.",
      "edited": false,
      "edit_count": 0,
      "is_ai_generated": false,
      "attachments": [],
      "attachment_count": 0
    }
  ],
  "attachments": [],
  "attachment_count": 0,
  "comment_count": 3,
  "story_points": 5,
  "order": 0,
  "custom_fields": {},
  "_archive_metadata": {
    "archived_at": "2025-11-19T20:23:41.430887",
    "archived_from_status": "done",
    "archived_by": "gira-cli"
  }
}