{
  "created_at": "2025-11-13T08:39:30.379988",
  "updated_at": "2025-11-14T07:47:39.543955Z",
  "id": "SOUL-81",
  "uuid": "83f1eeb0-54f2-4577-9398-a728bc0a5ed4",
  "title": "Add PDF support with page extraction to read tool",
  "description": "**As a** Consoul user\n**I want** to read PDF documents with page markers\n**So that** AI can access documentation, research papers, and PDF-based resources\n\n**Context:**\nMany codebases include PDF documentation, design specs, and research papers. The read tool should extract text from PDFs with clear page boundaries. Research shows:\n- Claude Code Read tool supports PDFs with visual presentation\n- MCP servers use MIME detection and handle PDFs specially\n- Page markers help AI understand document structure\n- Not all PDFs have extractable text (scanned PDFs)\n\n**Technical Notes:**\n- Add PDF support to src/consoul/ai/tools/implementations/read.py\n- Use PyPDF2 or pdfplumber (add as optional dependency)\n- Detect .pdf extension to trigger PDF handling\n- Insert page markers: \"=== Page N ===\"\n- Support start_page/end_page parameters (like offset/limit for text)\n- Add to pyproject.toml [tool.poetry.group.pdf.dependencies] (optional group)\n- Respect config.enable_pdf and config.pdf_max_pages\n\n**Research References:**\n- PyPDF2 docs: https://pypdf2.readthedocs.io/en/3.x/user/extract-text.html\n- Example from ChatGPT research: for i, page in enumerate(reader.pages, start=1)\n- MCP server approach: Check file size, return references for large files\n\n**Acceptance Criteria:**\n\n**Given** a PDF file with extractable text\n**When** read_file(file_path=\"docs/design.pdf\") is called\n**Then** text is extracted with \"=== Page N ===\" markers between pages\n\n**Given** a PDF with start_page=5, end_page=7\n**When** read_file is called with page range\n**Then** only pages 5-7 are extracted and returned\n\n**Given** a scanned PDF with no extractable text\n**When** read_file is called\n**Then** returns \"[PDF contains no extractable text or is scanned]\"\n\n**Given** enable_pdf=False in config\n**When** attempting to read a PDF\n**Then** returns \"PDF reading is disabled in configuration\"\n\n**Given** a PDF with 100 pages and pdf_max_pages=50\n**When** reading without page range\n**Then** only first 50 pages are read with truncation message\n\n**Testing Considerations:**\n- Create test PDFs with known content\n- Test with PyPDF2 and pdfplumber (choose one)\n- Test page range parameters\n- Test scanned PDFs (no text)\n- Test max pages limit\n- Test PDF detection by extension\n- Mock PDF reading for unit tests\n\n**Implementation Hints:**\n```python\ndef _read_pdf(path: Path, start_page: int | None, end_page: int | None, config: ReadToolConfig) -> str:\n    if not config.enable_pdf:\n        return \"PDF reading is disabled\"\n    \n    from PyPDF2 import PdfReader  # or pdfplumber\n    reader = PdfReader(path)\n    \n    start = start_page or 1\n    end = min(end_page or len(reader.pages), config.pdf_max_pages)\n    \n    text = \"\"\n    for i in range(start-1, end):\n        page = reader.pages[i]\n        text += f\"=== Page {i+1} ===\\\\n\"\n        text += page.extract_text() or \"[No text on this page]\"\n        text += \"\\\\n\"\n    \n    return text\n```\n- Add ReadFileInput fields: start_page, end_page\n- Check Path.suffix == \".pdf\" to trigger PDF mode\n- Handle PyPDF2 exceptions gracefully\n- Optional dependency in pyproject.toml",
  "status": "done",
  "type": "feature",
  "priority": "medium",
  "labels": [
    "tools",
    "pdf",
    "enhancement"
  ],
  "assignee": "jared@goatbytes.io",
  "reporter": "jared@goatbytes.io",
  "epic_id": "EPIC-005",
  "blocked_by": [
    "SOUL-79",
    "SOUL-80"
  ],
  "blocks": [
    "SOUL-85",
    "SOUL-86"
  ],
  "comments": [
    {
      "created_at": "2025-11-13T08:50:25.136635",
      "updated_at": "2025-11-13T08:50:25.136636",
      "id": "20251113085025-1dee0e74",
      "ticket_id": "SOUL-81",
      "author": "jared@goatbytes.io",
      "content": "PACKAGING NOTE: This ticket requires adding PyPDF2 or pdfplumber as an OPTIONAL dependency group in pyproject.toml. Create [tool.poetry.group.pdf] with the chosen library. The read tool should gracefully handle missing PDF libraries and return a helpful error message if enable_pdf=true but the library isn't installed. Dependencies: SOUL-79 (config must define enable_pdf, pdf_max_pages), SOUL-80 (core read infrastructure must exist).",
      "edited": false,
      "edit_count": 0,
      "is_ai_generated": false,
      "attachments": [],
      "attachment_count": 0
    },
    {
      "created_at": "2025-11-13T10:42:11.546444",
      "updated_at": "2025-11-13T10:42:11.546445",
      "id": "20251113104211-894254ff",
      "ticket_id": "SOUL-81",
      "author": "jared@goatbytes.io",
      "content": "\u2705 SOUL-81 Implementation Complete\n\n## Changes Implemented\n\n### 1. Optional Dependency\n- Added pypdf>=4.0.0 to pyproject.toml [project.optional-dependencies]\n- Install with: pip install consoul[pdf]\n\n### 2. PDF Reading Functionality\n**New Helper Functions:**\n- `_is_pdf_file(path)` - Detects PDF by .pdf extension\n- `_read_pdf(path, start_page, end_page, config)` - Extracts text with page markers\n\n**Features:**\n- Page markers: \"=== Page N ===\" between pages\n- Page range support: start_page (1-indexed), end_page (1-indexed, inclusive)\n- Respects config.enable_pdf and config.pdf_max_pages limits\n- Graceful handling of scanned/encrypted PDFs\n- Clear error messages for missing library or configuration issues\n\n### 3. Schema Updates\n**Extended ReadFileInput:**\n- start_page: int | None - Starting page for PDFs (1-indexed)\n- end_page: int | None - Ending page for PDFs (1-indexed, inclusive)\n\n**Updated read_file() signature:**\n- Detects PDF files by extension\n- Routes to _read_pdf() for PDFs\n- Maintains backward compatibility for text files\n\n### 4. Comprehensive Testing\n**11 new PDF tests added (52 total tests):**\n- test_read_pdf_basic - Basic extraction\n- test_read_pdf_with_page_range - Pages 1-2 extraction\n- test_read_pdf_single_page - Single page (page 2)\n- test_read_pdf_start_page_only - Start without end\n- test_read_pdf_disabled - enable_pdf=False handling\n- test_read_pdf_max_pages_limit - pdf_max_pages enforcement\n- test_read_pdf_invalid_page_range - Error validation\n- test_read_pdf_page_exceeds_length - Bounds checking\n- test_read_pdf_missing_pypdf - Missing library error\n- test_read_pdf_text_params_ignored - PDF vs text params\n- test_is_pdf_file - PDF detection logic\n\n## Verification Results\n\n\u2705 All 52 tests passing\n\u2705 Test coverage improved: 52.04% \u2192 85.71% for read.py\n\u2705 Pre-commit hooks passing (ruff, mypy)\n\n## Acceptance Criteria Met\n\n\u2705 PDF text extraction with \"=== Page N ===\" markers\n\u2705 Page range support (start_page=5, end_page=7)\n\u2705 Scanned PDF handling with clear message\n\u2705 enable_pdf=False configuration respected\n\u2705 pdf_max_pages limit with truncation note\n\n## Files Modified\n\n- pyproject.toml - Added optional pdf dependency\n- src/consoul/ai/tools/implementations/read.py - Added PDF support\n- tests/ai/tools/implementations/test_read.py - Added 11 PDF tests\n\n## Commit\n\nSHA: 6f165e5\nMessage: feat(SOUL-81): add PDF support with page extraction to read tool",
      "edited": false,
      "edit_count": 0,
      "is_ai_generated": false,
      "attachments": [],
      "attachment_count": 0
    }
  ],
  "attachments": [],
  "attachment_count": 0,
  "comment_count": 2,
  "story_points": 3,
  "order": 0,
  "custom_fields": {},
  "_archive_metadata": {
    "archived_at": "2025-11-14T23:28:34.603628",
    "archived_from_status": "done",
    "archived_by": "gira-cli"
  }
}