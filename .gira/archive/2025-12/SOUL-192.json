{
  "created_at": "2025-11-29T13:26:28.794837",
  "updated_at": "2025-12-06T16:24:07.392529Z",
  "id": "SOUL-192",
  "uuid": "083f5071-7f25-470e-9e98-17f9a5254586",
  "title": "Create InitializationErrorScreen for failure handling",
  "description": "**As a** Consoul user\n**I want** clear error messages when initialization fails\n**So that** I understand what went wrong and can take corrective action\n\n**Context:**\nDuring async initialization (Phase 3), various failures can occur:\n- Config file not found or invalid YAML\n- Network failures when connecting to AI providers\n- Invalid API keys or authentication errors\n- Database errors during conversation resume\n- Tool registration failures\n\nWe need a dedicated screen to show these errors with:\n- Clear error message and type\n- Helpful troubleshooting guidance\n- Retry button to attempt initialization again\n- Exit button to quit gracefully\n- Option to view full error details (stack trace)\n\n**Technical Notes:**\n- Create new file: src/consoul/tui/screens/error.py\n- Create InitializationErrorScreen(Screen)\n- Show error message, error type, and troubleshooting tips\n- Provide \"Retry\", \"View Details\", and \"Exit\" buttons\n- Log full error to console/file for debugging\n- Integrate into _async_initialize() error handling\n\n**Acceptance Criteria:**\n\n**Given** initialization fails with any error\n**When** the error screen is shown\n**Then** I see a clear, user-friendly error message\n\n**Given** I'm on the error screen\n**When** I click \"Retry\"\n**Then** initialization attempts again from the beginning\n\n**Given** I'm on the error screen\n**When** I click \"View Details\"\n**Then** I see the full stack trace in a scrollable view\n\n**Given** I'm on the error screen\n**When** I click \"Exit\"\n**Then** the app exits gracefully with exit code 1\n\n**Testing Considerations:**\n- Test with invalid config file (malformed YAML)\n- Test with missing config file\n- Test with invalid API key\n- Test with network disconnected\n- Test with invalid database path\n- Verify retry works correctly\n- Verify error logging to file\n- Test exit button cleanup\n\n**Implementation Hints:**\n```python\nfrom textual.screen import Screen\nfrom textual.widgets import Static, Button\nfrom textual.containers import Vertical, Horizontal\nfrom rich.traceback import Traceback\n\nclass InitializationErrorScreen(Screen):\n    \"\"\"Screen shown when initialization fails.\"\"\"\n\n    CSS = '''\n    InitializationErrorScreen {\n        align: center middle;\n    }\n\n    #error-container {\n        width: 80;\n        height: auto;\n        border: heavy $error;\n        padding: 2;\n        background: $surface;\n    }\n\n    #error-title {\n        text-style: bold;\n        color: $error;\n        text-align: center;\n        margin-bottom: 1;\n    }\n\n    #error-message {\n        color: $text;\n        margin-bottom: 2;\n    }\n\n    #error-details {\n        display: none;\n        margin-top: 2;\n        border: solid $primary;\n        padding: 1;\n        max-height: 20;\n        overflow-y: auto;\n    }\n\n    #buttons {\n        align: center middle;\n        margin-top: 2;\n    }\n\n    Button {\n        margin: 0 1;\n    }\n    '''\n\n    def __init__(self, error: Exception):\n        super().__init__()\n        self.error = error\n        self.show_details = False\n\n    def compose(self) -> ComposeResult:\n        \"\"\"Compose the error screen.\"\"\"\n        error_type = type(self.error).__name__\n        error_msg = str(self.error)\n\n        # Get troubleshooting tip based on error type\n        tip = self._get_troubleshooting_tip(error_type)\n\n        with Vertical(id=\"error-container\"):\n            yield Static(\"\u26a0\ufe0f  Initialization Failed\", id=\"error-title\")\n            yield Static(\n                f\"[b]{error_type}[/b]\\\\n\\\\n{error_msg}\\\\n\\\\n{tip}\",\n                id=\"error-message\"\n            )\n            yield Static(\n                str(Traceback.from_exception(type(self.error), self.error, self.error.__traceback__)),\n                id=\"error-details\"\n            )\n            with Horizontal(id=\"buttons\"):\n                yield Button(\"Retry\", id=\"retry\", variant=\"primary\")\n                yield Button(\"View Details\", id=\"details\", variant=\"default\")\n                yield Button(\"Exit\", id=\"exit\", variant=\"error\")\n\n    def _get_troubleshooting_tip(self, error_type: str) -> str:\n        \"\"\"Get troubleshooting guidance based on error type.\"\"\"\n        tips = {\n            \"FileNotFoundError\": \"\ud83d\udca1 Tip: Check that your config file exists at ~/.config/consoul/config.yaml\",\n            \"NetworkError\": \"\ud83d\udca1 Tip: Check your internet connection and firewall settings\",\n            \"AuthenticationError\": \"\ud83d\udca1 Tip: Verify your API key is valid and has proper permissions\",\n            \"ConfigurationError\": \"\ud83d\udca1 Tip: Check your config file for syntax errors or invalid values\",\n        }\n        return tips.get(error_type, \"\ud83d\udca1 Tip: Check the error details for more information\")\n\n    def on_button_pressed(self, event: Button.Pressed) -> None:\n        \"\"\"Handle button presses.\"\"\"\n        if event.button.id == \"retry\":\n            self.app.pop_screen()\n            self.app.on_mount()  # Restart initialization\n\n        elif event.button.id == \"details\":\n            details = self.query_one(\"#error-details\")\n            self.show_details = not self.show_details\n            details.styles.display = \"block\" if self.show_details else \"none\"\n            event.button.label = \"Hide Details\" if self.show_details else \"View Details\"\n\n        elif event.button.id == \"exit\":\n            self.app.exit(return_code=1)\n```\n\n**Integration in _async_initialize:**\n```python\nasync def _async_initialize(self) -> None:\n    \"\"\"Initialize app components with progress updates.\"\"\"\n    loading_screen = self.screen\n\n    try:\n        # ... initialization steps ...\n\n    except FileNotFoundError as e:\n        self.log.error(f\"Config file not found: {e}\")\n        self.pop_screen()  # Remove loading screen\n        self.push_screen(InitializationErrorScreen(error=e))\n\n    except Exception as e:\n        self.log.error(f\"Initialization failed: {e}\", exc_info=True)\n        self.pop_screen()  # Remove loading screen\n        self.push_screen(InitializationErrorScreen(error=e))\n```\n\n**Dependencies:**\n- Requires Phase 3 completion (_async_initialize method)\n- Can be developed in parallel with Phase 4",
  "status": "done",
  "type": "task",
  "priority": "medium",
  "labels": [
    "tui",
    "ui",
    "error-handling"
  ],
  "assignee": "jared@goatbytes.io",
  "reporter": "jared@goatbytes.io",
  "blocked_by": [],
  "blocks": [],
  "comments": [],
  "attachments": [],
  "attachment_count": 0,
  "comment_count": 0,
  "story_points": 1,
  "order": 0,
  "custom_fields": {},
  "_archive_metadata": {
    "archived_at": "2025-12-16T03:35:58.503729+00:00",
    "archived_from_status": "done",
    "archived_by": "gira-cli"
  }
}