{
  "created_at": "2025-12-26T21:28:19.705074Z",
  "updated_at": "2025-12-28T22:17:12.024616Z",
  "id": "SOUL-314",
  "uuid": "76707932-621c-4428-afcb-c9f9b0a0e638",
  "title": "Add example SessionHooks implementations for production patterns",
  "description": "**As a** developer learning the SessionHooks pattern\n**I want** working examples of common hook implementations\n**So that** I can quickly adapt them for my production use cases\n\n**Context:**\nThe SessionHooks protocol (SOUL-312) provides the infrastructure, but developers need practical examples to understand usage patterns. This ticket creates example implementations demonstrating real-world scenarios.\n\nExisting patterns to reference:\n- `src/consoul/ai/tools/audit.py` - AuditEvent, AuditLogger, FileAuditLogger\n- `src/consoul/sdk/redaction.py` - PiiRedactor for sensitive data handling\n- `examples/sdk/custom_audit_logger.py` - Custom audit logger example\n- `examples/sdk/compliance_logging.py` - Compliance logging patterns\n\n**Technical Notes:**\n- Create directory: `examples/sdk/session_hooks/`\n- Create `__init__.py` with module docstring\n- Create example files:\n\n1. **redaction_hook.py** - PII Redaction Hook\n   - Uses existing `PiiRedactor` from `src/consoul/sdk/redaction.py`\n   - Strips sensitive fields before save\n   - Configurable field list\n\n2. **audit_hook.py** - Audit Logging Hook\n   - Uses existing `AuditEvent` and `AuditLogger` patterns\n   - Logs save/load/delete events with timestamps\n   - Includes session_id, operation type, user context\n\n3. **validation_hook.py** - Schema Validation Hook\n   - Validates SessionState structure before save\n   - Checks required fields\n   - Enforces custom business rules\n\n4. **encryption_hook.py** - Encryption Hook (skeleton)\n   - Demonstrates encrypt-on-save, decrypt-on-load pattern\n   - Uses `cryptography.fernet` for symmetric encryption\n   - Includes key management best practices\n\n**Acceptance Criteria:**\n\n**Given** I want to add PII redaction to my session store\n**When** I copy `redaction_hook.py` and configure my fields\n**Then** I have working redaction without writing hook logic from scratch\n\n**Given** I want audit logging for session operations\n**When** I use `AuditHook` with my FileSessionStore\n**Then** all operations are logged with proper context\n\n**Given** I want to validate session data before saving\n**When** I use `ValidationHook` with custom rules\n**Then** invalid sessions are rejected with clear error messages\n\n**Given** I want to encrypt session data at rest\n**When** I review `encryption_hook.py`\n**Then** I understand the encrypt/decrypt pattern and key management\n\n**Given** I'm new to SessionHooks\n**When** I read the examples\n**Then** each file has comprehensive docstrings explaining the pattern\n\n**Testing Considerations:**\n- Each example should be runnable standalone\n- Include `if __name__ == \"__main__\"` demo block\n- Verify examples work with MemorySessionStore\n- Ensure imports resolve correctly\n- Test redaction actually removes PII\n- Test audit logs are written\n\n**Implementation Hints:**\n- Follow existing example patterns in `examples/sdk/`\n- Use relative imports from consoul.sdk\n- Include type hints throughout\n- Add docstrings with usage examples\n- Reference specific line numbers in existing code\n\nExample structure for redaction_hook.py:\n```python\n\"\"\"PII Redaction Hook for SessionStore.\n\nDemonstrates stripping sensitive data from session state before persistence.\nUses the existing PiiRedactor from consoul.sdk.redaction.\n\nExample usage:\n    >>> from consoul.sdk.session_store import MemorySessionStore, HookedSessionStore\n    >>> from examples.sdk.session_hooks.redaction_hook import RedactionHook\n    >>>\n    >>> hook = RedactionHook(fields=[\"password\", \"ssn\", \"credit_card\"])\n    >>> store = HookedSessionStore(MemorySessionStore(), hooks=[hook])\n    >>> store.save(\"ses123\", {\"user\": \"alice\", \"password\": \"secret\"})\n    >>> # Password is redacted before storage\n\"\"\"\n\nfrom consoul.sdk.protocols import SessionHooks\nfrom consoul.sdk.redaction import PiiRedactor\n\nclass RedactionHook:\n    \"\"\"Session hook that redacts PII before saving.\"\"\"\n    \n    def __init__(self, fields: list[str] | None = None):\n        self.redactor = PiiRedactor(fields=fields or [])\n    \n    def on_before_save(\n        self, session_id: str, state: dict[str, Any]\n    ) -> dict[str, Any]:\n        \"\"\"Redact sensitive fields before saving.\"\"\"\n        return self.redactor.redact_dict(state)\n    \n    # Other hook methods return unchanged (pass-through)\n    def on_after_save(self, session_id: str, state: dict[str, Any]) -> None:\n        pass\n    ...\n```\n\n**Dependencies:**\n- SOUL-312 (SessionHooks protocol and HookedSessionStore)",
  "status": "done",
  "type": "task",
  "priority": "medium",
  "labels": [
    "sdk",
    "examples",
    "documentation"
  ],
  "assignee": "jared@goatbytes.io",
  "reporter": "jared@goatbytes.io",
  "epic_id": "EPIC-019",
  "blocked_by": [],
  "blocks": [],
  "comments": [],
  "attachments": [],
  "attachment_count": 0,
  "comment_count": 0,
  "story_points": 3,
  "order": 0,
  "custom_fields": {},
  "_archive_metadata": {
    "archived_at": "2025-12-30T02:17:02.203845+00:00",
    "archived_from_status": "done",
    "archived_by": "gira-cli"
  }
}