{
  "created_at": "2025-12-30T02:06:35.715494Z",
  "updated_at": "2025-12-31T04:50:29.471265Z",
  "id": "SOUL-334",
  "uuid": "7374edeb-7ad0-4484-a51f-c5b3e840b167",
  "_version": 2,
  "title": "Generate OpenAPI client libraries from server spec",
  "description": "**As a** developer integrating Consoul server into applications\n**I want** pre-generated typed client libraries from the OpenAPI spec\n**So that** I can consume the Consoul API with type safety without writing boilerplate\n\n**Context:**\nThe Consoul server (src/consoul/server/) uses FastAPI which auto-generates OpenAPI 3.1 specifications at `/openapi.json`. The server already has well-defined Pydantic models including:\n- `ChatRequest`: session_id, message, model (src/consoul/server/models.py:185-220)\n- `ChatResponse`: session_id, response, model, usage, timestamp (src/consoul/server/models.py:263-307)\n- `ChatUsage`: input_tokens, output_tokens, total_tokens, estimated_cost (src/consoul/server/models.py:223-260)\n- `HealthResponse`, `ReadinessResponse`, `ReadinessErrorResponse` (src/consoul/server/models.py:76-182)\n- `ChatErrorResponse`: error, message, timestamp (src/consoul/server/models.py:310-339)\n\nCurrently, consumers must manually implement HTTP clients to call these endpoints. Pre-generated clients would:\n- Provide compile-time type checking\n- Reduce integration boilerplate\n- Stay synchronized with server API changes\n- Enable IDE autocomplete for API consumers\n\nSimilar pattern: [FastAPI's official guidance on generating SDKs](https://fastapi.tiangolo.com/advanced/generate-clients/), LangServe client generation.\n\n**Technical Notes:**\n\n**Files to Create:**\n- `scripts/generate_openapi_clients.py` - Main generation script\n- `docs/api/openapi.json` - Exported static OpenAPI spec\n- `clients/python/consoul_client/` - Generated Python client package\n- `clients/python/README.md` - Python client usage guide\n- `clients/typescript/` (optional) - Generated TypeScript client\n\n**Tools to Consider:**\n- [openapi-python-client](https://pypi.org/project/openapi-python-client/) - Modern Python clients with type annotations and dataclasses\n- [datamodel-code-generator](https://github.com/koxudaxi/datamodel-code-generator) - Generates Pydantic v2 models from OpenAPI\n- [openapi-generator](https://github.com/OpenAPITools/openapi-generator) - Multi-language support (Python, TypeScript, etc.)\n- [fastapi-client-generator](https://github.com/MichaelPHolstein/fastapi-client-generator) - Pure Python, optimized for FastAPI\n\n**Script Implementation Pattern:**\n```python\n# scripts/generate_openapi_clients.py\n1. Instantiate create_server() to get FastAPI app\n2. Extract OpenAPI JSON: app.openapi()\n3. Simplify operation IDs (fastapi_utils pattern for cleaner function names)\n4. Write spec to docs/api/openapi.json\n5. Generate Python client using openapi-python-client\n6. (Optional) Generate TypeScript client using openapi-generator\n```\n\n**CI Integration:**\n- Add workflow step to detect model changes (src/consoul/server/models.py)\n- Regenerate clients on change\n- Fail CI if generated clients are stale (committed vs regenerated differ)\n\n**Reference Files:**\n- src/consoul/server/models.py - All API models to be exposed\n- src/consoul/server/factory.py - create_server() for OpenAPI extraction\n- .github/workflows/ci.yml - Existing CI workflow to extend\n- scripts/generate_docs.py - Pattern for existing scripts\n\n**Acceptance Criteria:**\n\n**Given** I run `python scripts/generate_openapi_clients.py`\n**When** the script completes\n**Then** `docs/api/openapi.json` contains valid OpenAPI 3.1 spec matching server endpoints\n\n**Given** generated OpenAPI spec\n**When** I examine the spec\n**Then** it includes /health, /ready, /chat, /ws/chat/{session_id} endpoints with request/response schemas\n\n**Given** I want to call the Python client\n**When** I use `from consoul_client import ChatRequest, ChatResponse, ConsoulClient`\n**Then** types are correctly defined with full Pydantic v2 validation\n\n**Given** server models change (e.g., add field to ChatResponse)\n**When** CI runs on PR\n**Then** CI job detects stale clients and fails with clear regeneration instructions\n\n**Given** Python client is generated\n**When** I make API calls\n**Then** response types match server types (ChatResponse.usage.input_tokens is int, etc.)\n\n**Given** I check the generated clients directory\n**When** reviewing structure\n**Then** `clients/python/README.md` contains usage examples for chat, health, WebSocket\n\n**Testing Considerations:**\n- Unit test: Script generates valid JSON (json.load succeeds)\n- Unit test: Generated spec includes all expected endpoints\n- Unit test: Generated Python client has expected classes/methods\n- Integration test: Import generated client, verify types match server models\n- CI test: Regenerate clients, diff against committed, fail if different\n- Consider using pytest-snapshot for spec comparison\n\n**Implementation Hints:**\n- Use `app.openapi()` to get spec dict after calling `create_server()`\n- Consider `fastapi_utils.openapi.simplify_operation_ids` for cleaner method names\n- Add dev dependency: `openapi-python-client` to pyproject.toml [dev.dependencies]\n- For TypeScript: Use `openapi-generator-cli` Docker image or npm package\n- Generated clients should NOT be in .gitignore - commit them for consumers\n- Add `make generate-clients` target for convenience\n- Include client version synced with server version from pyproject.toml\n- Document in clients/python/README.md: `pip install ./clients/python`\n- Consider pypi publishing as separate package: `consoul-client`\n\n**Out of Scope:**\n- Publishing clients to PyPI/npm (future ticket)\n- WebSocket client generation (may need manual implementation)\n- Client authentication helpers (can be added later)",
  "status": "done",
  "type": "feature",
  "priority": "low",
  "labels": [
    "sdk",
    "api",
    "developer-experience"
  ],
  "assignee": "jared@goatbytes.io",
  "reporter": "jared@goatbytes.io",
  "epic_id": "EPIC-012",
  "blocked_by": [],
  "blocks": [],
  "comments": [
    {
      "created_at": "2025-12-31T04:50:19.468251Z",
      "updated_at": "2025-12-31T04:50:19.468254Z",
      "id": "20251230205019-e5e252e7",
      "ticket_id": "SOUL-334",
      "author": "jared@goatbytes.io",
      "content": "Implemented OpenAPI spec export (simplified scope):\n\n- Added scripts/generate_openapi_clients.py to export OpenAPI spec\n- Spec includes patched ChatRequest body (server uses Depends() which hides it)\n- Added docs/api/openapi.json with complete API specification\n- Added 'make openapi' target\n\nScope reduced from auto-generated client to spec-only export. Users can generate their own typed clients using the spec with tools like openapi-python-client or openapi-generator.",
      "edited": false,
      "edit_count": 0,
      "is_ai_generated": false,
      "attachments": [],
      "attachment_count": 0
    }
  ],
  "attachments": [],
  "attachment_count": 0,
  "comment_count": 1,
  "story_points": 3,
  "order": 0,
  "custom_fields": {},
  "_archive_metadata": {
    "archived_at": "2025-12-31T04:59:24.772189+00:00",
    "archived_from_status": "done",
    "archived_by": "gira-cli"
  }
}