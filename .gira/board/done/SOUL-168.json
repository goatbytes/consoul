{
  "created_at": "2025-11-26T00:51:45.580614",
  "updated_at": "2025-11-26T17:52:57.775651Z",
  "id": "SOUL-168",
  "uuid": "0cfef0f3-44ef-4fd9-abaa-7c05befb8c14",
  "title": "Add enhanced input with prompt_toolkit for chat command",
  "description": "**As a** Consoul chat user\n**I want** multi-line input with history navigation\n**So that** I can compose complex prompts and recall previous messages easily\n\n**Context:**\nClaude Code provides excellent input UX with:\n- Up/down arrows for history navigation\n- Multi-line editing support\n- Ctrl+D or Ctrl+C to exit\n- Clear prompt styling\n\nprompt_toolkit provides all these features and is used by ipython, ptpython, and other professional CLI tools.\n\n**Technical Notes:**\n- Use prompt_toolkit.PromptSession for input\n- Enable history: InMemoryHistory() or FileHistory()\n- Configure key bindings for multi-line vs single-line mode\n- Style prompt with Rich colors\n- Handle EOF (Ctrl+D) and interrupt (Ctrl+C) gracefully\n- src/consoul/cli/chat.py - integrate into main chat loop\n- Reference: https://python-prompt-toolkit.readthedocs.io/\n\n**Acceptance Criteria:**\n\n**Given** I am in chat mode\n**When** I type a message and press Enter\n**Then** message is submitted (single-line mode)\n\n**Given** I have sent previous messages\n**When** I press up arrow\n**Then** previous message appears in input\n\n**Given** I press up arrow multiple times\n**When** navigating history\n**Then** I can scroll through all previous messages\n\n**Given** I want to exit chat\n**When** I press Ctrl+D or type exit\n**Then** chat session ends gracefully\n\n**Given** response is streaming\n**When** I press Ctrl+C\n**Then** stream cancels and I return to input prompt\n\n**Testing Considerations:**\n- Test history navigation (up/down arrows)\n- Test Ctrl+D and Ctrl+C handling\n- Test with empty history\n- Test input persistence across sessions (FileHistory)\n- Test prompt styling with different terminals\n- Verify clear error messages for invalid input\n\n**Implementation Hints:**\n```python\nfrom prompt_toolkit import PromptSession\nfrom prompt_toolkit.history import InMemoryHistory\nfrom prompt_toolkit.styles import Style\n\nstyle = Style.from_dict({\n    'prompt': '#00d9ff bold',  # Consoul primary color\n})\n\nsession = PromptSession(\n    message=[('class:prompt', 'You: ')],\n    style=style,\n    history=InMemoryHistory(),\n    multiline=False,  # Enter submits, Alt+Enter for newline\n)\n\nwhile True:\n    try:\n        user_input = session.prompt()\n        if not user_input or user_input.lower() in ('exit', 'quit'):\n            break\n        # Process input\n    except (EOFError, KeyboardInterrupt):\n        break\n```\n\n- For FileHistory: use ~/.consoul/chat_history\n- Consider vi/emacs mode configuration\n- Add auto-completion for commands (/help, /clear, etc.)",
  "status": "done",
  "type": "feature",
  "priority": "medium",
  "labels": [
    "cli",
    "ux-improvement",
    "enhancement"
  ],
  "assignee": "jared@goatbytes.io",
  "reporter": "jared@goatbytes.io",
  "blocked_by": [],
  "blocks": [],
  "comments": [],
  "attachments": [],
  "attachment_count": 0,
  "comment_count": 0,
  "story_points": 3,
  "order": 0,
  "custom_fields": {}
}