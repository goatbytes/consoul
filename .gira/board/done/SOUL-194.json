{
  "created_at": "2025-11-29T16:10:19.247524",
  "updated_at": "2025-11-30T00:47:46.209842Z",
  "id": "SOUL-194",
  "uuid": "e78cafa3-760d-4f22-88b2-ddbad07f3ac4",
  "title": "Implement conditional loading screen based on config.show_loading_screen",
  "description": "**As a** Consoul user\n**I want** the loading screen to be optional via config\n**So that** I can choose between faster startup (skip loading) or visual feedback (show loading)\n\n**Context:**\nThe loading screen (SOUL-187, SOUL-189, SOUL-190, SOUL-191) was implemented with excellent async initialization patterns, reducing initialization from ~2.2s to ~340ms. The config field `show_loading_screen` already exists in TuiConfig (src/consoul/tui/config.py:92-94), but is not currently used by the app.\n\nWith fast initialization (<500ms), some users may prefer skipping the loading screen entirely for instant UI access. However, the loading screen provides valuable visual feedback during slower connections or first-time setup, so it should remain the default.\n\n**Current State:**\n- Loading screen always shows (src/consoul/tui/app.py:905-919)\n- Config field exists but is not consulted\n- Async initialization works robustly (7 stages with progress tracking)\n- Both code paths (with/without loading) must work reliably\n\n**Technical Notes:**\n- src/consoul/tui/app.py:905-924 - on_mount() always pushes loading screen\n- src/consoul/tui/app.py:647-817 - _async_initialize() expects loading screen present\n- src/consoul/tui/config.py:92-94 - show_loading_screen config field\n- Must ensure initialization robustness in BOTH paths (critical!)\n- Without loading screen: initialization must still complete before UI renders\n- Progress updates (loading_screen.update_progress) only when screen exists\n- Screen popping (self.pop_screen()) only when screen was pushed\n\n**Acceptance Criteria:**\n\n**Given** config.show_loading_screen = True (default)\n**When** TUI launches\n**Then** loading screen displays with progress through 7 stages\n\n**Given** config.show_loading_screen = False\n**When** TUI launches\n**Then** loading screen is skipped and initialization completes before showing main UI\n\n**Given** config.show_loading_screen = False\n**When** initialization encounters an error\n**Then** error handling works correctly (no screen to pop, still show error state)\n\n**Given** either config value\n**When** initialization completes\n**Then** post-initialization setup runs correctly in both paths\n\n**Testing Considerations:**\n- Test with show_loading_screen = True (current behavior)\n- Test with show_loading_screen = False (new behavior)\n- Test initialization error handling in both paths\n- Test that UI doesn't render before initialization completes (no loading)\n- Verify all 7 initialization stages complete in both paths\n- Test GC setup, theme application, system prompt addition work regardless\n- Verify no race conditions or timing issues without loading screen\n- Test with slow network (3s+) to ensure non-loading path still waits\n\n**Implementation Hints:**\n\n1. Modify on_mount() to conditionally push loading screen:\n```python\ndef on_mount(self) -> None:\n    \"\"\"Mount the app and start initialization.\"\"\"\n    if self.config.show_loading_screen:\n        from consoul.tui.loading import ConsoulLoadingScreen\n        from consoul.tui.animations import AnimationStyle\n        \n        loading_screen = ConsoulLoadingScreen(\n            animation_style=AnimationStyle.CODE_STREAM,\n            show_progress=True,\n        )\n        self.push_screen(loading_screen)\n    \n    # Brief delay ensures UI is ready before heavy work\n    self.set_timer(0.1, self._start_initialization)\n```\n\n2. Update _async_initialize() to handle optional loading screen:\n```python\nasync def _async_initialize(self) -> None:\n    \"\"\"Initialize AI components asynchronously.\"\"\"\n    # Get loading screen reference (may be None)\n    loading_screen = None\n    if self.config.show_loading_screen and self.screen_stack:\n        # Screen is on stack, get reference\n        loading_screen = self.screen\n    \n    try:\n        # Step 1: Load config (20%)\n        if loading_screen:\n            loading_screen.update_progress(\"Loading configuration...\", 20)\n        \n        # ... rest of steps with conditional progress updates\n        \n        # Step 7: Complete\n        if loading_screen:\n            loading_screen.update_progress(\"Ready!\", 100)\n            await loading_screen.fade_out(duration=0.5)\n            self.pop_screen()\n        \n        self._initialization_complete = True\n        await self._post_initialization_setup()\n        \n    except Exception as e:\n        logger.error(f\"Initialization failed: {e}\")\n        \n        # Pop loading screen if present\n        if loading_screen:\n            try:\n                self.pop_screen()\n            except Exception as pop_err:\n                logger.error(f\"Failed to pop screen: {pop_err}\")\n        \n        # Show error state (SOUL-192 implementation)\n        # For now, degrade gracefully\n        self.chat_model = None\n        self.conversation = None\n```\n\n3. Ensure main UI doesn't render until initialization completes:\n   - If no loading screen, initialization must block before compose()\n   - Use _initialization_complete flag to prevent premature rendering\n   - Consider adding a blank screen as placeholder during init\n\n4. Update documentation:\n   - Document config option in sample configs\n   - Note performance trade-off (visual feedback vs instant UI)\n   - Recommend keeping enabled for slower connections\n\n**Dependencies:**\n- SOUL-187, SOUL-189, SOUL-190, SOUL-191 (Loading screen implementation - DONE)\n- Optional: SOUL-192 (InitializationErrorScreen for better error UX)\n\n**Performance Considerations:**\n- No loading screen: ~340ms initialization → instant UI after completion\n- With loading screen: ~340ms + 500ms fade → ~840ms total UX\n- Both paths must complete all 7 stages robustly\n- No shortcuts or skipped initialization when loading screen disabled",
  "status": "done",
  "type": "feature",
  "priority": "medium",
  "labels": [
    "tui",
    "config",
    "ux-improvement",
    "enhancement"
  ],
  "reporter": "jared@goatbytes.io",
  "blocked_by": [],
  "blocks": [],
  "comments": [
    {
      "created_at": "2025-11-29T16:47:44.364484",
      "updated_at": "2025-11-29T16:47:44.364485",
      "id": "20251129164744-26a4c326",
      "ticket_id": "SOUL-194",
      "author": "jared@goatbytes.io",
      "content": "Implementation completed. Loading screen is now optional based on config.show_loading_screen setting.\n\nChanges:\n1. Modified on_mount() (app.py:905-925):\n   - Conditionally pushes loading screen only if config.show_loading_screen is True\n   - Default is True, preserving current behavior\n   - Initialization timer set regardless of loading screen state\n\n2. Updated _async_initialize() (app.py:647-849):\n   - Checks for loading screen presence before getting reference\n   - Wraps all loading_screen.update_progress() calls with 'if loading_screen:' checks\n   - Wraps all loading_screen.fade_out() and pop_screen() calls conditionally\n   - Both initialization paths (with/without loading) complete all 7 stages robustly\n\nImplementation Details:\n- Loading screen reference: Set to None if disabled, else self.screen\n- Progress updates: Only called when loading_screen is not None\n- Screen popping: Only attempted when loading_screen exists\n- Error handling: Updated to only pop screen if it was pushed\n- Initialization: Completes correctly in both scenarios\n\nTesting:\n- Default behavior (show_loading_screen=True): Loading screen shows with progress\n- Disabled (show_loading_screen=False): Instant startup, no loading screen\n- Both paths: All 7 initialization stages complete\n- Error handling: Works correctly in both paths\n\nPerformance:\n- With loading screen: ~340ms init + ~500ms fade = ~840ms total UX\n- Without loading screen: ~340ms init = instant UI after completion\n- No shortcuts or skipped stages when loading disabled\n\nThe implementation ensures robustness in BOTH code paths while giving users the choice between visual feedback and instant startup.",
      "edited": false,
      "edit_count": 0,
      "is_ai_generated": false,
      "attachments": [],
      "attachment_count": 0
    }
  ],
  "attachments": [],
  "attachment_count": 0,
  "comment_count": 1,
  "story_points": 3,
  "order": 0,
  "custom_fields": {}
}