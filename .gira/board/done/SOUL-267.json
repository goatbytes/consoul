{
  "created_at": "2025-12-11T16:42:34.072951",
  "updated_at": "2025-12-13T00:48:56.928489Z",
  "id": "SOUL-267",
  "uuid": "d478a413-8673-4175-867f-e2e2fdd5d1f4",
  "title": "Refactor TUI tool execution to use ToolService",
  "description": "**As a** Consoul developer\n**I want** TUI tool execution refactored to use ToolService\n**So that** tool management logic is in SDK and TUI is pure UI orchestration\n\n**Context:**\nCurrently, TUI still has direct ToolRegistry usage scattered throughout app.py. After SOUL-246 creates ToolService, this ticket refactors TUI to use it exclusively. This will:\n- Remove ~193 lines of tool setup logic (lines 314-507)\n- Remove direct ToolRegistry imports and usage\n- Simplify TUIToolApprover to just be a callback wrapper\n- Move tool configuration logic to SDK layer\n\n**Dependencies:**\n- **â›” Blocked by SOUL-246**: ToolService must exist first\n\n**Current State (app.py):**\n- Lines 314-507: Tool setup and configuration (193 lines)\n- TUIToolApprover: Direct ToolRegistry interaction\n- self.tool_registry used throughout\n- Tool approval logic mixed with UI concerns\n\n**Target State:**\n- Tool setup: Delegate to ToolService.from_config()\n- Tool execution: Already using ConversationService (via SOUL-263)\n- TUIToolApprover: Pure UI callback (show modal, return decision)\n- No direct ToolRegistry usage in TUI\n\n**Technical Notes:**\n- Refactor: src/consoul/tui/app.py lines 314-507\n- Update: TUIToolApprover to use ToolService callbacks\n- Use: ToolService from src/consoul/sdk/services/tool.py (after SOUL-246)\n- Remove: from consoul.ai.tools import ToolRegistry\n- Remove: self.tool_registry direct usage\n- Keep: Tool approval modal UI (ToolApprovalModal)\n- Keep: Tool execution visualization in chat\n\n**Acceptance Criteria:**\n\n**Given** ToolService exists from SOUL-246\n**When** I refactor TUI to use it\n**Then** app.py is reduced by ~200 lines\n\n**Given** Tools need configuration\n**When** App initializes\n**Then** ToolService.from_config() handles setup, not TUI code\n\n**Given** Tool approval is needed\n**When** TUIToolApprover.on_tool_request() is called\n**Then** It shows modal and returns decision, no business logic\n\n**Given** TUI uses ToolService\n**When** I search app.py for \"ToolRegistry\"\n**Then** Zero direct usages found (only via service)\n\n**Testing Considerations:**\n- Test tool approval flow (approve/deny)\n- Test auto-approved tools (SAFE permission level)\n- Test tool execution with various tools\n- Test permission policies (TRUSTING, BALANCED, PARANOID)\n- Verify audit logging still works\n- Test tool whitelisting functionality\n\n**Implementation Hints:**\n- Replace _initialize_tool_registry() with self.tool_service = ToolService.from_config(config)\n- Update TUIToolApprover.__init__() to take ToolService instance\n- Simplify TUIToolApprover.on_tool_request() to pure UI code\n- Remove tool setup logic from app.py lines 314-507\n- Pass tool_service to ConversationService instead of tool_registry\n- Update type hints: remove ToolRegistry imports\n\nExpected line reduction: ~200 lines",
  "status": "done",
  "type": "task",
  "priority": "high",
  "labels": [
    "tui",
    "sdk",
    "refactor",
    "tools",
    "blocked"
  ],
  "reporter": "jared@goatbytes.io",
  "epic_id": "EPIC-013",
  "parent_id": "SOUL-249",
  "blocked_by": [],
  "blocks": [],
  "comments": [],
  "attachments": [],
  "attachment_count": 0,
  "comment_count": 0,
  "story_points": 5,
  "order": 0,
  "custom_fields": {}
}