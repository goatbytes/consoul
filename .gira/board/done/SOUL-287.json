{
  "created_at": "2025-12-16T13:53:37.512552",
  "updated_at": "2025-12-19T19:01:31.147206Z",
  "id": "SOUL-287",
  "uuid": "77d075e5-633c-428a-9ff2-bd808cf7df44",
  "title": "Enhance system prompt builder for SDK control and non-coding domains",
  "description": "**As a** SDK developer building domain-specific AI agents (legal, medical, customer support)\n**I want** granular control over system prompt construction without auto-injections\n**So that** I can build clean prompts for non-coding use cases without environment noise\n\n**Context:**\nCurrent system prompt builder (src/consoul/ai/prompt_builder.py:92-168) provides build_enhanced_system_prompt() with boolean flags:\n- include_env_context: Injects OS, shell, working directory\n- include_git_context: Injects repository, branch, commit info\n- auto_append_tools: Auto-appends tool documentation\n\nThese work for CLI/TUI coding assistants but are too coarse for SDK users who need:\n- Selective environment context (just OS, not full env dump)\n- Custom context injection (case law for legal AI, patient data for medical)\n- Clean prompts without coding assumptions\n\nExample: Legal AI does not need git info but needs case law context\nExample: Medical chatbot needs patient context, not working directory\n\nCurrently: All-or-nothing boolean flags\nDesired: Fine-grained control or custom context builders\n\n**Technical Notes:**\n- src/consoul/ai/prompt_builder.py:92-168 - build_enhanced_system_prompt()\n- src/consoul/ai/environment.py - get_environment_context() generates env block\n- Boolean flags: include_env_context, include_git_context, auto_append_tools\n- Prepends env context block unconditionally if enabled\n- Profile.context.custom_context_files exists but only supports file paths\n\n**Acceptance Criteria:**\n\n**Given** I am building a legal AI assistant\n**When** I call build_enhanced_system_prompt with selective context options\n**Then** I can include OS info without working directory or git details\n\n**Given** I want to inject domain-specific context\n**When** I provide custom context builders or structured data\n**Then** My custom context integrates cleanly into the system prompt\n\n**Given** I am using Consoul for a non-coding domain\n**When** I build a system prompt\n**Then** No coding-specific assumptions are injected (git, working dir, etc.)\n\n**Given** I am using CLI/TUI for coding\n**When** I use default settings\n**Then** Current behavior is preserved (backward compatible)\n\n**Testing Considerations:**\n- Test selective environment context injection\n- Test custom context builder pattern\n- Test clean prompts for non-coding domains\n- Test backward compatibility with existing CLI/TUI usage\n- Test custom_context_files still works\n- Document extension patterns for domain-specific context\n\n**Implementation Hints:**\nOption A: Add granular kwargs to build_enhanced_system_prompt()\n  - include_os_info, include_shell_info, include_directory_info, include_git_info\n  - More params but explicit control\n\nOption B: Accept custom context builder callable\n  - context_builder: Callable[[ProfileConfig], str]\n  - More flexible, enables domain-specific logic\n\nOption C: Structured context injection API\n  - context_sections: dict[str, str] = {\"environment\": ..., \"domain\": ...}\n  - Cleanest separation, most flexible\n\nConsider: Should get_environment_context() be split into granular functions?\nConsider: Protocol for custom context providers?\nDocument pattern for domain-specific Consoul usage in examples/\n\n**Dependencies:**\n- Related to SOUL-285 (Profile-optional constructor)\n- Enables custom context injection for domain-specific agents",
  "status": "done",
  "type": "feature",
  "priority": "medium",
  "labels": [
    "sdk",
    "ai",
    "enhancement"
  ],
  "reporter": "jared@goatbytes.io",
  "epic_id": "EPIC-015",
  "blocked_by": [],
  "blocks": [],
  "comments": [],
  "attachments": [],
  "attachment_count": 0,
  "comment_count": 0,
  "story_points": 3,
  "order": 30,
  "custom_fields": {}
}