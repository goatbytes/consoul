{
  "created_at": "2025-12-23T12:10:50.555600",
  "updated_at": "2025-12-25T06:25:12.672438Z",
  "id": "SOUL-296",
  "uuid": "e813840b-6ffe-401c-a729-2c16eab6c7fd",
  "title": "Create consoul.server package with factory pattern",
  "description": "**As a** backend developer\n**I want** production-ready server factory: create_server(config)\n**So that** I can deploy Consoul API with minimal boilerplate\n\n**Context:**\nCurrent FastAPI example (examples/backend/fastapi_sessions.py) requires manual setup. Need reusable server package similar to LangServe pattern. Should provide:\n- Server factory with sane defaults\n- Environment-based configuration (12-factor)\n- Health/readiness endpoints\n- Graceful shutdown\n- Production middleware stack\n\nReference: LangServe provides add_routes() helper - we need similar simplicity.\n\n**Technical Notes:**\n- Create: src/consoul/server/__init__.py\n- Create: src/consoul/server/factory.py\n- Create: src/consoul/server/config.py (ServerConfig)\n- Dependencies: FastAPI, uvicorn, pydantic-settings\n- Pattern: def create_server(config: ServerConfig) -> FastAPI\n- Integration: Use SOUL-292-295 middleware components\n- Optional: pyproject.toml [server] extras\n\nFactory should configure:\n1. FastAPI app with metadata\n2. CORS middleware\n3. Auth middleware (if enabled)\n4. Rate limiting middleware\n5. Health/readiness endpoints\n6. Graceful shutdown handlers\n\n**Acceptance Criteria:**\n\n**Given** I import create_server\n**When** I call app = create_server(ServerConfig.from_env())\n**Then** returns configured FastAPI app ready for uvicorn\n\n**Given** server is created\n**When** I navigate to /health\n**Then** returns {\"status\": \"ok\", \"version\": \"...\"} 200 OK\n\n**Given** server is created with auth_enabled=True\n**When** requests arrive\n**Then** API key authentication is enforced\n\n**Given** server receives SIGTERM\n**When** shutting down\n**Then** waits for in-flight requests to complete (grace period)\n\n**Testing Considerations:**\n- Test server factory with default config\n- Test with custom ServerConfig\n- Test health/readiness endpoints\n- Test graceful shutdown (TestClient)\n- Test environment variable loading\n- Integration test full server startup\n\n**Implementation Hints:**\n- ServerConfig: Use pydantic-settings for env vars\n- Factory pattern: create_server() returns FastAPI instance\n- Health endpoint: GET /health → {\"status\": \"ok\"}\n- Readiness: GET /ready → check Redis/dependencies\n- Shutdown: Use @app.on_event(\"shutdown\") hook\n- CORS: Configurable origins (default: localhost)\n- Add uvicorn startup script: consoul.server:create_server_from_env\n- Document in examples/server/basic_server.py\n- Environment variables: CONSOUL_API_KEY, CONSOUL_REDIS_URL, CONSOUL_CORS_ORIGINS\n- Reference: SOUL-294 for middleware integration",
  "status": "done",
  "type": "story",
  "priority": "high",
  "labels": [
    "server",
    "api",
    "production",
    "architecture"
  ],
  "assignee": "jared@goatbytes.io",
  "reporter": "jared@goatbytes.io",
  "epic_id": "EPIC-017",
  "blocked_by": [
    "SOUL-294"
  ],
  "blocks": [
    "SOUL-297"
  ],
  "comments": [],
  "attachments": [],
  "attachment_count": 0,
  "comment_count": 0,
  "story_points": 5,
  "order": 0,
  "custom_fields": {}
}