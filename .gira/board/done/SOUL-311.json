{
  "created_at": "2025-12-26T21:25:50.416656Z",
  "updated_at": "2025-12-28T22:17:12.023953Z",
  "id": "SOUL-311",
  "uuid": "c1ed20cb-1063-4407-8131-0da50b548d46",
  "title": "Add list_sessions method to SessionStore protocol and implementations",
  "description": "**As a** backend developer managing multi-user sessions\n**I want** to list and query active sessions with filtering\n**So that** I can build admin dashboards, cleanup routines, and user session management\n\n**Context:**\nThe current `SessionStore` protocol (src/consoul/sdk/session_store.py:58-149) supports CRUD operations (save, load, delete, exists, cleanup) but lacks querying capability. Production deployments need:\n- List all sessions for a user/tenant\n- Paginate through large session sets\n- Filter by namespace or metadata\n- Count active sessions for rate limiting\n\nThis is critical for:\n- Admin dashboards showing active users\n- Session cleanup cron jobs\n- Rate limiting by user/tenant\n- Compliance reporting\n\n**Technical Notes:**\n- File: `src/consoul/sdk/session_store.py`\n- Add to `SessionStore` protocol:\n  ```python\n  def list_sessions(\n      self,\n      namespace: str | None = None,\n      limit: int = 100,\n      offset: int = 0,\n  ) -> list[str]:\n      \"\"\"List session IDs with optional namespace filtering.\"\"\"\n      ...\n  ```\n- Implement in `MemorySessionStore` (line 152-294):\n  - Filter by namespace prefix if provided\n  - Respect limit/offset for pagination\n  - Return session IDs sorted by creation time (newest first)\n- Implement in `FileSessionStore` (line 297-534):\n  - Scan JSON files in storage directory\n  - Parse session_id from filename or file content\n  - Filter by namespace prefix\n  - Sort by file modification time\n- Implement in `RedisSessionStore` (line 537-718):\n  - Use `SCAN` command with prefix pattern\n  - Combine prefix + namespace for filtering\n  - Return keys with pagination via cursor\n\n**Acceptance Criteria:**\n\n**Given** I have sessions stored for multiple users\n**When** I call `store.list_sessions(limit=10)`\n**Then** I get up to 10 session IDs sorted by recency\n\n**Given** I have sessions with namespaced IDs like `\"acme:user1:ses123\"`\n**When** I call `store.list_sessions(namespace=\"acme\")`\n**Then** I only get sessions matching that namespace prefix\n\n**Given** I have 500 sessions and want pagination\n**When** I call `store.list_sessions(limit=50, offset=100)`\n**Then** I get sessions 101-150 in the sorted order\n\n**Given** I have no sessions in the store\n**When** I call `store.list_sessions()`\n**Then** I get an empty list (not an error)\n\n**Given** I use RedisSessionStore with TTL\n**When** I call `list_sessions()` \n**Then** expired sessions are not included\n\n**Testing Considerations:**\n- Test each implementation (Memory, File, Redis) separately\n- Test pagination with edge cases (offset > total, limit=0)\n- Test namespace filtering with partial matches\n- Test empty store returns empty list\n- Test with 1000+ sessions for performance\n- Mock Redis for unit tests, use redis-py for integration tests\n\n**Implementation Hints:**\n- MemorySessionStore: Filter `self._sessions.keys()` with prefix match\n- FileSessionStore: Use `self.storage_dir.glob(\"*.json\")` with sorting\n- RedisSessionStore: Use `scan_iter(match=f\"{self.prefix}{namespace}*\")`\n- Consider adding `count_sessions()` method in follow-up ticket\n- Namespace filtering is prefix-based (e.g., \"acme\" matches \"acme:user1:abc\")\n\n```python\n# MemorySessionStore implementation hint\ndef list_sessions(\n    self,\n    namespace: str | None = None,\n    limit: int = 100,\n    offset: int = 0,\n) -> list[str]:\n    with self._global_lock:\n        sessions = list(self._sessions.keys())\n        if namespace:\n            sessions = [s for s in sessions if s.startswith(namespace)]\n        # Sort by timestamp (newest first)\n        sessions.sort(key=lambda s: self._timestamps.get(s, 0), reverse=True)\n        return sessions[offset:offset + limit]\n```",
  "status": "done",
  "type": "story",
  "priority": "high",
  "labels": [
    "sdk",
    "session",
    "enhancement"
  ],
  "assignee": "jared@goatbytes.io",
  "reporter": "jared@goatbytes.io",
  "epic_id": "EPIC-019",
  "blocked_by": [],
  "blocks": [],
  "comments": [],
  "attachments": [],
  "attachment_count": 0,
  "comment_count": 0,
  "story_points": 5,
  "order": 0,
  "custom_fields": {}
}