{
  "created_at": "2025-12-26T21:27:00.349818Z",
  "updated_at": "2025-12-27T01:41:03.935174Z",
  "id": "SOUL-313",
  "uuid": "df5caff2-0ef3-4bca-a02b-4bd40014936d",
  "title": "Update session factory functions with metadata support",
  "description": "**As a** SDK user creating sessions programmatically\n**I want** the factory functions to accept user/tenant metadata\n**So that** I can create properly tagged sessions with minimal boilerplate\n\n**Context:**\nThe SDK wrapper (src/consoul/sdk/wrapper.py) provides convenient factory functions:\n- `create_session()` - Create new Consoul session\n- `save_session_state()` - Extract SessionState from Consoul\n- `restore_session()` - Recreate Consoul from SessionState\n\nThese need updates to support the new SessionMetadata infrastructure (SOUL-309).\n\nCurrent `create_session()` signature:\n```python\ndef create_session(\n    session_id: str | None = None,\n    model: str = \"gpt-4o\",\n    temperature: float = 0.7,\n    tools: bool | list[str] | None = True,\n    ...\n) -> Consoul:\n```\n\n**Technical Notes:**\n- File: `src/consoul/sdk/wrapper.py`\n- Update `create_session()`:\n  - Add `user_id: str | None = None`\n  - Add `tenant_id: str | None = None`\n  - Add `namespace: str | None = None`\n  - Add `metadata: SessionMetadata | dict[str, Any] | None = None`\n  - Generate structured session_id if user_id/tenant_id provided\n- Update `save_session_state()`:\n  - Add `metadata: SessionMetadata | None = None` parameter\n  - Merge with existing session metadata if present\n- Update `src/consoul/sdk/__init__.py`:\n  - Export `SessionMetadata` from models\n  - Export `SessionIdBuilder`, `build_session_id`, `parse_session_id` from session_id\n  - Export `SessionHooks`, `HookedSessionStore` from session_store\n\n**Acceptance Criteria:**\n\n**Given** I call `create_session(user_id=\"u123\", tenant_id=\"acme\")`\n**When** I check the session_id\n**Then** it follows the namespaced pattern (e.g., `\"acme:u123:ses_abc123\"`)\n\n**Given** I call `create_session(metadata={\"user_id\": \"u123\", \"tags\": [\"premium\"]})`\n**When** I save and restore the session\n**Then** the metadata is preserved\n\n**Given** I call `save_session_state(console, metadata=SessionMetadata(user_id=\"u123\"))`\n**When** the state is returned\n**Then** `state.metadata.user_id == \"u123\"`\n\n**Given** I don't provide any metadata parameters\n**When** I call `create_session()`\n**Then** behavior is identical to current (backward compatible)\n\n**Given** I import from consoul.sdk\n**When** I check available exports\n**Then** SessionMetadata, SessionIdBuilder, SessionHooks are available\n\n**Testing Considerations:**\n- Test create_session with user_id/tenant_id generates structured ID\n- Test create_session with metadata dict converts to SessionMetadata\n- Test save_session_state with metadata parameter\n- Test backward compatibility (no metadata params)\n- Test __init__.py exports are correct\n- Test round-trip: create -> save -> restore preserves metadata\n\n**Implementation Hints:**\n- Accept metadata as dict or SessionMetadata for flexibility\n- Convert dict to SessionMetadata in create_session\n- Use build_session_id() when user_id/tenant_id provided\n- Store metadata in Consoul instance for later retrieval\n- Update ConsoulResponse to include metadata if present\n- Follow existing parameter patterns in wrapper.py\n\n```python\ndef create_session(\n    session_id: str | None = None,\n    model: str = \"gpt-4o\",\n    temperature: float = 0.7,\n    # New parameters\n    user_id: str | None = None,\n    tenant_id: str | None = None,\n    namespace: str | None = None,\n    metadata: SessionMetadata | dict[str, Any] | None = None,\n    ...\n) -> Consoul:\n    # Generate structured session_id if user context provided\n    if session_id is None and (user_id or tenant_id):\n        session_id = build_session_id(\n            user_id=user_id,\n            tenant_id=tenant_id,\n            namespace=namespace\n        )\n    \n    # Convert dict to SessionMetadata\n    if isinstance(metadata, dict):\n        metadata = SessionMetadata(**metadata)\n    elif metadata is None and (user_id or tenant_id):\n        metadata = SessionMetadata(\n            user_id=user_id,\n            tenant_id=tenant_id,\n            namespace=namespace\n        )\n    ...\n```\n\n**Dependencies:**\n- SOUL-309 (SessionMetadata infrastructure)\n- SOUL-310 (Session ID utilities)",
  "status": "done",
  "type": "story",
  "priority": "medium",
  "labels": [
    "sdk",
    "session",
    "enhancement"
  ],
  "reporter": "jared@goatbytes.io",
  "epic_id": "EPIC-019",
  "blocked_by": [],
  "blocks": [],
  "comments": [],
  "attachments": [],
  "attachment_count": 0,
  "comment_count": 0,
  "story_points": 3,
  "order": 0,
  "custom_fields": {}
}