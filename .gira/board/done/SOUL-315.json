{
  "created_at": "2025-12-26T21:28:21.215262Z",
  "updated_at": "2025-12-28T22:17:12.032846Z",
  "id": "SOUL-315",
  "uuid": "7ac4b1bc-b12a-47a4-b171-d5d3dec05d33",
  "title": "Add comprehensive test suite for session management features",
  "description": "**As a** maintainer ensuring session management reliability\n**I want** comprehensive test coverage for all new session features\n**So that** regressions are caught early and edge cases are verified\n\n**Context:**\nThis ticket covers testing for all session management features in EPIC-019:\n- SessionMetadata (SOUL-309)\n- Session ID utilities (SOUL-310)\n- list_sessions() method (SOUL-311)\n- SessionHooks and HookedSessionStore (SOUL-312)\n- Updated factory functions (SOUL-313)\n\nTesting should follow existing patterns in `tests/sdk/` directory.\n\n**Technical Notes:**\n- Create test files:\n  1. `tests/sdk/test_session_metadata.py` - SessionMetadata tests\n  2. `tests/sdk/test_session_id.py` - Session ID utility tests\n  3. `tests/sdk/test_session_hooks.py` - Hook protocol and wrapper tests\n  4. `tests/sdk/test_list_sessions.py` - list_sessions() implementation tests\n  5. Update `tests/sdk/test_wrapper.py` - Factory function tests\n\nTest categories:\n- **Unit tests**: Individual class/function behavior\n- **Integration tests**: Component interaction\n- **Edge case tests**: Boundary conditions, error handling\n- **Backward compatibility tests**: Existing behavior preserved\n\n**Acceptance Criteria:**\n\n**Given** SessionMetadata is implemented\n**When** I run `pytest tests/sdk/test_session_metadata.py`\n**Then** all tests pass including:\n- Creation with all fields\n- to_dict/from_dict round-trip\n- Optional field handling\n- Custom dict serialization\n\n**Given** Session ID utilities are implemented\n**When** I run `pytest tests/sdk/test_session_id.py`\n**Then** all tests pass including:\n- build_session_id with various combinations\n- parse_session_id with valid/invalid input\n- SessionIdBuilder fluent interface\n- generate_session_id uniqueness\n- Special character escaping\n\n**Given** SessionHooks are implemented\n**When** I run `pytest tests/sdk/test_session_hooks.py`\n**Then** all tests pass including:\n- Hook invocation order\n- State modification in before_save\n- Abort via exception\n- Async hook support\n- Hook chaining\n- Partial implementation (missing methods)\n\n**Given** list_sessions is implemented\n**When** I run `pytest tests/sdk/test_list_sessions.py`\n**Then** all tests pass for all three stores:\n- MemorySessionStore\n- FileSessionStore  \n- RedisSessionStore (mocked)\n- Pagination (limit, offset)\n- Namespace filtering\n- Empty store handling\n\n**Given** factory functions are updated\n**When** I run `pytest tests/sdk/test_wrapper.py`\n**Then** all existing tests pass plus new tests for:\n- create_session with metadata\n- save_session_state with metadata\n- Backward compatibility (no metadata)\n\n**Testing Considerations:**\n- Use pytest fixtures for store setup/teardown\n- Use tmp_path fixture for FileSessionStore tests\n- Mock Redis client for RedisSessionStore tests\n- Use pytest.mark.asyncio for async tests\n- Test both sync and async hook implementations\n- Verify 100% coverage for new code\n- Include property-based tests with hypothesis if appropriate\n\n**Implementation Hints:**\n- Follow existing test patterns in tests/sdk/\n- Use conftest.py for shared fixtures\n- Create mock stores for isolation\n- Use pytest.raises for exception testing\n- Add docstrings to test functions explaining what's tested\n\nExample test structure:\n```python\n# tests/sdk/test_session_metadata.py\nimport pytest\nfrom consoul.sdk.models import SessionMetadata, SessionState\n\nclass TestSessionMetadata:\n    \"\"\"Tests for SessionMetadata dataclass.\"\"\"\n    \n    def test_create_with_all_fields(self):\n        \"\"\"SessionMetadata accepts all optional fields.\"\"\"\n        meta = SessionMetadata(\n            user_id=\"u123\",\n            tenant_id=\"acme\",\n            namespace=\"legal\",\n            tags=[\"premium\", \"enterprise\"],\n            custom={\"billing_id\": \"B-123\"},\n            created_by=\"admin\"\n        )\n        assert meta.user_id == \"u123\"\n        assert meta.tenant_id == \"acme\"\n        assert \"premium\" in meta.tags\n        assert meta.custom[\"billing_id\"] == \"B-123\"\n    \n    def test_to_dict_from_dict_roundtrip(self):\n        \"\"\"SessionMetadata survives serialization round-trip.\"\"\"\n        original = SessionMetadata(user_id=\"u123\", tags=[\"test\"])\n        as_dict = original.to_dict()\n        restored = SessionMetadata.from_dict(as_dict)\n        assert restored.user_id == original.user_id\n        assert restored.tags == original.tags\n    \n    def test_empty_metadata(self):\n        \"\"\"SessionMetadata works with no fields set.\"\"\"\n        meta = SessionMetadata()\n        assert meta.user_id is None\n        assert meta.tags == []\n        assert meta.custom == {}\n\n\nclass TestSessionStateMetadata:\n    \"\"\"Tests for SessionState with metadata.\"\"\"\n    \n    def test_backward_compat_no_metadata(self):\n        \"\"\"Existing sessions without metadata still load.\"\"\"\n        old_dict = {\n            \"session_id\": \"ses123\",\n            \"model\": \"gpt-4o\",\n            \"temperature\": 0.7,\n            \"messages\": [],\n            \"created_at\": 1704067200.0,\n            \"updated_at\": 1704067200.0\n        }\n        state = SessionState.from_dict(old_dict)\n        assert state.metadata is None\n    \n    def test_state_with_metadata_roundtrip(self):\n        \"\"\"SessionState with metadata survives round-trip.\"\"\"\n        state = SessionState(\n            session_id=\"ses123\",\n            model=\"gpt-4o\",\n            temperature=0.7,\n            messages=[],\n            created_at=1704067200.0,\n            updated_at=1704067200.0,\n            metadata=SessionMetadata(user_id=\"u123\")\n        )\n        restored = SessionState.from_dict(state.to_dict())\n        assert restored.metadata.user_id == \"u123\"\n```\n\n**Dependencies:**\n- All other tickets in EPIC-019 (SOUL-309 through SOUL-314)\n- This ticket should run in parallel with implementation tickets",
  "status": "done",
  "type": "task",
  "priority": "high",
  "labels": [
    "sdk",
    "testing"
  ],
  "assignee": "jared@goatbytes.io",
  "reporter": "jared@goatbytes.io",
  "epic_id": "EPIC-019",
  "blocked_by": [],
  "blocks": [],
  "comments": [],
  "attachments": [],
  "attachment_count": 0,
  "comment_count": 0,
  "story_points": 5,
  "order": 0,
  "custom_fields": {}
}