{
  "created_at": "2025-11-09T19:48:33.079763",
  "updated_at": "2025-11-11T04:27:46.252279Z",
  "id": "SOUL-35",
  "uuid": "009cdcfb-2509-4884-a042-2278bec844ae",
  "title": "Create CSS theme system with built-in themes",
  "description": "# Create CSS Theme System with Built-in Themes\n\n## User Story\n**As a** Consoul user\n**I want** customizable color themes for the TUI\n**So that** I can personalize the interface appearance to match my preferences and terminal setup\n\n## Description\n\nImplement a theme system for the Consoul TUI using Textual CSS (TCSS) with a hybrid approach: core styles in TCSS files with Python helpers for runtime theme switching. Create 4 built-in themes (monokai, dracula, nord, gruvbox) based on research findings. The system should support easy theme switching via configuration or keyboard shortcut.\n\n## Context\n\nResearch (TUI_RESEARCH.md \"Design Decisions Post-Review\" ยง7) recommends a hybrid TCSS + Python approach:\n- Base styles in `.tcss` files (Textual's CSS format)\n- Python theme loader for runtime switching\n- Computed color palettes for light/dark variants\n\nBoth Gira and Postings use extensive CSS styling. Textual supports CSS-like syntax with variables, inheritance, and responsive design.\n\n**Key References:**\n- TUI_RESEARCH.md ยง7 \"Theme System\"\n- Gira: `src/gira/tui/css/main.tcss`, `src/gira/tui/themes/`\n- Postings: `src/posting/posting.scss`\n- Textual CSS Guide: https://textual.textualize.io/guide/CSS/\n\n## Technical Notes\n\n**Files to Create:**\n\n1. **`src/consoul/tui/css/main.tcss`** - Base stylesheet\n2. **`src/consoul/tui/css/themes/monokai.tcss`** - Monokai theme\n3. **`src/consoul/tui/css/themes/dracula.tcss`** - Dracula theme\n4. **`src/consoul/tui/css/themes/nord.tcss`** - Nord theme\n5. **`src/consoul/tui/css/themes/gruvbox.tcss`** - Gruvbox theme\n6. **`src/consoul/tui/themes/__init__.py`** - Theme utilities\n7. **`src/consoul/tui/themes/loader.py`** - Theme loading logic\n\n**Base Stylesheet (`main.tcss`):**\n\n```css\n/* Main TUI stylesheet - base structure and layout */\n\nScreen {\n    background: $surface;\n}\n\nHeader {\n    dock: top;\n    height: 3;\n    background: $primary;\n    color: $text;\n}\n\nFooter {\n    dock: bottom;\n    height: 1;\n    background: $surface-darken-1;\n}\n\n/* Chat view - main content area */\n.chat-view {\n    width: 1fr;\n    height: 100%;\n    background: $panel;\n    padding: 1;\n}\n\n/* Message bubbles */\n.message-user {\n    background: $primary;\n    color: $text;\n    padding: 1 2;\n    margin: 1 0;\n    border: tall $accent;\n}\n\n.message-assistant {\n    background: $secondary;\n    color: $text;\n    padding: 1 2;\n    margin: 1 0;\n    border: tall $success;\n}\n\n/* Conversation sidebar */\n.conversation-list {\n    width: 30%;\n    height: 100%;\n    background: $surface-darken-1;\n    border-right: solid $accent;\n}\n\n/* Input area */\n.input-area {\n    dock: bottom;\n    height: auto;\n    max-height: 10;\n    background: $panel;\n    border-top: solid $accent;\n    padding: 1;\n}\n\n/* Loading indicator */\n.loading {\n    opacity: 0.7;\n    text-style: italic;\n}\n\n/* Streaming indicator */\n.streaming {\n    color: $success;\n    text-style: bold;\n}\n```\n\n**Theme File Example (`monokai.tcss`):**\n\n```css\n/* Monokai Theme - inspired by Sublime Text color scheme */\n\n$surface: #272822;\n$surface-lighten-1: #3E3D32;\n$surface-darken-1: #1E1F1C;\n\n$primary: #F92672;     /* Pink */\n$secondary: #66D9EF;   /* Cyan */\n$accent: #E6DB74;      /* Yellow */\n$success: #A6E22E;     /* Green */\n$warning: #FD971F;     /* Orange */\n$error: #F92672;       /* Pink */\n\n$text: #F8F8F2;        /* Foreground */\n$text-muted: #75715E;  /* Comment */\n\n$panel: #272822;\n```\n\n**Theme Loader (`themes/loader.py`):**\n\n```python\nfrom pathlib import Path\nfrom typing import Literal\n\nThemeName = Literal[\"monokai\", \"dracula\", \"nord\", \"gruvbox\"]\n\ndef get_theme_path(theme: ThemeName) -> Path:\n    \"\"\"Get path to theme CSS file.\"\"\"\n    themes_dir = Path(__file__).parent.parent / \"css\" / \"themes\"\n    return themes_dir / f\"{theme}.tcss\"\n\ndef load_theme(theme: ThemeName) -> str:\n    \"\"\"Load theme CSS content.\"\"\"\n    theme_path = get_theme_path(theme)\n    if not theme_path.exists():\n        raise FileNotFoundError(f\"Theme not found: {theme}\")\n    return theme_path.read_text(encoding=\"utf-8\")\n\ndef get_available_themes() -> list[ThemeName]:\n    \"\"\"Get list of available theme names.\"\"\"\n    return [\"monokai\", \"dracula\", \"nord\", \"gruvbox\"]\n```\n\n**Integration with ConsoulApp:**\n\n```python\n# src/consoul/tui/app.py\nfrom consoul.tui.themes.loader import get_theme_path\n\nclass ConsoulApp(App):\n    CSS_PATH = [\n        \"css/main.tcss\",\n        get_theme_path(self.config.theme),  # Dynamic theme loading\n    ]\n```\n\n**Theme Color Palettes:**\n\n**Monokai:** (already shown above)\n- Background: #272822\n- Primary: #F92672 (pink)\n- Text: #F8F8F2\n\n**Dracula:**\n- Background: #282A36\n- Primary: #BD93F9 (purple)\n- Success: #50FA7B (green)\n- Text: #F8F8F2\n\n**Nord:**\n- Background: #2E3440\n- Primary: #88C0D0 (cyan)\n- Success: #A3BE8C (green)\n- Text: #ECEFF4\n\n**Gruvbox:**\n- Background: #282828\n- Primary: #FE8019 (orange)\n- Success: #B8BB26 (green)\n- Text: #EBDBB2\n\n## Acceptance Criteria\n\n**Given** I launch ConsoulApp with theme=\"monokai\"\n**When** the TUI renders\n**Then** colors match the Monokai palette\n\n**Given** I have ConsoulApp running\n**When** I call `app.action_cycle_theme()`\n**Then** the theme switches to the next in the list\n\n**Given** I set an invalid theme in config\n**When** ConsoulApp initializes\n**Then** a FileNotFoundError is raised with helpful message\n\n**Given** I call `get_available_themes()`\n**When** the function executes\n**Then** it returns [\"monokai\", \"dracula\", \"nord\", \"gruvbox\"]\n\n**Given** all 4 themes are installed\n**When** I test each theme\n**Then** all CSS variables are defined and widgets render correctly\n\n## Testing Considerations\n\n**Manual Testing:**\n- Launch TUI with each theme\n- Verify colors match expected palette\n- Test theme switching at runtime\n- Check all widget types render correctly\n\n**Visual Tests (Optional):**\n```python\n@pytest.mark.snapshot\ndef test_monokai_theme_snapshot():\n    \"\"\"Visual regression test for monokai theme.\"\"\"\n    app = ConsoulApp(config=TuiConfig(theme=\"monokai\"))\n    # textual-dev snapshot comparison\n```\n\n**Unit Tests:**\n```python\ndef test_get_theme_path():\n    \"\"\"Test theme path resolution.\"\"\"\n    path = get_theme_path(\"monokai\")\n    assert path.exists()\n    assert path.suffix == \".tcss\"\n\ndef test_load_theme():\n    \"\"\"Test theme content loading.\"\"\"\n    content = load_theme(\"monokai\")\n    assert \"$surface:\" in content\n    assert \"$primary:\" in content\n\ndef test_invalid_theme():\n    \"\"\"Test error handling for invalid theme.\"\"\"\n    with pytest.raises(FileNotFoundError):\n        load_theme(\"nonexistent\")\n```\n\n## Implementation Hints\n\n1. Start with `main.tcss` defining layout structure\n2. Create `monokai.tcss` as first theme\n3. Copy/modify color variables for other 3 themes\n4. Implement `themes/loader.py` utilities\n5. Update ConsoulApp to load theme dynamically\n6. Test each theme manually\n7. Add `action_cycle_theme()` implementation\n8. Write unit tests\n\n**Theme Development Workflow:**\n```bash\n# Edit theme file\nvim src/consoul/tui/css/themes/monokai.tcss\n\n# Launch with theme\npython -m consoul.tui.cli --theme monokai\n\n# Use Textual dev console for live CSS editing\ntextual run consoul.tui.cli:tui --dev\n```\n\n**Color Testing:**\nUse Textual's color preview to verify palettes:\n```python\nfrom rich.console import Console\nconsole = Console()\nconsole.print(\"[#F92672]Monokai Primary[/]\")\n```\n\n## Files to Create/Modify\n\n**New Files:**\n- src/consoul/tui/css/main.tcss\n- src/consoul/tui/css/themes/monokai.tcss\n- src/consoul/tui/css/themes/dracula.tcss\n- src/consoul/tui/css/themes/nord.tcss\n- src/consoul/tui/css/themes/gruvbox.tcss\n- src/consoul/tui/themes/__init__.py\n- src/consoul/tui/themes/loader.py\n- tests/tui/themes/__init__.py\n- tests/tui/themes/test_themes.py\n\n**Modified Files:**\n- src/consoul/tui/app.py (CSS_PATH, action_cycle_theme)\n\n## Dependencies\n\n**Prerequisites:**\n- SOUL-32 complete (css/ directory exists)\n- SOUL-34 complete (ConsoulApp exists)\n\n**Blocks:**\n- Phase 2 widgets (will use these styles)\n- SOUL-49 (theme switching UI in Phase 4)",
  "status": "done",
  "type": "feature",
  "priority": "medium",
  "labels": [
    "tui",
    "theme",
    "css",
    "ux-improvement"
  ],
  "assignee": "jared@goatbytes.io",
  "reporter": "jared@goatbytes.io",
  "epic_id": "EPIC-003",
  "blocked_by": [],
  "blocks": [],
  "comments": [],
  "attachments": [],
  "attachment_count": 0,
  "comment_count": 0,
  "story_points": 5,
  "order": 0,
  "custom_fields": {}
}