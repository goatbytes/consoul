{
  "created_at": "2025-11-09T20:11:43.189884",
  "updated_at": "2025-11-11T04:27:46.252764Z",
  "id": "SOUL-36",
  "uuid": "c85355b1-7e7e-4c22-b4e9-fb3d692ef983",
  "title": "Create ChatView widget for message display",
  "description": "# Create ChatView Widget for Message Display\n\n## User Story\n**As a** Consoul user\n**I want** a scrollable chat view that displays conversation messages\n**So that** I can see the full conversation history with proper layout and styling\n\n## Description\n\nCreate the ChatView widget that serves as the main container for displaying conversation messages. This widget manages the vertical layout of message bubbles, handles scrolling behavior, and provides the primary visual area for AI conversations in the TUI.\n\n## Context\n\nFrom TUI_RESEARCH.md:\n- Gira uses a ScrollableContainer pattern for message display\n- Postings uses VerticalScroll with lazy loading\n- Textual best practices recommend using ScrollableContainer or VerticalScroll for long content\n- ChatView should be responsive and handle dynamic content addition\n\n**Key Reference:** TUI_RESEARCH.md ยง3 \"Widget Architecture\"\n\n## Technical Notes\n\n**File:** `src/consoul/tui/widgets/chat_view.py`\n\n**Implementation:**\n\n```python\nfrom textual.containers import VerticalScroll\nfrom textual.widgets import Static\nfrom textual.reactive import reactive\n\n\nclass ChatView(VerticalScroll):\n    \"\"\"Main chat message display area.\n    \n    Displays conversation messages in a scrollable vertical layout.\n    Automatically scrolls to bottom when new messages arrive.\n    \"\"\"\n    \n    # Reactive state\n    auto_scroll: reactive[bool] = reactive(True)\n    message_count: reactive[int] = reactive(0)\n    \n    def __init__(self, **kwargs) -> None:\n        super().__init__(**kwargs)\n        self.can_focus = True\n    \n    def on_mount(self) -> None:\n        \"\"\"Initialize chat view on mount.\"\"\"\n        self.border_title = \"Conversation\"\n    \n    async def add_message(self, message_widget: Widget) -> None:\n        \"\"\"Add a message to the chat view.\n        \n        Args:\n            message_widget: MessageBubble widget to add\n        \"\"\"\n        await self.mount(message_widget)\n        self.message_count += 1\n        \n        if self.auto_scroll:\n            # Scroll to bottom to show new message\n            self.scroll_end(animate=True)\n    \n    async def clear_messages(self) -> None:\n        \"\"\"Remove all messages from the chat view.\"\"\"\n        await self.remove_children()\n        self.message_count = 0\n    \n    def watch_message_count(self, count: int) -> None:\n        \"\"\"Update border title with message count.\"\"\"\n        if count > 0:\n            self.border_title = f\"Conversation ({count} messages)\"\n        else:\n            self.border_title = \"Conversation\"\n```\n\n**CSS (in main.tcss):**\n\n```css\nChatView {\n    width: 100%;\n    height: 1fr;\n    background: $panel;\n    padding: 1 2;\n    border: solid $accent;\n}\n\nChatView:focus {\n    border: heavy $primary;\n}\n```\n\n**Key Features:**\n- Auto-scroll to bottom on new messages\n- Message counter in border title\n- Keyboard scrolling (up/down/pageup/pagedown)\n- Clear all messages functionality\n- Proper focus handling\n\n## Acceptance Criteria\n\n**Given** I create a ChatView widget\n**When** I mount it to the app\n**Then** it displays with border title \"Conversation\"\n\n**Given** I add a message to ChatView\n**When** the message is mounted\n**Then** the view auto-scrolls to show the new message\n\n**Given** ChatView has 5 messages\n**When** I check the border title\n**Then** it shows \"Conversation (5 messages)\"\n\n**Given** ChatView has messages\n**When** I call clear_messages()\n**Then** all messages are removed and count resets to 0\n\n**Given** ChatView is focused\n**When** I press up/down arrow keys\n**Then** the view scrolls accordingly\n\n## Testing Considerations\n\n**Test File:** `tests/tui/widgets/test_chat_view.py`\n\n```python\nfrom textual.widgets import Label\nfrom consoul.tui.widgets.chat_view import ChatView\n\n\nasync def test_chat_view_mounts():\n    \"\"\"Test ChatView can be mounted.\"\"\"\n    view = ChatView()\n    assert view.border_title == \"Conversation\"\n    assert view.message_count == 0\n\n\nasync def test_add_message():\n    \"\"\"Test adding messages to ChatView.\"\"\"\n    view = ChatView()\n    message = Label(\"Test message\")\n    \n    await view.add_message(message)\n    \n    assert view.message_count == 1\n    assert view.border_title == \"Conversation (1 messages)\"\n\n\nasync def test_clear_messages():\n    \"\"\"Test clearing all messages.\"\"\"\n    view = ChatView()\n    \n    # Add some messages\n    for i in range(3):\n        await view.add_message(Label(f\"Message {i}\"))\n    \n    assert view.message_count == 3\n    \n    await view.clear_messages()\n    \n    assert view.message_count == 0\n    assert view.border_title == \"Conversation\"\n```\n\n## Implementation Hints\n\n1. Start with VerticalScroll as base class\n2. Add reactive message_count and auto_scroll\n3. Implement add_message() with auto-scroll\n4. Add clear_messages() method\n5. Create widget tests\n6. Test keyboard scrolling behavior\n7. Verify CSS styling matches theme\n\n**Integration with ConsoulApp:**\n\n```python\n# In ConsoulApp.compose()\nfrom consoul.tui.widgets.chat_view import ChatView\n\ndef compose(self) -> ComposeResult:\n    yield Header()\n    yield ChatView()\n    yield Footer()\n```\n\n## Files to Create/Modify\n\n**New Files:**\n- src/consoul/tui/widgets/chat_view.py\n- tests/tui/widgets/__init__.py\n- tests/tui/widgets/test_chat_view.py\n\n**Modified Files:**\n- src/consoul/tui/widgets/__init__.py (export ChatView)\n- src/consoul/tui/css/main.tcss (add ChatView styles)\n\n## Dependencies\n\n**Prerequisites:**\n- SOUL-32 complete (widgets/ directory exists)\n- SOUL-35 complete (CSS theme system)\n- Textual framework installed\n\n**Blocks:**\n- SOUL-37 (MessageBubble will be added to ChatView)",
  "status": "done",
  "type": "feature",
  "priority": "high",
  "labels": [
    "tui",
    "widgets",
    "textual"
  ],
  "assignee": "jared@goatbytes.io",
  "reporter": "jared@goatbytes.io",
  "epic_id": "EPIC-003",
  "blocked_by": [],
  "blocks": [],
  "comments": [],
  "attachments": [],
  "attachment_count": 0,
  "comment_count": 0,
  "story_points": 5,
  "order": 0,
  "custom_fields": {}
}