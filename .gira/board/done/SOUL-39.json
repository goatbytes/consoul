{
  "created_at": "2025-11-09T20:13:40.068538",
  "updated_at": "2025-11-11T04:27:46.235255Z",
  "id": "SOUL-39",
  "uuid": "d06fc3b7-145c-4da1-9ecc-ad1872deaba1",
  "title": "Create InputArea widget with multi-line support",
  "description": "# Create InputArea Widget with Multi-Line Support\n\n## User Story\n**As a** Consoul user\n**I want** a text input area that supports multi-line messages\n**So that** I can compose complex prompts and send them to the AI\n\n## Description\n\nCreate the InputArea widget that provides a multi-line text input field with keyboard shortcuts for sending messages. This is an MVP feature (from TUI_RESEARCH.md) that uses TextArea with shift+enter for newlines and enter to send.\n\n## Context\n\nFrom TUI_RESEARCH.md ยง6.6 \"Multi-Line Input (MVP Feature)\":\n- Use Textual's TextArea widget\n- Shift+Enter for newline\n- Enter (or Ctrl+Enter) to send\n- Clear input after send\n- Optional syntax highlighting\n\n**Key Reference:** TUI_RESEARCH.md ยง6.6\n\n## Technical Notes\n\n**File:** `src/consoul/tui/widgets/input_area.py`\n\n```python\nfrom textual.widgets import TextArea\nfrom textual.containers import Container\nfrom textual.message import Message\nfrom textual.reactive import reactive\n\n\nclass InputArea(Container):\n    \"\"\"Multi-line text input area for composing messages.\n    \n    Supports shift+enter for newlines and enter/ctrl+enter to send.\n    \"\"\"\n    \n    class MessageSubmit(Message):\n        \"\"\"Message sent when user submits input.\"\"\"\n        \n        def __init__(self, content: str) -> None:\n            super().__init__()\n            self.content = content\n    \n    # Reactive state\n    character_count: reactive[int] = reactive(0)\n    \n    def __init__(self, **kwargs) -> None:\n        super().__init__(**kwargs)\n        self.text_area = TextArea()\n        self.text_area.show_line_numbers = False\n    \n    def compose(self) -> ComposeResult:\n        \"\"\"Compose input area widgets.\"\"\"\n        yield self.text_area\n    \n    def on_mount(self) -> None:\n        \"\"\"Initialize input area on mount.\"\"\"\n        self.border_title = \"Message (Enter to send, Shift+Enter for newline)\"\n        self.add_class(\"input-area\")\n        \n        # Focus the text area\n        self.text_area.focus()\n    \n    def on_text_area_changed(self, event: TextArea.Changed) -> None:\n        \"\"\"Update character count when text changes.\"\"\"\n        self.character_count = len(self.text_area.text)\n        \n        # Update border title with count\n        if self.character_count > 0:\n            self.border_title = f\"Message ({self.character_count} chars) - Enter to send\"\n        else:\n            self.border_title = \"Message (Enter to send, Shift+Enter for newline)\"\n    \n    async def on_key(self, event: events.Key) -> None:\n        \"\"\"Handle keyboard shortcuts.\"\"\"\n        # Enter without shift = send\n        if event.key == \"enter\" and not event.shift:\n            event.prevent_default()\n            await self._send_message()\n        \n        # Ctrl+Enter = send (alternative)\n        elif event.key == \"enter\" and event.ctrl:\n            event.prevent_default()\n            await self._send_message()\n        \n        # Shift+Enter = newline (default TextArea behavior)\n        # Escape = clear\n        elif event.key == \"escape\":\n            event.prevent_default()\n            self.clear()\n    \n    async def _send_message(self) -> None:\n        \"\"\"Send the current message.\"\"\"\n        content = self.text_area.text.strip()\n        \n        if not content:\n            return  # Don't send empty messages\n        \n        # Post message event\n        self.post_message(self.MessageSubmit(content))\n        \n        # Clear input\n        self.clear()\n    \n    def clear(self) -> None:\n        \"\"\"Clear the input area.\"\"\"\n        self.text_area.clear()\n        self.character_count = 0\n        self.text_area.focus()\n```\n\n**CSS:**\n\n```css\nInputArea {\n    dock: bottom;\n    height: auto;\n    max-height: 10;\n    background: $surface-lighten-1;\n    padding: 1;\n    border-top: solid $accent;\n}\n\nInputArea TextArea {\n    width: 100%;\n    height: auto;\n    background: $panel;\n    color: $text;\n    border: round $primary;\n}\n\nInputArea TextArea:focus {\n    border: heavy $primary;\n}\n```\n\n## Acceptance Criteria\n\n**Given** I mount InputArea\n**When** it initializes\n**Then** it has focus and shows help text in border title\n\n**Given** I type text\n**When** characters are entered\n**Then** character count updates in border title\n\n**Given** I press Enter without Shift\n**When** there is text in the input\n**Then** MessageSubmit event is posted and input is cleared\n\n**Given** I press Shift+Enter\n**When** in the middle of typing\n**Then** a newline is inserted (no send)\n\n**Given** I press Escape\n**When** there is text in input\n**Then** input is cleared\n\n**Given** input is empty\n**When** I press Enter\n**Then** no message is sent (empty messages rejected)\n\n## Testing Considerations\n\n**Test File:** `tests/tui/widgets/test_input_area.py`\n\n```python\nfrom textual.events import Key\nfrom consoul.tui.widgets.input_area import InputArea\n\n\nasync def test_input_area_mounts():\n    \"\"\"Test InputArea initialization.\"\"\"\n    widget = InputArea()\n    assert widget.character_count == 0\n    assert \"Enter to send\" in widget.border_title\n\n\nasync def test_character_count():\n    \"\"\"Test character counting.\"\"\"\n    widget = InputArea()\n    \n    widget.text_area.text = \"Hello\"\n    # Trigger change event\n    await widget.on_text_area_changed(widget.text_area.Changed())\n    \n    assert widget.character_count == 5\n    assert \"5 chars\" in widget.border_title\n\n\nasync def test_send_message():\n    \"\"\"Test sending a message.\"\"\"\n    widget = InputArea()\n    messages = []\n    \n    # Capture MessageSubmit events\n    def on_message(event):\n        messages.append(event.content)\n    \n    widget.text_area.text = \"Test message\"\n    await widget._send_message()\n    \n    assert widget.text_area.text == \"\"  # Cleared\n    assert widget.character_count == 0\n\n\nasync def test_empty_message_not_sent():\n    \"\"\"Test that empty messages are not sent.\"\"\"\n    widget = InputArea()\n    \n    widget.text_area.text = \"   \"  # Whitespace only\n    await widget._send_message()\n    \n    # Should not post message (whitespace stripped)\n\n\nasync def test_clear():\n    \"\"\"Test clearing input.\"\"\"\n    widget = InputArea()\n    widget.text_area.text = \"Some text\"\n    \n    widget.clear()\n    \n    assert widget.text_area.text == \"\"\n    assert widget.character_count == 0\n```\n\n## Implementation Hints\n\n1. Start with Container to hold TextArea\n2. Configure TextArea (no line numbers)\n3. Add key event handlers for Enter/Shift+Enter\n4. Implement MessageSubmit custom message\n5. Add character counter\n6. Test keyboard shortcuts\n7. Verify focus behavior\n\n**Keyboard Shortcut Testing:**\n\n```python\nasync def test_enter_sends():\n    \"\"\"Test Enter key sends message.\"\"\"\n    widget = InputArea()\n    widget.text_area.text = \"Message\"\n    \n    # Simulate Enter key (without shift)\n    event = Key(key=\"enter\", shift=False)\n    await widget.on_key(event)\n    \n    # Should have sent and cleared\n\n\nasync def test_shift_enter_newline():\n    \"\"\"Test Shift+Enter inserts newline.\"\"\"\n    widget = InputArea()\n    widget.text_area.text = \"Line 1\"\n    \n    # Simulate Shift+Enter\n    event = Key(key=\"enter\", shift=True)\n    await widget.on_key(event)\n    \n    # Should NOT send (default TextArea behavior for newline)\n```\n\n## Files to Create/Modify\n\n**New Files:**\n- src/consoul/tui/widgets/input_area.py\n- tests/tui/widgets/test_input_area.py\n\n**Modified Files:**\n- src/consoul/tui/widgets/__init__.py\n- src/consoul/tui/css/main.tcss\n\n## Dependencies\n\n**Prerequisites:**\n- SOUL-32 complete (widgets/ directory)\n- SOUL-35 complete (CSS styles)\n- Textual TextArea widget\n\n**Blocks:**\n- SOUL-41 (AI integration listens for MessageSubmit)",
  "status": "done",
  "type": "feature",
  "priority": "high",
  "labels": [
    "tui",
    "widgets",
    "input"
  ],
  "assignee": "jared@goatbytes.io",
  "reporter": "jared@goatbytes.io",
  "epic_id": "EPIC-003",
  "blocked_by": [],
  "blocks": [],
  "comments": [],
  "attachments": [],
  "attachment_count": 0,
  "comment_count": 0,
  "story_points": 5,
  "order": 0,
  "custom_fields": {}
}