{
  "created_at": "2025-11-10T19:46:06.537607",
  "updated_at": "2025-11-11T06:29:17.739837Z",
  "id": "SOUL-60",
  "uuid": "cc07ee78-74c8-4491-8da2-188285417b84",
  "title": "Implement bash tool with security controls",
  "description": "**As a** Consoul user\n**I want** to execute bash commands requested by AI with strict security controls\n**So that** I can safely run shell commands with timeout, whitelist/blacklist, and sandboxing\n\n**Context:**\nBash tool execution is the foundational MVP tool. LangChain provides @tool decorator for creating tools with automatic schema generation. Aider implements shell command execution with approval prompts.\n\nSecurity is critical:\n- Never auto-execute without approval\n- Block dangerous commands by default (rm -rf /, sudo, dd, etc.)\n- Enforce timeouts (default 30s)\n- Capture stdout/stderr separately\n- Handle interrupts (Ctrl+C)\n- Set working directory from config\n\n**Technical Notes:**\n- Use LangChain @tool decorator:\n  ```python\n  from langchain.tools import tool\n  \n  @tool\n  def bash_execute(command: str) -> str:\n      '''Execute a bash command and return output.\n      \n      Args:\n          command: The bash command to execute\n          \n      Returns:\n          Command output (stdout + stderr)\n      '''\n  ```\n- Use subprocess with timeout\n- Capture output in real-time if possible\n- Parse exit codes\n- Sanitize/validate commands before execution\n- Integrate with ToolRegistry from SOUL-58\n\n**Acceptance Criteria:**\n\n**Given** AI requests: \"list files in current directory\"\n**When** bash tool is invoked with 'ls -la'\n**Then** command executes and returns directory listing\n\n**Given** AI requests: \"delete all files\" (rm -rf *)\n**When** bash tool validates the command\n**Then** command is blocked before approval modal shows\n\n**Given** bash command runs longer than timeout\n**When** 30 seconds elapse\n**Then** process is killed and timeout error returned\n\n**Given** bash command is executing\n**When** I cancel the operation (Ctrl+C)\n**Then** process terminates gracefully\n\n**Given** bash command fails (exit code \\!= 0)\n**When** command completes\n**Then** stderr and exit code are returned in result\n\n**Testing Considerations:**\n- Unit test command validation logic\n- Test blocked command detection\n- Test timeout enforcement\n- Test stdout/stderr capture\n- Test exit code handling\n- Integration test with tool registry\n- Mock subprocess for safety in tests\n\n**Implementation Hints:**\n- Blocked commands regex patterns:\n  ```python\n  BLOCKED_PATTERNS = [\n      r'^sudo\\s',\n      r'rm\\s+(-[rf]+\\s+)?/',\n      r'dd\\s+if=',\n      r'chmod\\s+777',\n      r':(){ :\\|:& };:',  # fork bomb\n      r'wget.*\\|.*bash',\n      r'curl.*\\|.*sh',\n  ]\n  ```\n- Execution with timeout:\n  ```python\n  result = subprocess.run(\n      command,\n      shell=True,\n      capture_output=True,\n      text=True,\n      timeout=timeout,\n      cwd=working_dir,\n  )\n  ```\n- Tool configuration:\n  ```python\n  class BashToolConfig(BaseModel):\n      timeout: int = 30\n      working_directory: str = '.'\n      blocked_commands: list[str] = [...]\n      allowed_commands: list[str] = []  # whitelist\n  ```\n\n**Files to Create:**\n- src/consoul/ai/tools/bash.py\n\n**Files to Modify:**\n- src/consoul/ai/tools/registry.py (register bash tool)\n- src/consoul/config/models.py (add BashToolConfig)\n\n**Dependencies:**\n- SOUL-58 (Tool registry must exist first)\n\nStory Points: 5",
  "status": "done",
  "type": "feature",
  "priority": "high",
  "labels": [
    "ai",
    "tools",
    "security",
    "enhancement"
  ],
  "assignee": "jared@goatbytes.io",
  "reporter": "jared@goatbytes.io",
  "epic_id": "EPIC-004",
  "blocked_by": [],
  "blocks": [],
  "comments": [],
  "attachments": [],
  "attachment_count": 0,
  "comment_count": 0,
  "order": 0,
  "custom_fields": {}
}