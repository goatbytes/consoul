{
  "created_at": "2025-12-16T13:55:02.197940",
  "updated_at": "2025-12-17T19:28:11.963899",
  "id": "SOUL-289",
  "uuid": "f9707be5-7cea-4eb9-ae88-dd5437c312b2",
  "title": "Decouple ProfileConfig from SDK core layer",
  "description": "**As a** Consoul architect\n**I want** profiles to be a TUI/CLI convenience feature, not a core SDK requirement\n**So that** Consoul can serve as a general-purpose LLM SDK for any domain\n\n**Context:**\nProfileConfig (src/consoul/config/models.py:1379-1427) is currently embedded in the SDK core:\n- ConsoulConfig.profiles: dict[str, ProfileConfig] (line 1445)\n- ConsoulConfig.active_profile: str (line 1448)\n- SDK wrapper defaults to profile=\"default\" (src/consoul/sdk/wrapper.py:111)\n- ChatSession builds system prompt from profile (src/consoul/cli/chat_session.py:100-111)\n\nThis couples SDK to TUI/CLI workflow concepts. Profiles bundle:\n1. System prompt templates (workflow identity)\n2. Model configuration (which AI to use)\n3. Conversation settings (persistence, summarization)\n4. Context settings (env/git injection)\n\nIssues:\n- SDK users must understand profiles even for simple use cases\n- Profiles assume coding assistant domain\n- Breaks separation between SDK (library) and TUI (application)\n- Prevents Consoul from being a general-purpose LLM integration library\n\n**Desired State:**\n- SDK core: No profile dependency, explicit configuration\n- TUI/CLI layer: Optional profile system for workflow convenience\n- Config files: Profiles remain for user convenience\n- Backward compat: Existing profile-based usage still works\n\n**Technical Notes:**\n- src/consoul/config/models.py:1379-1427 - ProfileConfig definition\n- src/consoul/config/models.py:1445-1450 - Profile fields in ConsoulConfig\n- src/consoul/sdk/wrapper.py:111, 244-262 - Profile usage in SDK\n- src/consoul/cli/chat_session.py:100-111 - Profile usage in ChatSession\n- src/consoul/config/profiles.py:16-156 - Built-in coding profiles\n\n**Acceptance Criteria:**\n\n**Given** I am using Consoul SDK for a non-TUI application\n**When** I import and use Consoul\n**Then** I do not need to understand or configure profiles\n\n**Given** I am using Consoul TUI/CLI\n**When** I use profiles for workflow management\n**Then** Profile system continues to work as convenience layer\n\n**Given** existing code uses profiles\n**When** I upgrade to new version\n**Then** Backward compatibility is maintained (deprecation warnings OK)\n\n**Given** I am building a domain-specific agent\n**When** I configure Consoul\n**Then** I set model, system_prompt, and settings directly without profile abstraction\n\n**Testing Considerations:**\n- Test SDK usage without profiles (headless mode)\n- Test TUI/CLI with profiles (backward compat)\n- Test profile migration/deprecation path\n- Document migration guide for profile-dependent code\n- Validate all examples work without profiles\n\n**Implementation Hints:**\nWARNING: This is a breaking change requiring careful migration\n\nPhase 1 (Deprecation):\n- Make ProfileConfig optional in SDK\n- Add deprecation warnings for profile-dependent SDK usage\n- Update docs to show profile-free SDK examples\n- Keep TUI/CLI profile support unchanged\n\nPhase 2 (Extraction):\n- Move ProfileConfig to consoul.tui.config or consoul.cli.config\n- Create ProfileManager service for TUI/CLI only\n- Update ConsoulConfig to be profile-agnostic\n- SDK uses explicit model/config, TUI wraps with profiles\n\nPhase 3 (Cleanup):\n- Remove profile fields from core ConsoulConfig (major version bump)\n- Profiles become pure TUI/CLI feature\n- Document \"profiles as workflow templates\" pattern\n\nConsider: Should this wait for SOUL-285 (profile-optional constructor)?\nConsider: Epic for breaking refactor with migration guide?\n\n**Dependencies:**\n- Blocked by: SOUL-285 (profile-optional constructor) must ship first\n- Related: SOUL-287 (flexible prompt builder) for profile-free context\n- Breaking change: Requires major version bump (v1.0.0 or v2.0.0)",
  "status": "in_progress",
  "type": "task",
  "priority": "low",
  "labels": [
    "refactor",
    "sdk",
    "config",
    "breaking-change"
  ],
  "reporter": "jared@goatbytes.io",
  "epic_id": "EPIC-015",
  "blocked_by": [],
  "blocks": [],
  "comments": [
    {
      "created_at": "2025-12-17T16:22:32.255438",
      "updated_at": "2025-12-17T16:22:32.255439",
      "id": "20251217162232-e50cb252",
      "ticket_id": "SOUL-289",
      "author": "jared@goatbytes.io",
      "content": "Phase 1 Complete: Deprecation & Soft Migration\n\n✅ Implemented deprecation warnings in SDK wrapper (src/consoul/sdk/wrapper.py:361-368)\n✅ Created comprehensive migration guide (docs/api/integration-guide.md:482-669)\n✅ Updated SDK examples to show profile-free patterns\n   - examples/sdk/custom_profile.py: Deprecated vs recommended comparison\n   - examples/sdk/quick_start.py: Profile-free quick start\n   - examples/sdk/domain_specific.py: NEW - Legal, medical, support examples\n✅ Added 4 deprecation warning tests (tests/unit/test_profile_optional.py:414-540)\n\nAll tests passing (4/4 deprecation tests + 13/13 profile-optional tests)\n\nCommit: 5ad4427",
      "edited": false,
      "edit_count": 0,
      "is_ai_generated": false,
      "attachments": [],
      "attachment_count": 0
    },
    {
      "created_at": "2025-12-17T17:09:24.750654",
      "updated_at": "2025-12-17T17:09:24.750655",
      "id": "20251217170924-525b35a0",
      "ticket_id": "SOUL-289",
      "author": "jared@goatbytes.io",
      "content": "Phase 2 WIP: Steps 1-3 Complete (30% done)\n\n## Completed Work\n\n### Step 1: TUI Profile Module & Backward Compatibility (7b0003d)\n- Created src/consoul/tui/profiles.py (279 lines)\n- Added backward compatibility re-exports with deprecation warnings\n- Testing: All 17 tests pass, no circular imports\n\n### Step 2: ProfileManager SDK Translation (e1eed05)\n- Added 4 SDK translation methods (+133 lines)\n- All methods validated and working\n\n### Step 3: ConsoulTuiConfig Separation (1ac5e95)\n- Removed profiles from ConsoulCoreConfig\n- Added profiles to ConsoulTuiConfig\n- Clear architectural separation\n\n## Current State\nBranch: feat/SOUL-289-phase2-profile-extraction\nLatest commit: 1ac5e95\nProgress: 3/10 Phase 2 steps (30%)\n\nKnown issues: 29 mypy errors in 6 files (expected, will fix in Steps 4-10)\n\n## Remaining Work (Steps 4-10)\nStep 4: Update config loader dual-path (2-3h)\nStep 5: Update SDK wrapper (1-2h)\nStep 6: Update CLI chat_session (1-2h)\nStep 7: Update TUI app (1-2h)\nStep 8: Fix imports across 17 files (1-2h)\nStep 9: Update tests (2-3h)\nStep 10: Integration testing (1-2h)\n\nEstimated remaining: 12-19 hours\n\nNext: Use parallel agents for Steps 4-10",
      "edited": false,
      "edit_count": 0,
      "is_ai_generated": false,
      "attachments": [],
      "attachment_count": 0
    },
    {
      "created_at": "2025-12-17T18:16:01.825185",
      "updated_at": "2025-12-17T18:16:01.825186",
      "id": "20251217181601-7d7e9396",
      "ticket_id": "SOUL-289",
      "author": "jared@goatbytes.io",
      "content": "y\nPhase 2 COMPLETE: Profile Extraction via Parallel Agents ✅\n\nAll 10 Phase 2 steps implemented successfully using 4 parallel agents.\n\n## Execution Summary\n\nAgent 1 (Steps 4-5): Config loader + SDK wrapper (commit 050fb0f) ✅\nAgent 2 (Steps 6-7): CLI + TUI updates (commit a0328d0) ✅  \nAgent 3 (Step 8): Import fixes across 17 files (commit 07d6936) ✅\nAgent 4 (Steps 9-10): Tests + validation ✅\nIntegration: Commit 8bea440 ✅\n\n## Architectural Achievement\n\n✅ SDK Core is Profile-Free (load_config → ConsoulCoreConfig)\n✅ TUI Layer Manages Profiles (load_tui_config → ConsoulTuiConfig)\n✅ Full Backward Compatibility (deprecation warnings guide migration)\n\n## Validation\n\nTests: 17/17 passing (profile-optional suite)\nRuff: All linting clean\nMypy: 31 type annotation errors (known, will fix in follow-up)\n\n## Files Modified\n\nSource: 16 files (config, SDK, CLI, TUI layers)\nTests: 3 files (updated mocks and imports)\n\n## Known Issues\n\n31 mypy type errors - ConsoulCoreConfig vs ConsoulTuiConfig type mismatches.\nFollow-up commit will add proper type annotations.\n\n## Next Steps\n\n1. Fix mypy type annotations\n2. Verify all acceptance criteria met\n3. Plan Phase 3 (major version bump, final cleanup)\n\nTotal commits: 8 (Phase 1: 1, Phase 2: 7)",
      "edited": false,
      "edit_count": 0,
      "is_ai_generated": false,
      "attachments": [],
      "attachment_count": 0
    },
    {
      "created_at": "2025-12-17T19:28:11.963806",
      "updated_at": "2025-12-17T19:28:11.963808",
      "id": "20251217192811-de170936",
      "ticket_id": "SOUL-289",
      "author": "jared@goatbytes.io",
      "content": "Phase 3 Complete: Profile Parameter Removal (v0.5.0 Breaking Change)\n\n**Implementation Summary:**\n\n✅ **Step 1-2: SDK Cleanup (100%)**\n- Removed `profile` parameter from `Consoul.__init__()`\n- Added TypeError validation for profile parameter\n- Removed ~75 lines of deprecated profile handling code\n- Deleted src/consoul/config/profiles.py\n- Removed __getattr__ backward compatibility from config/models.py\n\n✅ **Step 3-4: Test & Example Updates (100%)**\n- Deleted TestProfileDeprecation class (4 deprecated tests)\n- Deleted 3 profile-based tests from TestProfileOptional\n- Added breaking change test (TypeError verification)\n- Deleted examples/sdk/custom_profile.py\n- Updated examples/sdk/quick_start.py\n\n✅ **Step 5-6: Documentation Updates (100%)**\n- Updated docs/api/integration-guide.md for v0.5.0\n- Enhanced src/consoul/tui/profiles.py docstring (TUI/CLI-only)\n- Added comprehensive v0.5.0 section to CHANGELOG.md with migration guide\n\n✅ **Step 7: Validation (100%)**\n- All 11 profile-optional tests passing (100%)\n- SDK is fully profile-free\n- Profiles remain exclusively for TUI/CLI usage\n\n**Known Issues:**\n⚠️ 19 mypy type errors in TUI code (expected)\n- TUI services still using ConsoulCoreConfig instead of ConsoulTuiConfig\n- These are TUI-specific and don't affect SDK functionality\n- Follow-up work needed for TUI type cleanup\n\n**Achievement:**\n✅ SDK completely decoupled from profiles\n✅ Clean separation: SDK = library, TUI/CLI = application\n✅ Profile parameter removal complete (breaking change)\n✅ Full backward compatibility removal\n✅ Comprehensive documentation and migration guide\n\n**Branch:** feat/SOUL-289-phase2-profile-extraction\n**Commits:** Phase 3 implementation complete\n**Tests:** 11/11 passing",
      "edited": false,
      "edit_count": 0,
      "is_ai_generated": false,
      "attachments": [],
      "attachment_count": 0
    }
  ],
  "attachments": [],
  "attachment_count": 0,
  "comment_count": 4,
  "story_points": 13,
  "order": 40,
  "custom_fields": {}
}