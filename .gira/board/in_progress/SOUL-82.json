{
  "created_at": "2025-11-13T08:39:57.251729",
  "updated_at": "2025-11-13T19:27:31.807419Z",
  "id": "SOUL-82",
  "uuid": "05bad0d3-cbca-4610-9496-dc005ebf3344",
  "title": "Implement file size and line truncation controls",
  "description": "**As a** Consoul user\n**I want** automatic truncation of very long lines and large outputs\n**So that** AI context windows aren't overwhelmed and performance stays good\n\n**Context:**\nLarge files or files with extremely long lines (minified JS, logs, data dumps) can overwhelm AI context windows and cause performance issues. Research shows:\n- Claude Code truncates lines over 2000 chars\n- Claude Code default output limit is around 40,000 chars\n- Cursor limits to 250 lines per read\n- Truncation should be clear with indicators\n\n**Technical Notes:**\n- Modify src/consoul/ai/tools/implementations/read.py\n- Apply max_line_length from config (default 2000 chars)\n- Apply max_output_chars from config (default 40000 chars)\n- Add truncation indicators to output\n- Handle empty files with friendly message\n\n**Acceptance Criteria:**\n\n**Given** a file with a line exceeding 2000 characters\n**When** read_file is called\n**Then** the line is truncated to 2000 chars with \" …[line truncated]\" appended\n\n**Given** total output would exceed 40,000 characters\n**When** read_file is called\n**Then** output is truncated with \"\\\\n…[output truncated - use offset/limit for more]\"\n\n**Given** an empty file (0 bytes)\n**When** read_file is called\n**Then** returns \"[File is empty]\"\n\n**Given** a file exactly at the limit\n**When** read_file is called\n**Then** no truncation occurs, full content returned\n\n**Testing Considerations:**\n- Test with very long lines (minified JavaScript)\n- Test with large files that exceed max_output_chars\n- Test empty files\n- Test files exactly at limits (boundary testing)\n- Verify truncation messages are helpful\n\n**Implementation Hints:**\n```python\ndef _apply_truncation(lines: list[tuple[int, str]], config: ReadToolConfig) -> str:\n    numbered = []\n    total_chars = 0\n    \n    for line_num, content in lines:\n        # Truncate long lines\n        if len(content) > config.max_line_length:\n            content = content[:config.max_line_length] + \" …[line truncated]\"\n        \n        line_output = f\"{line_num:6d}\\\\t{content}\"\n        numbered.append(line_output)\n        total_chars += len(line_output)\n        \n        # Check total output limit\n        if total_chars > config.max_output_chars:\n            numbered.append(\"\\\\n…[output truncated - use offset/limit to read more]\")\n            break\n    \n    return \"\\\\n\".join(numbered)\n```\n- Truncate individual lines first\n- Then check total output size\n- Provide helpful messages about using offset/limit\n- Handle empty files before processing",
  "status": "in_progress",
  "type": "task",
  "priority": "medium",
  "labels": [
    "tools",
    "performance",
    "safety"
  ],
  "reporter": "jared@goatbytes.io",
  "epic_id": "EPIC-005",
  "blocked_by": [
    "SOUL-79",
    "SOUL-80"
  ],
  "blocks": [
    "SOUL-83",
    "SOUL-85"
  ],
  "comments": [
    {
      "created_at": "2025-11-13T08:50:22.439697",
      "updated_at": "2025-11-13T08:50:22.439698",
      "id": "20251113085022-322c9c9f",
      "ticket_id": "SOUL-82",
      "author": "jared@goatbytes.io",
      "content": "SCOPE CLARIFICATION: This ticket owns ALL truncation logic. SOUL-80 (core read tool) will return raw output without any truncation. This ticket will wrap or integrate with the core tool to apply max_line_length and max_output_chars limits. This separation keeps SOUL-80 focused on baseline read semantics (encoding, security, line numbering) while SOUL-82 handles performance/safety controls.",
      "edited": false,
      "edit_count": 0,
      "is_ai_generated": false,
      "attachments": [],
      "attachment_count": 0
    }
  ],
  "attachments": [],
  "attachment_count": 0,
  "comment_count": 1,
  "story_points": 2,
  "order": 0,
  "custom_fields": {}
}