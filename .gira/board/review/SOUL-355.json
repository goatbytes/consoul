{
  "created_at": "2026-01-01T10:45:09.615546Z",
  "updated_at": "2026-01-02T16:58:07.338366Z",
  "id": "SOUL-355",
  "uuid": "d7907f62-6872-46a9-b8b0-f5e74e233f06",
  "_version": 2,
  "title": "Add resume_session_id support to ConversationService",
  "description": "**As a** Consoul CLI user\n**I want** to resume previous conversations with full message history loaded\n**So that** the AI has complete context from the prior session when continuing the conversation\n\n**Context:**\nThe `consoul history resume <session_id>` command exists but does not properly load previous messages into the conversation context. The ChatSession class at `src/consoul/cli/chat_session.py:104` has a TODO noting this gap:\n\n```python\nif resume_session_id:\n    # Resume existing conversation\n    logger.info(f\"Resuming conversation: {resume_session_id}\")\n    # TODO: Add resume_session_id support to ConversationService\n    # For now, set session_id on the conversation\n    self.conversation_service.conversation.session_id = resume_session_id\n```\n\nCurrently, when resuming a session:\n- The session_id is set on the conversation object\n- BUT the historical messages are NOT loaded from the database\n- The AI starts fresh without any prior context\n\nThe TUI implementation properly handles this in `src/consoul/tui/utils/conversation_loading.py:136` by passing `session_id` to ConversationHistory's constructor, which triggers `_load_from_db()`.\n\n**Technical Notes:**\n- Files to modify:\n  - `src/consoul/sdk/services/conversation.py`: Add `session_id` parameter to `from_config()` factory method\n  - `src/consoul/cli/chat_session.py`: Pass `resume_session_id` to `ConversationService.from_config()`\n- Reference implementation: `src/consoul/ai/history.py:321-328` shows how session resumption works:\n  ```python\n  if session_id:\n      # Resume existing conversation\n      self._load_from_db(session_id)\n      self._conversation_created = True\n      self._use_fast_token_counting = True\n  ```\n- ConversationHistory already supports session resumption via its `session_id` constructor parameter\n- The `_load_from_db()` method at line 385 handles loading messages, system prompts, and conversation summaries\n\n**Acceptance Criteria:**\n\n**Given** a valid session_id from a previous conversation\n**When** I run `consoul history resume <session_id>`\n**Then** all previous messages are loaded into the conversation context\n**And** the AI can reference and build upon the prior conversation\n\n**Given** a resumed session with 10 prior messages\n**When** I send a new message\n**Then** the AI receives all 10 previous messages plus my new message as context\n\n**Given** a session_id that includes a system prompt\n**When** I resume the session\n**Then** the original system prompt is preserved and applied\n\n**Given** a session_id that includes a conversation summary (for long conversations)\n**When** I resume the session\n**Then** the summary is loaded and used for context optimization\n\n**Given** an invalid or non-existent session_id\n**When** I attempt to resume\n**Then** a clear error message is displayed (existing behavior, verify preserved)\n\n**Testing Considerations:**\n- Unit tests:\n  - Mock ConversationDatabase to verify `_load_from_db()` is called with correct session_id\n  - Verify ConversationHistory is initialized with session_id parameter\n  - Test that loaded messages appear in `conversation.messages`\n- Integration tests:\n  - Create a conversation, persist it, then resume and verify message count\n  - Verify AI response reflects knowledge from prior messages\n  - Test resumption with summarized conversations\n- Edge cases:\n  - Resume session that was never saved to DB (should fail gracefully)\n  - Resume session with 0 messages (empty but valid)\n  - Resume while model override is specified (--model flag)\n\n**Implementation Hints:**\n1. Add `session_id: str | None = None` parameter to `ConversationService.from_config()` signature (line ~148)\n2. Pass `session_id=session_id` to `ConversationHistory()` constructor call (line ~259)\n3. In `ChatSession.__init__`, change the ConversationService initialization (line ~95) to:\n   ```python\n   self.conversation_service = ConversationService.from_config(\n       config, \n       approval_provider=self.approval_provider,\n       session_id=resume_session_id,  # NEW\n   )\n   ```\n4. Remove or update the TODO block at lines 101-106 since resumption will now work properly\n5. Consider whether system_prompt_override should be applied when resuming (likely skip to preserve original)",
  "status": "review",
  "type": "feature",
  "priority": "high",
  "labels": [
    "cli",
    "ai",
    "enhancement"
  ],
  "assignee": "jared@goatbytes.io",
  "reporter": "jared@goatbytes.io",
  "blocked_by": [],
  "blocks": [],
  "comments": [],
  "attachments": [],
  "attachment_count": 0,
  "comment_count": 0,
  "story_points": 5,
  "order": 0,
  "custom_fields": {}
}