{
  "created_at": "2025-11-14T22:30:49.350598",
  "updated_at": "2025-11-15T07:29:19.667565Z",
  "id": "SOUL-105",
  "uuid": "d9133bdc-6b34-4b75-9b54-4eaaff1663f5",
  "title": "Implement create_file tool with security validation",
  "description": "**As a** Consoul AI agent\n**I want** to create new files with content\n**So that** I can add new modules, configs, and documentation to projects\n\n**Context:**\nFile creation is a fundamental operation for AI coding assistants. Must integrate with Consoul's existing security framework (path validation, extension filtering, permission system).\n\ncursor-agent pattern:\n- create_file(path, content, allow_overwrite=False)\n- Creates parent directories if needed\n- Returns created/updated status\n- Requires approval for overwrites\n\n**Technical Notes:**\n- Add to src/consoul/ai/tools/implementations/file_edit.py (same module as edit_file)\n- Reuse path validation from ReadToolConfig\n- Check extension against FileEditToolConfig.allowed_extensions\n- Block paths in FileEditToolConfig.blocked_paths\n- Respect allow_overwrite config setting\n- Return FileEditResult format (status, checksum, bytes_written)\n- Register with RiskLevel.CAUTION (requires approval)\n- Atomic write using temp file\n\nFiles to modify:\n- src/consoul/ai/tools/implementations/file_edit.py\n- src/consoul/ai/tools/implementations/__init__.py\n\n**Acceptance Criteria:**\n\n**Given** I create a new file at valid path\n**When** file doesn't exist and extension is allowed\n**Then** file is created with content and success status returned\n\n**Given** file already exists and allow_overwrite=False\n**When** I try to create the file\n**Then** operation fails with \"File exists\" error\n\n**Given** file already exists and allow_overwrite=True in config\n**When** I create with overwrite flag\n**Then** file is overwritten after approval prompt\n\n**Given** I create file in non-existent directory\n**When** parent directories don't exist\n**Then** parent directories are created automatically (os.makedirs exist_ok=True)\n\n**Given** I try to create file with blocked extension (e.g., .exe)\n**When** extension not in allowed_extensions\n**Then** operation rejected with \"Extension not allowed\" error\n\n**Given** I try to create file in blocked path (/etc/passwd)\n**When** path matches blocked_paths pattern\n**Then** operation rejected with \"Path blocked for security\" error\n\n**Testing Considerations:**\n- Test file creation in existing directory\n- Test parent directory creation\n- Test overwrite protection\n- Test extension validation\n- Test path security validation\n- Test atomic write (no partial files on error)\n- Mock file I/O for deterministic tests\n\n**Implementation Hints:**\n```python\n@tool\ndef create_file(\n    file_path: str,\n    content: str,\n    overwrite: bool = False,\n) -> str:\n    \"\"\"\n    Create new file with content.\n    \n    Returns JSON with:\n    - status: \"created\" | \"updated\" | \"error\"\n    - checksum: SHA256 of content\n    - bytes_written: Content size\n    - path: Absolute file path\n    \"\"\"\n    config = get_file_edit_config()\n    \n    # Validate path and extension\n    path = _validate_file_path(file_path, config)\n    \n    # Check if exists\n    if path.exists() and not (overwrite and config.allow_overwrite):\n        raise FileExistsError(...)\n    \n    # Create parent dirs\n    path.parent.mkdir(parents=True, exist_ok=True)\n    \n    # Atomic write\n    _atomic_write(path, content)\n    \n    return json.dumps(FileEditResult(...))\n```",
  "status": "todo",
  "type": "feature",
  "priority": "high",
  "labels": [
    "file-edit",
    "core",
    "foundation"
  ],
  "assignee": "jared@goatbytes.io",
  "reporter": "jared@goatbytes.io",
  "epic_id": "EPIC-005",
  "blocked_by": [
    "SOUL-103",
    "SOUL-104"
  ],
  "blocks": [
    "SOUL-108",
    "SOUL-109",
    "SOUL-111"
  ],
  "comments": [],
  "attachments": [],
  "attachment_count": 0,
  "comment_count": 0,
  "story_points": 3,
  "order": 0,
  "custom_fields": {}
}