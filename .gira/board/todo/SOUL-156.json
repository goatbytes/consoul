{
  "created_at": "2025-11-23T19:50:40.955834",
  "updated_at": "2025-11-23T19:50:40.955843",
  "id": "SOUL-156",
  "uuid": "86cf5047-3295-4df1-b5ce-fc358fe59e5f",
  "title": "Add risk_filter field to ToolConfig for risk-based tool filtering",
  "description": "**As a** Consoul user\n**I want** a risk_filter config option to enable tools by risk level\n**So that** I can easily configure \"safe only\" or \"safe + caution\" tool sets\n\n**Context:**\nUsers commonly want to filter tools by risk level (SAFE, CAUTION, DANGEROUS, BLOCKED). Currently, they must list individual tool names in allowed_tools. A risk_filter field provides a simpler alternative for common security postures.\n\nThis complements allowed_tools (explicit list) with a coarse-grained filter.\n\n**Technical Notes:**\n- src/consoul/config/models.py:1159-1272 - Add new field to ToolConfig\n- New field: risk_filter: Literal[\"safe\", \"caution\", \"dangerous\"] | None = None\n- Uses existing get_tools_by_risk_level() from src/consoul/ai/tools/catalog.py:88-120\n- Precedence: allowed_tools > risk_filter > default (all tools)\n- If both allowed_tools and risk_filter set, allowed_tools wins\n- None = no risk filtering (use allowed_tools or all tools)\n\nRisk levels defined in src/consoul/ai/tools/base.py:30-33:\n- SAFE: Read-only operations (grep, code_search, web_search, etc.)\n- CAUTION: File operations and command execution\n- DANGEROUS: Destructive operations (delete_file)\n- BLOCKED: Explicitly prohibited\n\n**Acceptance Criteria:**\n\n**Given** I set risk_filter = \"safe\" in config\n**When** TUI or SDK initializes\n**Then** only SAFE risk level tools are registered\n\n**Given** I set risk_filter = \"caution\" in config  \n**When** tools are registered\n**Then** SAFE + CAUTION tools are registered (excludes DANGEROUS)\n\n**Given** I set both allowed_tools and risk_filter in config\n**When** tools are registered\n**Then** allowed_tools takes precedence (risk_filter is ignored)\n\n**Given** I set risk_filter = None (or omit field)\n**When** tools are registered\n**Then** allowed_tools or all tools are used (backward compatible)\n\n**Testing Considerations:**\n- Test each risk level value\n- Test precedence (allowed_tools wins)\n- Test backward compatibility (None or omitted)\n- Validate Pydantic schema\n- Test with TUI and SDK\n\n**Implementation Hints:**\n1. Add field to ToolConfig:\n   ```python\n   risk_filter: Literal[\"safe\", \"caution\", \"dangerous\"] | None = Field(\n       default=None,\n       description=\"Filter tools by risk level. None = no filtering. \"\n                   \"Use 'safe' for read-only tools, 'caution' for safe+caution, \"\n                   \"'dangerous' for all tools. Ignored if allowed_tools is set.\",\n   )\n   ```\n2. Update tool resolution logic:\n   ```python\n   if consoul_config.tools.allowed_tools:\n       # Explicit list wins\n       tools_to_register = resolve_allowed_tools()\n   elif consoul_config.tools.risk_filter:\n       # Risk-based filtering\n       tools_to_register = get_tools_by_risk_level(consoul_config.tools.risk_filter)\n   else:\n       # Default: all tools\n       tools_to_register = all_tools()\n   ```\n3. Document in config sample and user guide\n4. Update TOML schema examples\n\n**Dependencies:**\n- SOUL-154 (Use allowed_tools for registration)",
  "status": "todo",
  "type": "feature",
  "priority": "medium",
  "labels": [
    "config",
    "tools",
    "enhancement"
  ],
  "reporter": "jared@goatbytes.io",
  "epic": "EPIC-008",
  "blocked_by": [],
  "blocks": [],
  "comments": [],
  "attachments": [],
  "attachment_count": 0,
  "comment_count": 0,
  "story_points": 2,
  "order": 2,
  "custom_fields": {}
}