{
  "created_at": "2025-11-30T08:08:38.112567",
  "updated_at": "2025-11-30T08:08:38.112577",
  "id": "SOUL-200",
  "uuid": "64b9b83c-8fa2-4ed5-959f-45a55ef93248",
  "title": "Add smart auto-scroll suspension on manual user scroll in ChatView",
  "description": "**As a** Consoul user reviewing previous messages during active conversation\n**I want** auto-scroll to pause when I manually scroll up to read history\n**So that** I can review old messages without being yanked back to the bottom during AI streaming\n\n**Context:**\nCurrently, ChatView has an `auto_scroll` reactive property that controls whether the view automatically scrolls to the bottom when new messages arrive or during AI streaming. However, it doesn't detect when users manually scroll up to review previous messages, causing a jarring UX where:\n\n1. User scrolls up to review previous message\n2. AI continues streaming tokens\n3. `StreamingResponse._auto_scroll_parent()` timer (50ms interval) forces scroll to bottom\n4. User loses their reading position\n\nThis is a common UX pattern in chat applications (Slack, Discord, ChatGPT) where auto-scroll intelligently pauses when users scroll away from the bottom.\n\n**Current Implementation:**\n- `src/consoul/tui/widgets/chat_view.py:35` - `auto_scroll: reactive[bool] = reactive(True)` \n- `src/consoul/tui/widgets/streaming_response.py:76-91` - `_auto_scroll_parent()` timer that forces parent scroll every 50ms\n- `src/consoul/tui/app.py:1531` - Explicit scroll after user message added\n- `src/consoul/tui/app.py:2623-2625` - \"at bottom\" detection uses 5-unit threshold\n\n**Technical Notes:**\n- Textual provides `MouseScrollUp` and `MouseScrollDown` events that can be handled\n- Can override `on_mouse_scroll_up()` and `on_mouse_scroll_down()` in ChatView\n- Need to distinguish user scrolls from programmatic `scroll_end()` calls\n- Should track \"user scrolled away\" state separately from `auto_scroll` setting\n- Re-enable when: (1) user scrolls to bottom, OR (2) user sends new message\n\n**Research:**\n- Textual Events API: https://textual.textualize.io/events/mouse_scroll_up/\n- Similar pattern in Slack: scroll-away pauses, \"Jump to latest\" appears\n- ChatGPT: auto-scroll resumes when you scroll to bottom or send message\n\n**Acceptance Criteria:**\n\n**Given** AI is streaming a response and I'm at the bottom\n**When** I scroll up using mouse wheel or keyboard\n**Then** auto-scroll is temporarily disabled and my scroll position is preserved\n\n**Given** I've scrolled up to review history and auto-scroll is paused\n**When** I scroll back down to within 5 units of the bottom\n**Then** auto-scroll is automatically re-enabled\n\n**Given** I've scrolled up to review history and auto-scroll is paused\n**When** I submit a new user message\n**Then** auto-scroll is re-enabled and view scrolls to show my message\n\n**Given** auto-scroll is paused due to manual scrolling\n**When** AI streaming completes\n**Then** I remain at my current scroll position (no jump to bottom)\n\n**Given** I'm reviewing old messages with auto-scroll paused\n**When** new messages arrive\n**Then** messages are added to chat but scroll position remains unchanged\n\n**Testing Considerations:**\n- Test mouse wheel scroll up/down\n- Test keyboard scroll (Page Up/Down, arrow keys)\n- Test scroll bar drag\n- Test re-enable on scroll-to-bottom\n- Test re-enable on new message submit\n- Test that programmatic scrolls don't trigger suspension\n- Test with rapid streaming (ensure no flicker)\n- Test edge case: user at bottom but scrolls down (should stay enabled)\n\n**Implementation Hints:**\n1. Add `_user_scrolled_away` flag to ChatView\n2. Override `on_mouse_scroll_up()` to detect upward scrolls\n3. Check if currently near bottom before setting `_user_scrolled_away = True`\n4. Override `on_mouse_scroll_down()` to detect if scrolled back to bottom\n5. Modify `add_message()` to check `_user_scrolled_away` before auto-scrolling\n6. Update `on_input_area_message_submit` to clear `_user_scrolled_away` flag\n7. Add visual indicator (optional): \"â†“ New messages\" badge when paused\n8. Consider adding config option: `auto_scroll_suspend_on_user_scroll` (default: true)\n\n**Files to Modify:**\n- `src/consoul/tui/widgets/chat_view.py` - Add scroll event handlers, `_user_scrolled_away` flag\n- `src/consoul/tui/app.py` - Clear flag on message submit\n- `src/consoul/tui/widgets/streaming_response.py` - Check flag in `_auto_scroll_parent()`\n- `src/consoul/config/models.py` - Add config option (optional)\n\n**Dependencies:**\nNone - independent UX improvement",
  "status": "todo",
  "type": "feature",
  "priority": "high",
  "labels": [
    "tui",
    "ux-improvement",
    "quick-win"
  ],
  "reporter": "jared@goatbytes.io",
  "blocked_by": [],
  "blocks": [],
  "comments": [],
  "attachments": [],
  "attachment_count": 0,
  "comment_count": 0,
  "story_points": 5,
  "order": 0,
  "custom_fields": {}
}