{
  "created_at": "2025-12-07T19:38:56.516648",
  "updated_at": "2025-12-15T17:02:35.370214Z",
  "id": "SOUL-236",
  "uuid": "d3a5934f-5cc4-49d6-9eba-fda5e95fa9a6",
  "title": "Add session-scoped Consoul factory for multi-user backends",
  "description": "**As a** backend developer building multi-user applications\n**I want** a factory function to create isolated Consoul instances per session\n**So that** user conversations don't interfere with each other\n\n**Context:**\nConsoul class maintains mutable state (self.history, self._last_request, self._last_response). In multi-user backends, this causes data leakage between concurrent requests. \n\nWeb backends need per-session isolation with:\n- Separate conversation history per user/session\n- No persistence to local files (persist=False)\n- Isolated tool registries\n- Session-specific cost tracking\n\nCurrent workaround requires manually managing Consoul lifecycle, which is error-prone.\n\n**Technical Notes:**\n- Current state: src/consoul/sdk.py:276-299 (self.history, self._last_request)\n- Issue: Shared instance = data leakage in concurrent requests\n- Create: create_session() factory function\n- Pattern: Returns isolated Consoul with persist=False\n- Config: Accept session_id, user_id for tracking\n- Memory: Consider session cleanup/TTL for long-running servers\n\n**Acceptance Criteria:**\n\n**Given** I have a FastAPI endpoint handling multiple users\n**When** I call create_session(session_id=\"abc123\", model=\"gpt-4o\")\n**Then** returns isolated Consoul instance with unique conversation history\n\n**Given** two concurrent sessions are created\n**When** each session receives messages\n**Then** histories remain completely separate with no cross-contamination\n\n**Given** a session is created\n**When** messages are processed\n**Then** conversation is never persisted to disk (persist=False enforced)\n\n**Given** I create a session with custom config\n**When** I pass model, temperature, tools parameters\n**Then** session uses those settings independently\n\n**Testing Considerations:**\n- Test concurrent session isolation (threading/asyncio)\n- Test memory separation between sessions\n- Verify no disk persistence\n- Test session cleanup patterns\n- Mock multiple concurrent requests\n- Verify tool registries are isolated\n\n**Implementation Hints:**\n- Create factory: def create_session(session_id: str, **kwargs) -> Consoul\n- Force persist=False in factory\n- Add session_id to metadata for tracking\n- Document recommended patterns:\n  - FastAPI: dependency injection per request\n  - WebSocket: one instance per connection\n  - HTTP: new instance per request\n- Add examples/backend/fastapi_sessions.py example\n- Consider: async def create_async_session() for async contexts\n- Reference: ChatGPT conversation about session management (lines 2217-2255)",
  "status": "todo",
  "type": "feature",
  "priority": "high",
  "labels": [
    "sdk",
    "backend",
    "refactor"
  ],
  "assignee": "jared@goatbytes.io",
  "reporter": "jared@goatbytes.io",
  "epic_id": "EPIC-011",
  "blocked_by": [],
  "blocks": [],
  "comments": [],
  "attachments": [],
  "attachment_count": 0,
  "comment_count": 0,
  "story_points": 3,
  "order": 0,
  "custom_fields": {}
}