{
  "created_at": "2025-12-23T12:09:24.135060",
  "updated_at": "2025-12-23T23:09:24.695480Z",
  "id": "SOUL-294",
  "uuid": "01e369c3-fc23-4f1e-97d5-915237caf480",
  "title": "Add production security middleware components",
  "description": "**As a** backend developer deploying Consoul server\n**I want** production-ready security middleware (auth, rate limiting, CORS)\n**So that** my API is protected from unauthorized access and abuse\n\n**Context:**\nProduction servers require security layers before reaching ConversationService. Current SDK lacks middleware components. Need reusable, FastAPI-compatible middleware for:\n- API key authentication\n- Rate limiting (per-key, global)\n- CORS configuration  \n- Request validation\n\nReference: LangChain production patterns emphasize built-in auth/rate limiting.\n\n**Technical Notes:**\n- Create: src/consoul/server/middleware/ package\n- Create: src/consoul/server/middleware/auth.py\n- Create: src/consoul/server/middleware/rate_limit.py\n- Create: src/consoul/server/middleware/cors.py\n- Dependencies: fastapi, slowapi (rate limiting), redis (optional)\n- Pattern: FastAPI middleware components\n- Integration: Work with create_server() factory\n\nMiddleware to implement:\n1. APIKeyAuth - Header/query param authentication\n2. RateLimiter - Token bucket algorithm\n3. CORSMiddleware - Configurable origins\n4. RequestValidator - Pydantic validation\n\n**Acceptance Criteria:**\n\n**Given** server configured with API key auth\n**When** request arrives without X-API-Key header\n**Then** returns 401 Unauthorized with error message\n\n**Given** rate limit of 10 requests/minute per key\n**When** client exceeds limit\n**Then** returns 429 Too Many Requests with retry-after header\n\n**Given** CORS enabled with allowed_origins=[\"https://legal.app\"]\n**When** request from unauthorized origin\n**Then** response lacks CORS headers; browser blocks the request\n\n**Given** invalid request body\n**When** using RequestValidator\n**Then** returns 422 with detailed validation errors\n\n**Testing Considerations:**\n- Test auth with valid/invalid keys\n- Test rate limiting with multiple clients\n- Test CORS preflight requests\n- Test validation error responses\n- Integration test with FastAPI TestClient\n- Test Redis-backed rate limiting\n\n**Implementation Hints:**\n- APIKeyAuth: FastAPI Security with APIKeyHeader/APIKeyQuery\n- Rate limiting: Use slowapi library with Redis backend\n- Store API keys: Environment variables or config file\n- CORS: FastAPI CORSMiddleware with configurable origins\n- Validation: Pydantic models with detailed error messages\n- Middleware order: CORS → Auth → RateLimit → Validation\n- Add health endpoint that bypasses auth\n- Document setup in examples/server/security_config.py\n- Reference: FastAPI security docs, LangServe patterns",
  "status": "todo",
  "type": "story",
  "priority": "high",
  "labels": [
    "sdk",
    "security",
    "middleware",
    "production"
  ],
  "assignee": "jared@goatbytes.io",
  "reporter": "jared@goatbytes.io",
  "epic_id": "EPIC-016",
  "blocked_by": [],
  "blocks": [],
  "comments": [],
  "attachments": [],
  "attachment_count": 0,
  "comment_count": 0,
  "story_points": 5,
  "order": 0,
  "custom_fields": {}
}