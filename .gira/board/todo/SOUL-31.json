{
  "created_at": "2025-11-09T13:48:40.823514",
  "updated_at": "2025-11-09T13:48:40.823528",
  "id": "SOUL-31",
  "uuid": "8f13d4dc-8ff1-4e38-8ea1-da560ea80a3e",
  "title": "Enhanced conversation export/import with multiple formats",
  "description": "**As a** Consoul user\n**I want** to export and import conversations in various formats\n**So that** I can share conversations, migrate between systems, and integrate with other tools\n\n**Context:**\nUsers need to share conversations (with colleagues, for documentation), backup data, or migrate between systems. Support multiple export formats (JSON, Markdown, HTML, CSV) and import from other tools (aider, llm, ChatGPT exports).\n\nInspired by:\n- aider conversation export features\n- ChatGPT export format (JSON)\n- llm tool conversation logs\n- GitHub Gist integration for sharing\n\n**Technical Notes:**\n- **Files to create**: `src/consoul/cli/export.py`, `src/consoul/formatters/`\n- **Files to modify**: `src/consoul/ai/database.py` (export queries)\n- **Formats**: JSON (structured), Markdown (readable), HTML (shareable), CSV (analytics)\n- **Import**: Support ChatGPT JSON, aider logs, generic message format\n- **Attachments**: Handle code blocks, images (future), metadata\n\n**Acceptance Criteria:**\n\n**Given** I have a conversation in history\n**When** I run `consoul export <session-id> --format json`\n**Then** conversation is exported to JSON with full metadata\n\n**Given** I want readable format\n**When** I run `consoul export <session-id> --format markdown`\n**Then** conversation is exported as formatted Markdown with timestamps\n\n**Given** I want to share conversation\n**When** I run `consoul export <session-id> --format html`\n**Then** standalone HTML file is created with styling\n\n**Given** I want analytics data\n**When** I run `consoul export <session-id> --format csv`\n**Then** messages exported to CSV with columns: timestamp, role, content, tokens\n\n**Given** I want to export multiple conversations\n**When** I run `consoul export --all --format json`\n**Then** all conversations exported to single JSON file\n\n**Given** I have ChatGPT export JSON\n**When** I run `consoul import chatgpt-export.json --format chatgpt`\n**Then** conversations are imported with metadata preserved\n\n**Given** I want to share via URL\n**When** I run `consoul export <session-id> --gist`\n**Then** conversation posted to GitHub Gist and URL returned\n\n**Testing Considerations:**\n- Test each export format with various conversation types\n- Verify Unicode handling (emojis, special characters)\n- Test large conversation export (10k+ messages)\n- Test import with malformed data (graceful error handling)\n- Verify round-trip (export ‚Üí import ‚Üí export produces identical output)\n- Test empty conversations, conversations with only system message\n- Mock GitHub API for gist tests\n\n**Implementation Hints:**\n\n```python\n# src/consoul/formatters/json.py\nimport json\nfrom datetime import datetime\nfrom pathlib import Path\n\ndef export_to_json(conversation: dict, output_path: Path | None = None) -> str:\n    \"\"\"Export conversation to JSON format.\"\"\"\n    \n    data = {\n        \"version\": \"1.0\",\n        \"exported_at\": datetime.utcnow().isoformat(),\n        \"conversation\": {\n            \"session_id\": conversation[\"session_id\"],\n            \"model\": conversation[\"model\"],\n            \"created_at\": conversation[\"created_at\"],\n            \"updated_at\": conversation[\"updated_at\"],\n            \"message_count\": len(conversation[\"messages\"]),\n            \"total_tokens\": sum(m[\"tokens\"] for m in conversation[\"messages\"]),\n        },\n        \"messages\": [\n            {\n                \"role\": msg[\"role\"],\n                \"content\": msg[\"content\"],\n                \"tokens\": msg[\"tokens\"],\n                \"timestamp\": msg[\"timestamp\"]\n            }\n            for msg in conversation[\"messages\"]\n        ]\n    }\n    \n    json_str = json.dumps(data, indent=2, ensure_ascii=False)\n    \n    if output_path:\n        output_path.write_text(json_str, encoding=\"utf-8\")\n    \n    return json_str\n\n# src/consoul/formatters/markdown.py\ndef export_to_markdown(conversation: dict, output_path: Path | None = None) -> str:\n    \"\"\"Export conversation to Markdown format.\"\"\"\n    \n    lines = [\n        f\"# Conversation: {conversation['session_id']}\",\n        \"\",\n        f\"**Model**: {conversation['model']}  \",\n        f\"**Created**: {conversation['created_at']}  \",\n        f\"**Messages**: {len(conversation['messages'])}  \",\n        f\"**Total Tokens**: {sum(m['tokens'] for m in conversation['messages'])}  \",\n        \"\",\n        \"---\",\n        \"\",\n    ]\n    \n    for msg in conversation[\"messages\"]:\n        role_emoji = {\n            \"system\": \"‚öôÔ∏è\",\n            \"user\": \"üë§\",\n            \"assistant\": \"ü§ñ\"\n        }.get(msg[\"role\"], \"‚ùì\")\n        \n        lines.extend([\n            f\"## {role_emoji} {msg['role'].title()}\",\n            \"\",\n            f\"*{msg['timestamp']}* | *{msg['tokens']} tokens*\",\n            \"\",\n            msg[\"content\"],\n            \"\",\n            \"---\",\n            \"\",\n        ])\n    \n    markdown = \"\\\\n\".join(lines)\n    \n    if output_path:\n        output_path.write_text(markdown, encoding=\"utf-8\")\n    \n    return markdown\n\n# src/consoul/formatters/html.py\nHTML_TEMPLATE = \"\"\"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Consoul Conversation - {session_id}</title>\n    <style>\n        body {{ font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif; \n               max-width: 800px; margin: 40px auto; padding: 0 20px; }}\n        .header {{ background: #f0f0f0; padding: 20px; border-radius: 8px; margin-bottom: 30px; }}\n        .message {{ margin: 20px 0; padding: 15px; border-radius: 8px; }}\n        .system {{ background: #fff3cd; }}\n        .user {{ background: #d1ecf1; }}\n        .assistant {{ background: #d4edda; }}\n        .meta {{ color: #666; font-size: 0.9em; margin-bottom: 10px; }}\n        pre {{ background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }}\n    </style>\n</head>\n<body>\n    <div class=\"header\">\n        <h1>Consoul Conversation</h1>\n        <p><strong>Session:</strong> {session_id}</p>\n        <p><strong>Model:</strong> {model}</p>\n        <p><strong>Created:</strong> {created_at}</p>\n        <p><strong>Messages:</strong> {message_count} | <strong>Tokens:</strong> {total_tokens}</p>\n    </div>\n    {messages}\n</body>\n</html>\"\"\"\n\ndef export_to_html(conversation: dict, output_path: Path | None = None) -> str:\n    \"\"\"Export conversation to HTML format.\"\"\"\n    \n    messages_html = []\n    for msg in conversation[\"messages\"]:\n        messages_html.append(f\"\"\"\n    <div class=\"message {msg['role']}\">\n        <div class=\"meta\">\n            <strong>{msg['role'].title()}</strong> | \n            {msg['timestamp']} | \n            {msg['tokens']} tokens\n        </div>\n        <div class=\"content\">{escape_html(msg['content'])}</div>\n    </div>\n        \"\"\")\n    \n    html = HTML_TEMPLATE.format(\n        session_id=conversation[\"session_id\"],\n        model=conversation[\"model\"],\n        created_at=conversation[\"created_at\"],\n        message_count=len(conversation[\"messages\"]),\n        total_tokens=sum(m[\"tokens\"] for m in conversation[\"messages\"]),\n        messages=\"\\\\n\".join(messages_html)\n    )\n    \n    if output_path:\n        output_path.write_text(html, encoding=\"utf-8\")\n    \n    return html\n\n# Import from ChatGPT format\ndef import_from_chatgpt(json_path: Path) -> list[dict]:\n    \"\"\"Import conversations from ChatGPT export JSON.\"\"\"\n    \n    data = json.loads(json_path.read_text())\n    conversations = []\n    \n    for conv in data:\n        messages = []\n        for node_id, node in conv[\"mapping\"].items():\n            if node[\"message\"]:\n                msg = node[\"message\"]\n                role = msg[\"author\"][\"role\"]\n                \n                # ChatGPT uses \"user\", \"assistant\", \"system\"\n                if role == \"user\":\n                    role = \"user\"\n                elif role == \"assistant\":\n                    role = \"assistant\"\n                elif role == \"system\":\n                    role = \"system\"\n                \n                messages.append({\n                    \"role\": role,\n                    \"content\": msg[\"content\"][\"parts\"][0],\n                    \"timestamp\": datetime.fromtimestamp(\n                        msg[\"create_time\"]\n                    ).isoformat()\n                })\n        \n        conversations.append({\n            \"session_id\": conv[\"id\"],\n            \"model\": conv[\"model\"] or \"unknown\",\n            \"created_at\": datetime.fromtimestamp(conv[\"create_time\"]).isoformat(),\n            \"messages\": messages\n        })\n    \n    return conversations\n```\n\n**CLI Commands:**\n\n```bash\n# Export single conversation\nconsoul export <session-id> --format json -o conversation.json\nconsoul export <session-id> --format markdown -o conversation.md\nconsoul export <session-id> --format html -o conversation.html\nconsoul export <session-id> --format csv -o conversation.csv\n\n# Export all conversations\nconsoul export --all --format json -o all-conversations.json\n\n# Export to stdout (for piping)\nconsoul export <session-id> --format json\n\n# Post to GitHub Gist\nconsoul export <session-id> --gist [--public]\n\n# Import conversations\nconsoul import chatgpt-export.json --format chatgpt\nconsoul import aider-logs.json --format aider\nconsoul import generic-messages.json --format consoul\n\n# Import with dry-run\nconsoul import data.json --dry-run\n```\n\n**Export Formats:**\n\n1. **JSON**: Full structured data, machine-readable\n2. **Markdown**: Human-readable, good for documentation\n3. **HTML**: Shareable standalone file with styling\n4. **CSV**: Analytics-friendly, importable to Excel/Google Sheets\n\n**Import Sources:**\n\n1. **ChatGPT**: OpenAI's export format\n2. **aider**: aider chat logs\n3. **Consoul**: Own JSON format (round-trip)\n4. **Generic**: Simple message list format\n\n**Configuration:**\n\n```yaml\n# ~/.config/consoul/config.yaml\nexport:\n  default_format: json\n  include_metadata: true\n  include_tokens: true\n  github_gist:\n    enabled: false\n    token: null  # Set via GITHUB_TOKEN env var\n    default_public: false\n```\n\n**Dependencies:**\n- SOUL-27 (SQLite persistence - required)\n- `pygments` (optional, for syntax highlighting in HTML)\n- `requests` (for GitHub Gist API)\n\n**Security Considerations:**\n- Sanitize HTML output (escape user content)\n- Warn before posting to public Gist\n- Don't export API keys or sensitive metadata",
  "status": "todo",
  "type": "feature",
  "priority": "low",
  "labels": [
    "export",
    "import",
    "history",
    "interoperability"
  ],
  "reporter": "jared@goatbytes.io",
  "epic_id": "EPIC-002",
  "blocked_by": [],
  "blocks": [],
  "comments": [],
  "attachments": [],
  "attachment_count": 0,
  "comment_count": 0,
  "story_points": 3,
  "order": 0,
  "custom_fields": {}
}