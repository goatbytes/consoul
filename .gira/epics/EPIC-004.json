{
  "created_at": "2025-11-10T19:44:26.056354",
  "updated_at": "2025-11-15T07:24:35.808545Z",
  "id": "EPIC-004",
  "title": "Tool Calling & Function Execution System",
  "description": "Enable Consoul to execute tools (bash commands, Python code, file operations) requested by AI models with user approval workflows, security controls, and real-time result display.\n\n## Vision\nTransform Consoul from a chat-only interface into an interactive AI assistant that can take real-world actions through LangChain's tool calling API. Models like Claude 3.5, GPT-4, and Gemini can request tool execution, but all tools require explicit user approval with clear visibility into what will be executed.\n\n**SDK-First Architecture**: Consoul is designed as an embeddable SDK for host applications (Gira, CLI tools, web apps, IDE plugins). The tool calling system must work in headless environments without TUI dependencies, providing protocol-based extension points for custom approval UX and audit logging.\n\n## Goals\n1. **Safety First**: Never auto-execute - always require user confirmation\n2. **SDK-Ready**: Core tool calling works without TUI, with pluggable approval/audit providers\n3. **Provider Support**: Work with all LangChain tool-calling models (OpenAI, Anthropic, Google, Ollama)\n4. **Extensibility**: Plugin architecture for custom tools, approval UX, and audit backends\n5. **Visibility**: Clear UI showing what tools will execute and their results (optional TUI layer)\n6. **Security**: Configurable whitelists/blacklists, timeouts, audit logging, and sandboxing options\n\n## Architecture Layers\n\n```\n┌─────────────────────────────────────────┐\n│ Host Application Layer                  │\n│ (Gira, CLI, Web, IDE)                   │\n│ - Custom ApprovalProvider               │\n│ - Custom AuditLogger                    │\n│ - Tool configuration via ConsoulConfig  │\n└──────────────┬──────────────────────────┘\n               │\n┌──────────────▼──────────────────────────┐\n│ Core Tool Calling API (Headless)        │\n│ - Tool registry & execution             │\n│ - ApprovalProvider protocol             │\n│ - AuditLogger protocol                  │\n│ - Risk assessment & security policies   │\n│ - No UI dependencies                    │\n└──────────────┬──────────────────────────┘\n               │ (optional)\n┌──────────────▼──────────────────────────┐\n│ TUI Layer (Optional)                    │\n│ - TuiApprovalProvider                   │\n│ - ToolApprovalModal widget              │\n│ - Tool result display widget            │\n│ - Only imported when using Textual TUI  │\n└─────────────────────────────────────────┘\n```\n\n## MVP Scope (Phase 1)\n\n**Core SDK (No TUI Dependencies):**\n- Tool registry and configuration system in ConsoulConfig (SOUL-58)\n- Headless approval API with ApprovalProvider protocol (SOUL-66)\n- Bash tool with strict safety controls (SOUL-60)\n- Tool call detection in streaming responses (SOUL-61)\n- Audit logging with pluggable AuditLogger protocol (SOUL-67)\n- SDK integration documentation and examples (SOUL-68)\n\n**Optional TUI Layer:**\n- TUI approval modal widget implementing ApprovalProvider (SOUL-59)\n- Tool result display in chat view (SOUL-63)\n- Textual-based approval UX with risk indicators (SOUL-59)\n\n**Integration:**\n- Tool execution flow connecting all components (SOUL-62)\n- Documentation for tool calling features (SOUL-65)\n- Conversation history with tool calls/results\n\n## Future Phases\n- Phase 2: Python code execution, file operations (read/write)\n- Phase 3: Web search, HTTP requests, git operations\n- Phase 4: Custom user-defined tools, plugin system\n- Phase 5: MCP (Model Context Protocol) integration\n- Phase 6: Advanced audit backends (database, cloud logging)\n\n## Security Principles\n- Principle of least privilege\n- Blocked commands by default (rm -rf, sudo, etc.)\n- Timeout enforcement with configurable limits\n- Human-in-the-loop for all executions (pluggable approval)\n- Detailed audit logging with structured JSON events\n- Risk-based classification (safe/caution/dangerous)\n- No auto-execution mode (approval required always)\n\n## SDK Extension Points\n\n**ApprovalProvider Protocol**: Host apps implement custom approval UX\n- CLI: Terminal prompts with input()\n- Web: REST API approval endpoints\n- IDE: Native notification dialogs\n- Gira: TUI-based approval modal\n\n**AuditLogger Protocol**: Host apps implement custom audit storage\n- File-based: JSON logs in .consoul/audit/\n- Database: SQLite, PostgreSQL, MongoDB\n- Cloud: CloudWatch, Stackdriver, Datadog\n- Custom: Enterprise SIEM integration\n\n**Configuration**: Tool policies in ConsoulConfig\n- Global defaults\n- Profile-specific overrides\n- Environment variable config\n- Programmatic configuration in host apps\n\n## References\n- LangChain Tool Calling: https://python.langchain.com/docs/concepts/tool_calling/\n- Claude Tool Use: https://docs.anthropic.com/en/docs/build-with-claude/tool-use\n- Aider shell command approval patterns\n- OpenAI function calling best practices\n- Python typing.Protocol for structural subtyping",
  "status": "completed",
  "owner": "jared@goatbytes.io",
  "target_date": "2025-12-15",
  "labels": [],
  "tickets": [
    "SOUL-58",
    "SOUL-59",
    "SOUL-60",
    "SOUL-61",
    "SOUL-62",
    "SOUL-63",
    "SOUL-65",
    "SOUL-66",
    "SOUL-67",
    "SOUL-68"
  ],
  "comments": [],
  "comment_count": 0,
  "attachments": [],
  "attachment_count": 0,
  "custom_fields": {}
}