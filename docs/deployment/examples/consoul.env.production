# =============================================================================
# Consoul Production Environment Configuration
# =============================================================================
#
# This file contains recommended production settings for Consoul.
# Copy to .env and customize for your deployment.
#
# Usage:
#   cp consoul.env.production .env
#   # Edit .env with your API keys and settings
#   docker-compose -f docker-compose.production.yml up -d
#
# =============================================================================

# -----------------------------------------------------------------------------
# LLM Provider API Keys (REQUIRED - set these!)
# -----------------------------------------------------------------------------

# OpenAI API key
OPENAI_API_KEY=sk-your-openai-api-key-here

# Anthropic API key
ANTHROPIC_API_KEY=sk-ant-your-anthropic-api-key-here

# Google AI API key (optional)
# GOOGLE_API_KEY=your-google-api-key-here

# -----------------------------------------------------------------------------
# Consoul API Authentication (REQUIRED)
# -----------------------------------------------------------------------------

# API keys for authenticating requests to Consoul
# Multiple keys supported (comma-separated)
CONSOUL_API_KEYS=sk-consoul-prod-your-key-here

# Rate limit tiers (optional - JSON format)
# CONSOUL_API_KEY_TIERS={"sk-premium-*": "premium", "sk-standard-*": "standard"}
# CONSOUL_TIER_LIMITS={"premium": "100/minute", "standard": "30/minute"}

# -----------------------------------------------------------------------------
# Redis Connection Pool
# -----------------------------------------------------------------------------

# Session storage Redis URL (use separate database)
CONSOUL_SESSION_REDIS_URL=redis://redis:6379/0

# Rate limiter Redis URL (separate for isolation)
CONSOUL_RATE_LIMIT_REDIS_URL=redis://redis:6379/1

# Connection pool limits
CONSOUL_REDIS_MAX_CONNECTIONS=100

# Socket timeouts (seconds) - prevents hanging connections
CONSOUL_REDIS_SOCKET_TIMEOUT=5.0
CONSOUL_REDIS_CONNECT_TIMEOUT=2.0

# -----------------------------------------------------------------------------
# Rate Limiting
# -----------------------------------------------------------------------------

# Enable rate limiting
CONSOUL_RATE_LIMIT_ENABLED=true

# Default limits (format: count/period;count/period)
# Examples: "30/minute", "10/minute;500/hour;5000/day"
CONSOUL_DEFAULT_LIMITS=30/minute;500/hour

# Key prefix for Redis
CONSOUL_RATE_LIMIT_KEY_PREFIX=consoul:ratelimit

# Strategy: fixed-window or moving-window
CONSOUL_RATE_LIMIT_STRATEGY=moving-window

# -----------------------------------------------------------------------------
# Circuit Breaker (LLM Provider Resilience)
# -----------------------------------------------------------------------------

# Enable circuit breaker
CONSOUL_CIRCUIT_BREAKER_ENABLED=true

# Failures before opening circuit
CONSOUL_CIRCUIT_BREAKER_FAILURE_THRESHOLD=5

# Successes required to close circuit
CONSOUL_CIRCUIT_BREAKER_SUCCESS_THRESHOLD=3

# Seconds before attempting half-open
CONSOUL_CIRCUIT_BREAKER_TIMEOUT=60

# Max test requests in half-open state
CONSOUL_CIRCUIT_BREAKER_HALF_OPEN_MAX_CALLS=3

# -----------------------------------------------------------------------------
# Session Management
# -----------------------------------------------------------------------------

# Session TTL in seconds (default: 1 hour)
CONSOUL_SESSION_TTL=3600

# Session key prefix
CONSOUL_SESSION_KEY_PREFIX=consoul:session

# Garbage collection interval (seconds)
CONSOUL_SESSION_GC_INTERVAL=3600

# Keys processed per GC cycle
CONSOUL_SESSION_GC_BATCH_SIZE=100

# Enable fallback to in-memory storage when Redis unavailable
CONSOUL_SESSION_FALLBACK_ENABLED=true

# Reconnection interval when in fallback mode (seconds)
CONSOUL_SESSION_RECONNECT_INTERVAL=60

# -----------------------------------------------------------------------------
# HTTP Connection Limits (LLM Provider Clients)
# -----------------------------------------------------------------------------

# httpx connection pool settings
HTTPX_MAX_CONNECTIONS=100
HTTPX_MAX_KEEPALIVE_CONNECTIONS=20
HTTPX_TIMEOUT=30.0

# Provider-specific timeouts
OPENAI_TIMEOUT=120
ANTHROPIC_TIMEOUT=120

# -----------------------------------------------------------------------------
# Server Configuration
# -----------------------------------------------------------------------------

# Server host and port
CONSOUL_HOST=0.0.0.0
CONSOUL_PORT=8000

# Application name (shown in health check)
CONSOUL_APP_NAME=Consoul API

# -----------------------------------------------------------------------------
# Request Validation
# -----------------------------------------------------------------------------

# Enable request validation
CONSOUL_VALIDATION_ENABLED=true

# Maximum request body size (bytes)
CONSOUL_MAX_BODY_SIZE=1048576

# -----------------------------------------------------------------------------
# Prometheus Metrics
# -----------------------------------------------------------------------------

# Enable Prometheus metrics
CONSOUL_METRICS_ENABLED=true

# Metrics server port (separate from API)
CONSOUL_METRICS_PORT=9090

# -----------------------------------------------------------------------------
# CORS Configuration
# -----------------------------------------------------------------------------

# Allowed origins (comma-separated or *)
CONSOUL_CORS_ALLOWED_ORIGINS=*

# Allowed methods
CONSOUL_CORS_ALLOW_METHODS=GET,POST,PUT,DELETE,OPTIONS

# Allow credentials
CONSOUL_CORS_ALLOW_CREDENTIALS=true

# Max age for preflight cache (seconds)
CONSOUL_CORS_MAX_AGE=600

# -----------------------------------------------------------------------------
# Logging
# -----------------------------------------------------------------------------

# Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
CONSOUL_LOG_LEVEL=INFO

# Log format: json or text
CONSOUL_LOG_FORMAT=json

# -----------------------------------------------------------------------------
# Thread Pool (for blocking operations)
# -----------------------------------------------------------------------------

# Thread pool size for asyncio.to_thread()
# Default: min(32, os.cpu_count() + 4)
# Increase for I/O-heavy workloads
CONSOUL_THREAD_POOL_SIZE=100
